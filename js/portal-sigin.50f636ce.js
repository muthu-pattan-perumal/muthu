(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["portal-sigin"],{"633f":function(t,i,a){"use strict";a("d09f")},bd17:function(t,i,a){"use strict";a.r(i);var s=function(){var t=this,i=t._self._c;return i("AuthLayout",{attrs:{"tenant-id":t.tenantId,"portal-id":t.portalId}},[i("div",{attrs:{id:"portals-sigin"}},[i("div",{staticClass:"description"},[t._v("Hi, Welcome!")]),i("div",{staticClass:"title"},[t._v("Sign in to your account")]),i("div",{staticClass:"col"},["MASTER_LOGIN"===t.loginType&&"PASSWORD"===t.passwordTypes?[i("div",{attrs:{id:"masterLogin"}},[i("ValidationObserver",{ref:"form"},[i("ValidationProvider",{attrs:{name:"username",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:a}){return[i("TextField",{staticClass:"q-mb-md",attrs:{label:"username","is-mandatory":"","auto-focus":!0,"is-readonly":t.isLoading,error:a[0]},on:{enter:t.validate},model:{value:t.username,callback:function(i){t.username=i},expression:"username"}})]}}],null,!1,3070910777)}),i("ValidationProvider",{attrs:{name:"password",rules:{required:!0,password:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:a}){return[i("PasswordField",{staticClass:"q-mb-md",attrs:{label:"password","is-mandatory":"","is-readonly":t.isLoading,tooltip:t._passwordHint,error:a[0]},on:{enter:t.validate},model:{value:t.password,callback:function(i){t.password=i},expression:"password"}})]}}],null,!1,3748459213)})],1),i("div",{staticClass:"row items-center"},[i("div",{attrs:{id:"forgot-password"}},[t._v("Forgot password?")])]),i("BaseButton",{staticClass:"sign-in-btn",attrs:{label:"sign in","is-loading":t.isLoading},on:{click:t.validate}}),t.error?i("FormFieldError",{staticClass:"text-center",attrs:{error:t.error}}):t._e()],1)]:"EMAIL_LOGIN"===t.loginType||"MASTER_LOGIN"===t.loginType&&("OTP"===t.passwordTypes||"SOCIAL_LOGIN"===t.passwordTypes)?[i("EmailAuthentication",{attrs:{label:"Email","tenant-id":t.tenantId,"portal-id":t.portalId,"login-type":t.loginType,settings:t.settings,"password-types":t.passwordTypes},on:{logged:t.logged,showSocialLogin:t.showSocialLogin,error:t.userFieldError}}),t.error?i("FormFieldError",{staticClass:"text-center",attrs:{error:t.error}}):t._e()]:"MOBILE_LOGIN"===t.loginType?[i("MobileAuthentication",{attrs:{label:"Mobile","otp-verify":!1}})]:"APP_LOGIN"===t.loginType?[t.checkTenant?[t.normalLogin?[i("ValidationObserver",{ref:"form"},[i("Email",{attrs:{"is-loading":t.isLoading},on:{enter:t.validateSignIn},model:{value:t.email,callback:function(i){t.email=i},expression:"email"}}),i("Password",{attrs:{"is-loading":t.isLoading},on:{enter:t.validateSignIn},model:{value:t.password,callback:function(i){t.password=i},expression:"password"}}),i("BaseButton",{staticClass:"sign-in-btn",attrs:{label:"sign in","is-loading":t.isLoading},on:{click:t.validateSignIn}})],1),t.error?i("FormFieldError",{staticClass:"text-center",attrs:{error:t.error}}):t._e()]:[i("ValidationObserver",{ref:"tenant"},[i("Email",{attrs:{"is-loading":t.isLoading},on:{enter:t.validateEmail},model:{value:t.email,callback:function(i){t.email=i},expression:"email"}}),i("BaseButton",{staticClass:"sign-in-btn",attrs:{label:"continue","is-loading":t.isLoading},on:{click:t.validateEmail}})],1),t.error?i("FormFieldError",{staticClass:"text-center",attrs:{error:t.error}}):t._e()]]:[i("ValidationObserver",{ref:"form"},[i("Email",{attrs:{"is-loading":t.isLoading},on:{enter:t.validateSignIn},model:{value:t.email,callback:function(i){t.email=i},expression:"email"}}),i("Password",{attrs:{"is-loading":t.isLoading},on:{enter:t.validateSignIn},model:{value:t.password,callback:function(i){t.password=i},expression:"password"}})],1),i("BaseButton",{staticClass:"sign-in-btn",attrs:{label:"sign in","is-loading":t.isLoading},on:{click:t.validateSignIn}}),t.error?i("FormFieldError",{staticClass:"text-center",attrs:{error:t.error}}):t._e()]]:t._e(),"APP_LOGIN"===t.loginType&&t.socialLogin.length?[i("OrDivider"),i("SocialAuths",{attrs:{"logged-from":"PORTAL","tenant-id":t.tenantId,"social-login-list":t.socialLogin},on:{logged:t.logged}})]:t._e(),t.masterSocialLogin?[i("OrDivider"),i("SocialAuths",{attrs:{"logged-from":"PORTAL","tenant-id":t.tenantId,"social-login-list":t.socialLogin},on:{logged:t.logged}})]:t._e()],2)])])},e=[],o=(a("14d9"),a("6376")),r=a("7bb1"),n=a("b3d1"),l=a("8bc3"),d=a("9e6a"),c=a("f9dd"),g=a("9c79"),p=a("5d1e"),h=a("e683"),m=a("0c6e"),u=a("bc3a"),f=a.n(u),w=a("1b0d"),L=a("3adf"),b=a("95df"),I=a("6444"),v={name:"PortalsSignIn",components:{AuthLayout:o["a"],ValidationObserver:r["a"],ValidationProvider:r["b"],TextField:n["a"],PasswordField:l["a"],EmailAuthentication:d["a"],MobileAuthentication:c["a"],OrDivider:g["a"],SocialAuths:p["a"],FormFieldError:h["a"],Email:L["a"],Password:b["a"]},props:{tenantId:{type:String,required:!0},portalId:{type:String,required:!0}},data(){return{portalWidth:"720px",submissionModal:!1,isFocused:!1,title:"Track Portal",description:"To submit and track your request",settings:{},loginType:"",username:"",password:"",socialLogin:[],isLoading:!1,error:"",email:"",normalLogin:!1,passwordTypes:"",masterSocialLogin:!1}},computed:{_passwordHint(){return m["a"]},checkTenant(){let t=location.origin;return"https://edmsuat.sobhaapps.com"===t||"https://edms.sobhaapps.com"===t}},watch:{portalId:{immediate:!0,handler(){this.portalId&&this.getPortal()}}},methods:{toggleWidth(){this.portalWidth="100%"===this.portalWidth?"720px":"100%"},logged(){let t=location.origin;("https://demo.ezofis.com"===t||"http://52.172.32.88"===t)&&1==this.portalId?this.$router.push({name:"portals-access-custom"}):this.$router.push({name:"portals-access"})},userFieldError(t){this.error=t},showSocialLogin(){this.masterSocialLogin=!0},async getPortal(){this.$store.commit("showLoadingBar");try{const t=await f()({url:`https://appuat.ezofis.com/ezofisapi/api/portal/withoutToken/${this.tenantId}/${this.portalId}`,method:"GET"}),{status:i,data:a}=t;if(this.$store.commit("hideLoadingBar"),200!==i)throw t;a&&(this.title=a.name,this.description=a.description,a.settingsJson?(this.settings=JSON.parse(a.settingsJson),this.loginType=this.settings.authentication.loginType||"EMAIL_LOGIN",this.passwordTypes=this.settings.authentication.passwordTypes,this.socialLogin=this.settings.authentication.socialLogin):this.loginType="EMAIL_LOGIN")}catch(t){this.$alert.error("Error fetching portal"),console.error(t)}},async validate(){const t=await this.$refs.form.validate();t&&this.signIn()},async validateEmail(){const t=await this.$refs.tenant.validate();if(!t)return;this.isLoading=!0;const i={email:this.email},{error:a,data:s}=await w["a"].emailValidate(1,i);if(a)return this.error=a,void(this.isLoading=!1);this.isLoading=!1,"User"===s?this.normalLogin=!0:"ADUser"===s&&this.microsoftSignIn()},async signIn(){this.isLoading=!0;const t={tenantId:this.tenantId,portalId:this.portalId,email:this.username,password:this.password,formId:this.settings.authentication.formId,emailColumn:this.settings.authentication.usernameField,passwordColumn:this.settings.authentication.passwordField,nameColumn:this.settings.authentication.firstnameField},{error:i}=await w["a"].portalLogin(t);if(i)return this.error=i,void(this.isLoading=!1);this.logged()},async validateSignIn(){const t=await this.$refs.form.validate();t&&this.signInPortal()},async signInPortal(){this.isLoading=!0;const t={email:this.email,password:this.password,loggedFrom:"WEB",portalId:this.portalId},{error:i}=await w["a"].login(t,this.tenantId);if(i)return this.error=i,void(this.isLoading=!1);this.$router.push({name:"portals-access"})},async microsoftSignIn(){let t="315d2d09-9633-419e-8e85-18b747eb5be5",i=location.origin;"https://edmsuat.sobhaapps.com"===i?t="9db78754-f584-459d-a04d-f5a6d9b1e2cf":"https://edms.sobhaapps.com"===i&&(t="a403995e-94b6-4805-bee7-2fa606a751bd");const a=new I["a"]({auth:{clientId:t,redirectUri:i}});await a.loginPopup({scopes:["user.read"],loginHint:this.email});const s=a.getAccount();let e=s.userName;console.log(e),this.isLoading=!0;const o={tenantId:this.tenantId,email:e,loggedFrom:"WEB"},{error:r}=await w["a"].socialLogin(o);if(r)return this.error=r,void(this.isLoading=!1);this.logged()}}},y=v,T=(a("633f"),a("2877")),S=Object(T["a"])(y,s,e,!1,null,"7f6204bb",null);i["default"]=S.exports},d09f:function(t,i,a){}}]);
//# sourceMappingURL=portal-sigin.50f636ce.js.map
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["portal-access","custom-form~external-request~portal-accesss-custom"],{"00c2":function(t,e,s){t.exports=s.p+"img/name-light.137e40b6.png"},"0698":function(t,e,s){},"0be7":function(t,e,s){},"0c04":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"addTask"}},[e("Sheet",{attrs:{value:t.value,width:t.taskWidth,"no-padding":""},on:{input:t.closeSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._t("title",(function(){return[t._v(t._s(t.title))]}))]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:t.isMaximized?"eva-collapse":"eva-expand"},on:{click:t.toggleWidth}})]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"row",attrs:{id:"content-wrapper"}},[e("div",{staticClass:"col",attrs:{id:"task-form-view"}},[e("BaseScrollbar",{staticClass:"q-pa-md",attrs:{height:"calc(100vh - 60px)"}},[e("RenderForm",{attrs:{"no-padding":"",panels:t.panels,"secondary-panels":t.secondaryPanels,"form-settings":t.formSettings,"form-model":t.taskModel,"is-readonly":"VIEW"===t.mode},on:{save:t.saveTask}})],1)],1),e("div",{staticClass:"col-auto q-mr-sm leftBorder"},[t._l(t.tabs,(function(s){return e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:s.label,expression:"tab.label",modifiers:{left:!0}}],key:s.id,staticClass:"tabButtons",attrs:{"is-flat":"","no-border":"",icon:s.icon,color:"primary"},on:{click:function(e){return t.showLinks(s.value)}}},[s.count?e("span",{staticClass:"badge"},[t._v(t._s(s.count)+" ")]):t._e()])})),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"workflows",expression:"'workflows'",modifiers:{left:!0}}],staticClass:"tabButtons",attrs:{"is-flat":"","no-border":"",icon:"o_account_tree",color:"primary"}},[e("q-menu",{attrs:{"transition-show":"scale","transition-hide":"scale",anchor:"bottom end",self:"top right"}},[e("BaseScrollbar",{staticClass:"q-pb-sm",attrs:{width:"240px"}},t._l(t.taskWorkflowList,(function(s){return e("ListItem",{key:s.id,attrs:{icon:"mdi-sitemap",label:s.label},on:{click:function(e){return t.getForm(s)}}})})),1)],1)],1)],2)])]},proxy:!0}],null,!0)}),e("Sheet",{attrs:{width:t.taskWidth,"has-footer":""},on:{input:t.closeAddTaskSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._t("title",(function(){return[t._v(t._s(t.headerTitle))]}))]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:t.isMaximized?"eva-collapse":"eva-expand"},on:{click:t.toggleWidth}})]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"row",attrs:{id:"content-wrapper"}},[e("div",{staticClass:"col",attrs:{id:"form-view"}},[e("BaseScrollbar",{staticClass:"q-pa-md",attrs:{height:"calc(100vh - 145px)"}},[e("RenderForm",{attrs:{"no-padding":"","workflow-id":t.workflowFormId,panels:t.addWorkflowForm.panels,"secondary-panels":t.addWorkflowForm.secondaryPanels,"form-settings":t.addWorkflowForm.settings,"workflow-form-model":t.workflowFormModel,"save-action":t.saveAction},on:{"update:workflowFormModel":function(e){t.workflowFormModel=e},"update:workflow-form-model":function(e){t.workflowFormModel=e},"update:saveAction":function(e){t.saveAction=e},"update:save-action":function(e){t.saveAction=e}}})],1)],1),e("div",{staticClass:"col-auto q-mr-sm leftBorder"},t._l(t.tabs,(function(s){return e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:s.label,expression:"tab.label",modifiers:{left:!0}}],key:s.id,staticClass:"tabButtons",attrs:{"is-flat":"","no-border":"",icon:s.icon,color:"primary"},on:{click:function(e){return t.showLinks(s.value)}}},[s.count?e("span",{staticClass:"badge"},[t._v(t._s(s.count)+" ")]):t._e()])})),1)])]},proxy:!0},{key:"footer",fn:function(){return[t.actions?e("div",{staticClass:"footer row"},[t._l(t.actions,(function(s){return[e("BaseButton","Approve"===s||"Complete"===s||"Rightsize"===s?{key:s,staticClass:"q-ml-md",attrs:{label:s,color:"positive"},on:{click:function(e){return t.validateRequest(s)}}}:"Reject"===s||"Terminate"===s||"Force Close"===s?{key:s,staticClass:"q-ml-md",attrs:{label:s,color:"red"},on:{click:function(e){return t.validateRequest(s)}}}:"Forward"===s||"Reply"===s?{key:s,staticClass:"q-ml-md",attrs:{label:s,color:"orange"},on:{click:function(e){return t.validateRequest(s)}}}:{key:s,staticClass:"q-ml-md",attrs:{label:s},on:{click:function(e){return t.validateRequest(s)}}})]}))],2):t._e()]},proxy:!0}],null,!0),model:{value:t.addTaskSheet,callback:function(e){t.addTaskSheet=e},expression:"addTaskSheet"}}),e("Sheet",{attrs:{width:"30vw","sub-actions":!!t.attachmentList.length,upload:!0},on:{input:t.closeAttachmentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Attachments ")]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:t.getAttachments}})]},proxy:!0},{key:"upload",fn:function(){return[e("div",{staticClass:"hint",on:{click:function(e){return t.$refs.attachments.click()}}},[e("BaseIcon",{staticClass:"icon",attrs:{name:"eva-cloud-upload-outline",size:"32px",color:"blue"}}),e("div",{staticClass:"title text-blue"},[t._v("UPLOAD FILES")]),e("div",{staticClass:"description"},[t._v("Click here to choose files and upload")])],1)]},proxy:!0},{key:"subActions",fn:function(){return[[e("CheckboxField",{staticClass:"col-auto q-pt-sm q-pb-sm",on:{input:t.fileSelectAll},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}}),t._v(" Select All ")],e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"mail share",expression:"'mail share'",modifiers:{top:!0}}],staticClass:"q-ml-sm",attrs:{"is-disabled":!t.selectedFileCount,icon:"mdi-email-send-outline",color:"secondary","no-border":"","is-flat":"",size:"18px"},on:{click:t.documentShare}}),(t.selectedFileCount,t._e())]},proxy:!0}]),model:{value:t.attachmentSheet,callback:function(e){t.attachmentSheet=e},expression:"attachmentSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("input",{ref:"attachments",staticClass:"hidden",attrs:{type:"file"},on:{change:t.uploadAttachments}}),t._l(t.attachmentList,(function(s){return[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:s.checked?"eva-checkmark-circle-2":"eva-radio-button-off-outline",color:"secondary"},on:{click:function(t){s.checked=!s.checked}}})],1),e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openFile(s)}}},[t._v(" "+t._s(s.name)+" ")]),e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"delete",expression:"'delete'",modifiers:{top:!0}}],attrs:{icon:"eva-trash-2-outline",color:"red","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.attachmentDelete(s)}}})],1)]),e("div",{staticClass:"meta"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.createdBy?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(s.createdByEmail))])]:t._e(),s.size?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(t.fileSize(s.size)))])]:t._e()],2)])]}))],2)]),e("Sheet",{attrs:{width:"30vw",height:"80vh","custom-height":"30"},on:{input:t.closeCommentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments ")]},proxy:!0}]),model:{value:t.commentsSheet,callback:function(e){t.commentsSheet=e},expression:"commentsSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 155px)"}},[t._l(t.commentsList,(function(s,i){return[e("q-chat-message",{key:i,staticClass:"q-ma-sm",attrs:{name:s.createdBy===t.$store.state.session.id?"me":s.createdByEmail,text:[s.comments],"text-html":"",sent:s.createdBy===t.$store.state.session.id,stamp:t.lastCommentDuration(s),"bg-color":s.createdBy===t.$store.state.session.id?"primary-1":"secondary-1"}})]}))],2)],1),e("div",{staticClass:"col q-pa-sm borderTop"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("TextAreaField",{attrs:{"auto-focus":"",placeholder:"Type a new comment..."},model:{value:t.commentText,callback:function(e){t.commentText=e},expression:"commentText"}})],1),e("div",{staticClass:"col-auto",staticStyle:{margin:"auto"}},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Post Comments",expression:"'Post Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm commentAction",attrs:{icon:"eva-paper-plane-outline",color:"primary-11",size:"16px","rotate-class":"rotate-45"},on:{click:t.saveComment}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Advanced Comments",expression:"'Advanced Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm q-mt-sm commentAction",attrs:{icon:"mdi-comment-text-multiple",color:"primary-11",size:"16px"},on:{click:function(e){t.advancedCommentsSheet=!0}}})],1)])])]),e("Sheet",{attrs:{"no-padding":"",width:"100vw"},on:{input:function(e){t.fileSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"attachmentFileHeader"},[e("div",{staticClass:"avatar q-ml-sm"},[e("FileIcon",{attrs:{"mime-type":t.fileType(t.selectedFile.name)}})],1),e("div",{staticClass:"q-ml-md"},[e("div",{staticClass:"filename"},[t._v(" "+t._s(t.selectedFile.name)+" ")]),e("div",{staticClass:"meta"},[e("div",[t._v("Archived At: "+t._s(t.$day.format(t.selectedFile.createdAt)))]),e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v("Archived By: "+t._s(t.selectedFile.createdByEmail))]),t.selectedFile.size?e("div",[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),t._v(" File Size: "+t._s(t.fileSize(t.selectedFile.size))+" ")],1):t._e()],1)])])]},proxy:!0}]),model:{value:t.fileSheet,callback:function(e){t.fileSheet=e},expression:"fileSheet"}},[e("div",{staticClass:"attachmentFileFrame"},[e("div",{staticClass:"file-list"},[e("iframe",{ref:"myFiles",attrs:{id:"file-frame",src:t.fileLink(),frameborder:"0"}})])])]),e("Sheet",{attrs:{width:"30vw"},on:{input:t.closeTaskSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Workflows ")]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Add Workflows",expression:"'Add Workflows'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-plus",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getworkflowForm(t.workflowFormId)}}})]},proxy:!0}]),model:{value:t.taskSheet,callback:function(e){t.taskSheet=e},expression:"taskSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[t._l(t.processInfo,(function(s){return[e("div",{key:s.id,staticClass:"taskEntries"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-auto q-mr-md",staticStyle:{"margin-top":"3px"},on:{click:function(e){return t.getWorkflowAudit(s.requestNo)}}},[t._v(" Request No: "+t._s(s.requestNo)+" ")]),s.actionUser?[e("q-chip",{attrs:{size:"10px",color:"yellow","text-color":"white"}},[t._v(" "+t._s(s.actionUser)+" ")])]:t._e(),e("q-chip",{attrs:{size:"10px",color:t.getColor(s.flowStatus),"text-color":"white"}},[t._v(" "+t._s("0"===s.flowStatus?"Open":"Completed")+" ")])],2)]),e("div",{staticClass:"meta row"},[e("div",{staticClass:"col-12"},[t._v(" Raised By: "+t._s(s.raisedBy)+" "),e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),t._v(" Raised At: "+t._s(t.$day.format(s.raisedAt))+" ")],1)])])]}))],2)]),e("Sheet",{attrs:{width:"100vw","has-footer":"","no-padding":""},on:{input:function(e){t.processSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" "+t._s(t.headerTitle)+" ")]},proxy:!0}]),model:{value:t.processSheet,callback:function(e){t.processSheet=e},expression:"processSheet"}},[e("div",{staticClass:"row",attrs:{id:"content-wrapper"}},[e("div",{staticClass:"col",attrs:{id:"form-view"}},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 145px)"}},[e("RenderForm",{attrs:{"form-id":t.formIdName,panels:t.addWorkflowForm.panels,"secondary-panels":t.addWorkflowForm.secondaryPanels,"form-settings":t.addWorkflowForm.settings,"form-model":t.formModel,"save-action":t.saveAction,"workflow-form-model":t.workflowFormModel},on:{"update:saveAction":function(e){t.saveAction=e},"update:save-action":function(e){t.saveAction=e},"update:workflowFormModel":function(e){t.workflowFormModel=e},"update:workflow-form-model":function(e){t.workflowFormModel=e}}})],1)],1),e("div",{staticClass:"col-auto q-mr-sm leftBorder"},[t._l(t.tabs,(function(s){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:s.label,expression:"tab.label",modifiers:{left:!0}}],key:s.id,staticClass:"tabButtons",attrs:{"is-flat":"","no-border":"",icon:s.icon,color:"primary"},on:{click:function(e){return t.showLinks(s.value)}}},[s.count?e("span",{staticClass:"badge"},[t._v(t._s(s.count)+" ")]):t._e()])]}))],2)])]),e("Modal",{attrs:{width:"60vw",height:"80vh","has-footer":""},on:{input:function(e){t.advancedCommentsSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments")]},proxy:!0},{key:"default",fn:function(){return[e("TextBuilderField",{model:{value:t.advancedCommentText,callback:function(e){t.advancedCommentText=e},expression:"advancedCommentText"}})]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{attrs:{label:"Post",icon:"eva-paper-plane-outline",color:"primary"},on:{click:t.saveAdvancedComment}})]},proxy:!0}]),model:{value:t.advancedCommentsSheet,callback:function(e){t.advancedCommentsSheet=e},expression:"advancedCommentsSheet"}}),e("EmailSharing",{attrs:{"repository-id":t.repositoryId,"file-list":t.selectedFileList},on:{"update:fileList":function(e){t.selectedFileList=e},"update:file-list":function(e){t.selectedFileList=e}},model:{value:t.emailSharingSheet,callback:function(e){t.emailSharingSheet=e},expression:"emailSharingSheet"}})],1)},o=[],a=(s("14d9"),s("caad"),s("381e")),r=s("4bc4"),n=s("869e"),l=s("6df3"),c=s("1b0d"),d=s("9bc4"),h=s("fa1f"),m=s("a7d2"),u=s("dd90"),f=s("bc3a"),p=s.n(f),v=s("cade"),y=s("695e"),w=s("6a70"),g=s("2f62"),b=s("5e23"),k={name:"AddTask",components:{Sheet:a["a"],RenderForm:r["a"],FileIcon:h["a"],CheckboxField:n["a"],TextAreaField:l["a"],ListItem:v["a"],TextBuilderField:y["a"],Modal:w["a"],EmailSharing:b["a"]},props:{value:{type:Boolean,default:!1},formSettings:{type:Object,required:!0},panels:{type:Array,required:!0},secondaryPanels:{type:Array,default:()=>[]},formId:{type:Number,default:0},taskModel:{type:Object,default:()=>{}},mode:{type:String,default:""},taskName:{type:String,default:""},repositoryId:{type:Number,default:0},workflowTask:{type:Boolean,default:!1},taskWorkflowList:{type:Array,default:()=>[]},selectedTask:{type:Object,default:()=>{}},documentTask:{type:Boolean,default:!1},repositoryFile:{type:Object,default:()=>{}}},data(){return{taskWidth:"720px",tabs:[{id:this.$nano.id(),label:"attachments",value:"ATTACHMENTS",icon:"mdi-attachment",count:0},{id:this.$nano.id(),label:"comments",value:"COMMENTS",icon:"mdi-comment-text-outline",count:0},{id:this.$nano.id(),label:"history",value:"HISTORY",icon:"mdi-history",count:0},{id:this.$nano.id(),label:"print",value:"PRINT",icon:"mdi-printer",count:0}],attachmentSheet:!1,addTaskSheet:!1,taskSheet:!1,commentsSheet:!1,commentText:"",commentsList:[],selectAll:!1,attachmentLoad:null,attachmentList:[],fileSheet:!1,selectedFile:{},actions:[],workflowsSheet:!0,workflowList:[],saveAction:"",workflowId:0,addWorkflowForm:[],workflowPanels:[],form:[],workflowName:"",workflowDescription:"",workflowFormId:0,workflowFormModel:{},processId:0,transactionId:0,workflowDetails:[],countWorkflow:0,processInfo:[],workflowFormTaskList:{},formList:{},formStage:{},processSheet:!1,formDetails:{},formIdName:"",formModel:{},headerTitle:"",advancedCommentsSheet:!1,advancedCommentText:"",emailSharingSheet:!1,selectedFileList:[]}},computed:{...Object(g["c"])(["LoadingBarPage"]),isMaximized(){return"100vw"===this.taskWidth},title(){return"VIEW"===this.mode?"View Task":"EDIT"===this.mode?"Edit Task":"FORWARD"===this.mode?"Forward Task":"COPY"===this.mode?"Copy Task":"Add Task"},formName(){return this.formSettings.general.name},formDescription(){return this.formSettings.general.description},selectedFileCount(){let t=this.attachmentList.filter(t=>t.checked).length;return t},scrollbarHeight(){const t=36*this.columns.length;return t>216?"276px":t+58+"px"}},watch:{taskModel:{immediate:!0,handler(){this.taskModel.id&&(this.attachmentList=[],this.getComments(),this.getAttachments())}},workflowFormModel:{deep:!0,immediate:!0,handler(){this.workflowFormModel&&this.saveAction&&this.initiateRequest()}},attachmentSheet:{immediate:!0,handler(){this.attachmentSheet&&this.taskModel.id||clearInterval(this.attachmentLoad)}}},methods:{toggleWidth(){this.taskWidth="100vw"===this.taskWidth?"720px":"100vw"},closeSheet(){this.$emit("close",!1)},closeAttachmentsSheet(){this.attachmentSheet=!1},closeAddTaskSheet(){this.addTaskSheet=!1},closeTaskSheet(){this.taskSheet=!1},closeCommentsSheet(){this.closeCommnetsSheet=!1},getColor(t){return"0"===t?"orange":"1"===t||"Medium"===t?"green":"primary"},showLinks(t){"ATTACHMENTS"===t?this.attachmentSheet=!0:"COMMENTS"===t?this.commentsSheet=!0:"HISTORY"===t?this.$emit("history",this.formList[0].value[0].processId,this.formList[0].workflowId,this.formList[0].value[0].requestNo):"PRINT"===t&&window.print()},lastCommentDuration(t){const e=t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt),s=new Intl.RelativeTimeFormat("en"),i={years:31536e3,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1},o=(e.getTime()-Date.now())/1e3;for(let a in i)if(i[a]<Math.abs(o)){const t=o/i[a];return s.format(Math.round(t),a)}},fileSelectAll(){this.attachmentList=this.attachmentList.map(t=>({...t,checked:this.selectAll}))},showHistory(){},fileType(t){if(t)return t.split(".").reverse()[0].slice(0,4)},fileSize(t){return Object(m["a"])(t)},fileLink(){let t=location.origin.replace("http://localhost:8080","http://52.172.32.88");if(this.selectedFile.name){let e=this.selectedFile.name.split(".").pop();if(this.selectedFile.initiate){let s="";if(Object(u["d"])(e))s="https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?"https://ag-appsvc04.azurewebsites.net/web/viewer.html":"https://trial.ezofis.com"===t?"https://trial.ezofis.com/docsviewer/index.html":"https://app.ezofis.com"===t?"https://ezdocsviewer.azurewebsites.net/web/viewer.html":t+"/PDFViewer/web/viewer.html";else{if("http://52.172.32.88"!==t)return`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/1`;s="http://52.172.32.88/DocsViewer/index.html"}return`${s}?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=1`}{let s="";if(Object(u["d"])(e))s="https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?"https://ag-appsvc04.azurewebsites.net/web/viewer.html":"https://trial.ezofis.com"===t?"https://trial.ezofis.com/docsviewer/index.html":"https://app.ezofis.com"===t?"https://ezdocsviewer.azurewebsites.net/web/viewer.html":t+"/PDFViewer/web/viewer.html";else{if(Object(u["b"])(e)||"http://52.172.32.88"!==t)return`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`;s="http://52.172.32.88/DocsViewer/index.html"}return`${s}?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&type=2&filename=${this.selectedFile.name}`}}},openFile(t){this.selectedFile=t,this.fileSheet=!0},async documentShare(){this.selectedFileList=[],this.attachmentList.forEach(t=>{t.checked&&this.selectedFileList.push({id:t.id,name:t.name})}),this.emailSharingSheet=!0},async saveTask(t){const e=["itemid","createdBy","createdAt","modifiedBy","modifiedAt","icon","buttonAction","formId","status","color","link","selected","isDeleted","createdByEmail","modifiedByEmail","emailStatus","expandSubworkflow"],s=Object(d["a"])(t,e);try{this.$store.commit("showLoadingBarPage");const{id:t,...e}=s;let i=0;i="COPY"===this.mode?0:t||0;let o={};if(i)o={fields:e};else{let t=[];this.attachmentList.length&&this.attachmentList.forEach(e=>{t.push(e.id)}),o={fields:e,task:{comments:this.commentsList,fileIds:t}}}const{data:a,error:r}=await c["g"].saveFormEntry(this.formId,i,o);if(this.workflowDetails.length&&this.linkTaskWorkflowProcess(a.output),r)return void this.$alert.error(r);t?this.$alert.success(this.taskName+" edited successfully"):(this.documentTask&&this.linkTaskDocument(a.output),this.$alert.success("New task added successfully")),this.getUsers(o.fields),this.closeSheet(),this.workflowTask||this.documentTask?this.$emit("addEntry",this.formId,a.output):this.$emit("refresh",this.workflowId)}catch(i){console.log(i)}finally{this.$store.commit("hideLoadingBarPage")}},async linkTaskDocument(t){let e={wFormId:this.formId,formEntryId:t,fileInfo:{repositoryId:this.repositoryFile.repositoryId,itemId:this.repositoryFile.id}};const{error:s}=await c["g"].linkTaskDocument(e);s&&this.$alert.error(s)},async getComments(){this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=0)}),this.commentsList=[],this.$store.commit("showLoadingBar");const{error:t,payload:e}=await c["g"].getFormComments(this.formId,this.taskModel.id);this.$store.commit("hideLoadingBar"),t?this.$alert.error(t):e.length&&(this.commentsList=e,this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=this.commentsList.length)}))},async saveComment(){if(this.commentText)if(this.taskModel.id){this.$store.commit("showLoadingBar");const{error:t}=await c["g"].insertFormComment(this.formId,this.taskModel.id,{comments:this.commentText});if(this.$store.commit("hideLoadingBar"),t)return void this.$alert.error(t);this.commentText="",this.getComments()}else this.commentsList.push({comments:this.commentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id}),this.commentText=""},async saveAdvancedComment(){if(this.advancedCommentText)if(this.taskModel.id){this.$store.commit("showLoadingBar");const{error:t}=await c["g"].insertFormComment(this.formId,this.taskModel.id,{comments:this.advancedCommentText});if(this.$store.commit("hideLoadingBar"),t)return void this.$alert.error(t);this.advancedCommentText="",this.advancedCommentsSheet=!1,this.getComments()}else this.commentsList.push({comments:this.advancedCommentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id}),this.advancedCommentText="",this.advancedCommentsSheet=!1},async uploadAttachments(t){if(this.taskModel.id){const s=t.target.files[0];this.$store.commit("showLoadingBar");const i=new FormData;i.append("formId",this.formId),i.append("repositoryId",this.repositoryId),i.append("entryId",this.taskModel.id),i.append("file",s);let o=t.target.files[0].name;const a=o.split(".").pop();if(!Object(u["a"])(a))return void this.$alert.info("This file format is not supported");try{const e=await p()({url:"https://appuat.ezofis.com/ezofisapi/api/form/taskAttachmentWithEntryId",method:"POST",data:i,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}}),{status:s,data:o}=e;if(this.$store.commit("hideLoadingBar"),t.target.value="",200!==s||!o)throw e;this.$alert.success("Document attached")}catch(e){this.$store.commit("hideLoadingBar"),this.$alert.error("Error uploading file"),console.error(e)}this.attachmentLoad=setInterval(()=>this.getAttachments(),5e3)}else{this.$store.commit("showLoadingBar");const s=t.target.files[0],i=new FormData;i.append("file",s),i.append("formId",this.formId),i.append("repositoryId",this.repositoryId);let o=t.target.files[0].name;const a=o.split(".").pop();if(!Object(u["a"])(a))return void this.$alert.info("This file format is not supported");try{const e=await p()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/upload",method:"POST",data:i,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}}),{status:o,data:a}=e;if(this.$store.commit("hideLoadingBar"),t.target.value="",200!==o)throw"Invalid response";let r=JSON.parse(a);this.attachmentList.push({id:Number(r.fileId),name:s.name,createdAt:(new Date).toISOString(),createdByEmail:this.$store.state.session.email,size:s.size,initiate:!0,checked:!1})}catch(e){this.$store.commit("hideLoadingBar"),console.error(e),this.$alert.error("error attaching file")}}},async getAttachments(){this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=0)});let t=this.attachmentList.length;this.$store.commit("showLoadingBar");const{error:e,payload:s}=await c["g"].getFormAttachments(this.formId,this.taskModel.id);this.$store.commit("hideLoadingBar"),e?this.$alert.error(e):s.length?(t!==s.length&&(this.attachmentList=s.map(t=>({...t,checked:!1})),clearInterval(this.attachmentLoad)),this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length)})):this.attachmentList=[]},async attachmentDelete(t){if(this.$store.commit("showLoadingBar"),t.initiate){const{error:e}=await c["r"].deleteUploadedFiles([t.id]);if(e)return void this.$alert.error(e);this.$store.commit("hideLoadingBar"),this.attachmentList=this.attachmentList.filter(e=>e.id!==t.id)}else{const{error:e}=await c["p"].fileDelete(t.repositoryId,t.id);if(e)return void this.$alert.error(e);this.$store.commit("hideLoadingBar"),this.getAttachments()}},validateRequest(t){this.saveAction=t},async initiateRequest(){let t={};t={workflowId:this.workflowId,transactionId:0,review:this.saveAction,formData:{formId:this.workflowFormId,formEntryId:this.form.entryCount,fields:this.workflowFormModel}},this.$store.commit("showLoadingBarSave");const{error:e,payload:s}=await c["t"].processTransaction(t);this.$store.commit("hideLoadingBarSave"),this.saveAction="",e?this.$alert.error(e):(this.$alert.success(s.requestNo+" Request Initiated"),this.workflowDetails.push({workflowId:this.workflowId,processId:s.processId,transactionId:s.transactionId}),this.selectedTask.id&&this.linkTaskWorkflowProcess(this.selectedTask.id),this.closeAddTaskSheet(),this.$emit("refresh",this.workflowId))},async getForm(t){if(this.workflowId=t.id,this.headerTitle=t.stage,this.actions=t.actions,this.selectedTask.formId&&this.selectedTask.id&&await this.getWorkflowList(this.workflowId),t.formId)if(this.workflowFormId=t.formId,this.processInfo.length)this.countWorkflow=this.processInfo.length,this.taskSheet=!0;else{const{error:t,payload:e}=await c["g"].getForm(this.workflowFormId);if(t)return void this.$alert.error(t);e&&(this.form=e,this.workflowName=this.form.name,this.workflowDescription=this.form.description,this.addWorkflowForm=JSON.parse(e.formJson),this.workflowPanels=this.addWorkflowForm.panels,this.addTaskSheet=!0)}},async getworkflowForm(t){this.closeTaskSheet();const{error:e,payload:s}=await c["g"].getForm(t);this.workflowFormId=t,e?this.$alert.error(e):s&&(this.form=s,this.workflowName=this.form.name,this.workflowDescription=this.form.description,this.addWorkflowForm=JSON.parse(s.formJson),this.workflowPanels=this.addWorkflowForm.panels,this.addTaskSheet=!0)},async getworkflowDetailsForm(t){const{error:e,payload:s}=await c["g"].getForm(t);e?this.$alert.error(e):s&&(this.form=s,this.workflowName=this.form.name,this.workflowDescription=this.form.description,this.addWorkflowForm=JSON.parse(s.formJson),this.workflowPanels=this.addWorkflowForm.panels,this.processSheet=!0,this.$store.commit("hideLoadingBarPage"))},async linkTaskWorkflowProcess(t){let e={};e={wFormId:this.formId,formEntryId:t,workflow:this.workflowDetails};const{error:s}=await c["g"].linkTaskWorkflowProcess(e);s&&this.$alert.error(s)},async getWorkflowList(t){let e={};e={wId:t,fId:this.selectedTask.formId,entryId:this.selectedTask.id};const{error:s,payload:i}=await c["g"].getWorkflowTaskList(t,this.selectedTask.formId,this.selectedTask.id,e);this.workflowFormTaskList=i,i.processInfo&&(this.processInfo=i.processInfo),s&&this.$alert.error(s)},async getWorkflowAudit(t){this.$store.commit("showLoadingBarPage");const{error:e,payload:s}=await c["o"].getWorkflowData(this.workflowId,{filterBy:[{groupCondition:"",filters:[{criteria:"requestNo",condition:"IS_EQUALS_TO",value:t}]}],currentPage:1,itemsPerPage:10,mode:""}),{data:i,meta:o}=s;if(this.formList=i||{},this.formStage=o,this.formList[0].value[0].formData){let t=Object.keys(this.formList[0].value[0].formData.fields),e={};t.forEach(t=>{e[t]=this.validateTypeValue(this.formList[0].value[0].formData.fields[t])}),this.formModel=e}this.headerTitle=""+this.formList[0].value[0].name,this.formIdName=String(this.formList[0].value[0].formData.formId),this.getworkflowDetailsForm(this.formIdName),e&&this.$alert.error(e)},validateTypeValue(t){if(t)try{var e=JSON.parse(t);if("object"===typeof e)return e}catch(s){return t}return t},async getUsers(t){const{error:e,payload:s}=await c["s"].getUserList();if(e)return void this.$alert.error("Error fetching users");let i={id:0,title:t["e_NFnW0JxrLpZxqPeJS7K"],status:t["11m7YRT-7kdLx-g6iGojc"],remarks:t["2XOJMCR_DVb-5TwVPVdEX"],category:"TASK",createdBy:t["pM6Vly-JRlfroRrziE1jr"],lastActionBy:this.$store.state.session.email};const o=i.createdBy,a=s.filter(t=>o.includes(t.value)),r=a.map(t=>t.id);r.forEach(t=>{const e={...i,createdBy:t};this.insertNotification(e)}),console.log("email",a,r)},async insertNotification(t){const{error:e}=await c["b"].insertNotification(t);e&&this.$alert.error(e)}}},I=k,C=(s("a4c9"),s("2877")),S=s("4e73"),_=s("8169"),T=s("cb32"),A=s("b047"),F=s("93dc"),L=s.n(F),x=Object(C["a"])(I,i,o,!1,null,"0b56d901",null);e["a"]=x.exports;L()(x,"components",{QMenu:S["a"],QChatMessage:_["a"],QAvatar:T["a"],QChip:A["a"]})},"0ce8":function(t,e,s){},"109a":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{style:{width:t.portalWidth},attrs:{id:"portals-access"}},[e("div",{staticClass:"row portal-header"},[t.isLogoRequired?e("div",{staticClass:"col-auto logo q-pa-md"},[e("img",{attrs:{src:t._logo,height:t.logoHeight}})]):t._e(),e("div",{staticClass:"header col"},[e("div",{staticClass:"col text-center"},[e("div",{staticClass:"title-1"},[t._v(t._s(t.title))])]),e("ThemeSwitcher",{staticClass:"q-ml-sm",attrs:{"no-border":!1}}),e("BaseActionButton",{staticClass:"q-ml-sm",attrs:{"is-flat":"",icon:"eva-power-outline","no-border":""},on:{click:t.logOut}})],1)]),e("Sheet",{attrs:{width:"100vw","has-footer":"","no-padding":""},on:{input:function(e){t.processSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(t._s(t.headerTitle)+" ")]},proxy:!0},{key:"actions",fn:function(){return["DOCUMENT"!==t.workflow.initiatedBy?[t.mandatory.filledValue||t.mandatory.nonFilledValue?[e("q-circular-progress",{staticClass:"q-mr-sm",attrs:{"show-value":"","font-size":"12px",value:t.mandatoryFilling,size:"lg",thickness:.22,color:"primary","track-color":"grey-3"}},[t._v(" "+t._s(t.mandatoryFilling)+"% ")])]:t._e(),t.mandatory.filledValue?e("div",{staticClass:"chip-success q-mr-sm"},[e("div",{},[t._v(t._s(t.mandatory.filledValue)+" ready")])]):t._e(),t.mandatory.nonFilledValue?e("div",{staticClass:"chip-warning",on:{click:t.checkFormValidation}},[e("div",{},[t._v(t._s(t.mandatory.nonFilledValue)+" need to work")])]):t._e()]:t._e(),t.mandatoryDocument.length?[e("div",{staticClass:"chip-warning cursor-pointer",on:{click:function(e){t.attachmentSheet=!0}}},[e("div",{},[t._v(t._s(t.mandatoryDocument.length)+" document required")])])]:t._e(),!t.formView&&Object.keys(t.selectedProcess).length&&0===t.actions.length?e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Form View",expression:"'Form View'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"mdi-form-select"},on:{click:function(e){t.formView=!0}}}):Object.keys(t.selectedProcess).length&&0===t.actions.length?e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Details View",expression:"'Details View'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"mdi-table-column"},on:{click:function(e){t.formView=!1}}}):t._e()]},proxy:!0},t.actions.length?{key:"footer",fn:function(){return[e("BaseButton",{staticClass:"q-ml-md",attrs:{label:"Save",color:"secondary"},on:{click:function(e){t.btnAction=!0,t.saveAction="Save"}}}),t._l(t.actions,(function(s){return[e("BaseButton",{key:s,staticClass:"q-ml-md col-auto",attrs:{label:s},on:{click:function(e){t.btnAction=!0,t.saveAction=s}}})]}))]},proxy:!0}:null],null,!0),model:{value:t.processSheet,callback:function(e){t.processSheet=e},expression:"processSheet"}},[e("div",{staticClass:"row",attrs:{id:"content-wrapper"}},[t.formId?e("div",{staticClass:"col",attrs:{id:"form-view"}},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 145px)"}},[e("RenderForm",{attrs:{"form-id":t.formId,panels:t.panels,"secondary-panels":t.secondaryPanels,"form-settings":t.formSettings,"form-model":t.formModel,"workflow-actions":[],"save-action":t.saveAction,"workflow-form-model":t.workflowFormModel,"workflow-model":t.workflowModel,"is-readonly":t.formEditAccess,"form-edit-controls":t.formEditControls,"readonly-controls":t.readonlyControls,"form-visibility-access":t.formVisibilityAccess,"form-secure-controls":t.formSecureControls,"enable-controls":t._enableControls,"form-upload-files":t.formUploadFiles,"has-check-form-validate":t.hasCheckFormValidate,"ocr-result":t.ocrResult,"check-list":t.checkList},on:{"update:saveAction":function(e){t.saveAction=e},"update:save-action":function(e){t.saveAction=e},"update:workflowFormModel":function(e){t.workflowFormModel=e},"update:workflow-form-model":function(e){t.workflowFormModel=e},"update:workflowModel":function(e){t.workflowModel=e},"update:workflow-model":function(e){t.workflowModel=e},"update:hasCheckFormValidate":function(e){t.hasCheckFormValidate=e},"update:has-check-form-validate":function(e){t.hasCheckFormValidate=e},"update:checkList":function(e){t.checkList=e},"update:check-list":function(e){t.checkList=e},uploadFiles:t.getOCRResult,mandatoryControlsList:t.mandatoryControlsList,deletedFiles:t.deletedFiles}})],1)],1):t._e(),e("div",{staticClass:"col-auto q-mr-sm leftBorder"},[t._l(t.tabs,(function(s){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:s.label,expression:"tab.label",modifiers:{left:!0}}],key:s.id,staticClass:"tabButtons",attrs:{"is-flat":"","no-border":"",icon:s.icon,color:"primary"},on:{click:function(e){return t.showLinks(s.value)}}},[s.count?e("span",{staticClass:"badge"},[t._v(t._s(s.count)+" ")]):t._e()])]}))],2)])]),e("div",{staticClass:"content"},[e("div",{staticClass:"q-pa-sm"},[t.workflowId&&t.trackRequest?e("div",[e("BaseScrollbar",{attrs:{height:"calc(100vh - 160px)'"}},[e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"toggle-btn justify-center row items-center q-pr-md"},[e("div",{staticClass:"col-auto q-mr-sm q-ml-sm q-pl-sm q-pr-sm",class:[t.inbox?"active-btn":"",t.darkTheme?"custom-tab":""],on:{click:function(e){return t.getlist(!0)}}},[t._v(" Application Received "),t.inboxCount?e("span",{staticClass:"data-count"},[t._v(t._s(t.inboxCount))]):t._e()]),e("div",{staticClass:"col q-mr-sm q-ml-md q-pl-sm q-pr-sm",class:[t.inbox?"":"active-btn",t.darkTheme?"custom-tab":""],on:{click:function(e){return t.getlist(!1)}}},[t._v(" All Applications "),t.processCount?e("span",{staticClass:"data-count"},[t._v(" "+t._s(t.processCount)+" ")]):t._e()])]),e("q-space"),e("div",{staticClass:"col-auto q-mr-sm"},[t.initiate?e("BaseButton",{attrs:{label:"Submit your request"},on:{click:t.openNewRequest}}):t._e()],1),e("div",{staticClass:"col-auto q-mt-xs"},[e("div",{attrs:{id:"global-search"}},[e("BaseIcon",{attrs:{name:"eva-search"}}),e("div",{staticClass:"label"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],ref:"searchQuery",staticClass:"q-px-xs",attrs:{type:"text",placeholder:"Search request..."},domProps:{value:t.search},on:{keyup:function(e){return t.searchList()},input:function(e){e.target.composing||(t.search=e.target.value)}}})])],1)]),e("div",{staticClass:"col-auto q-ml-xs"},[e("PortalFilterItems",{attrs:{item:"proces",columns:t._columns,"filter-by":t.filterBy,"selected-filter":t.selectedFilter},on:{"update:filterBy":function(e){t.filterBy=e},"update:filter-by":function(e){t.filterBy=e},update:t.getWorkflowData,refresh:t.getRequestList}})],1),e("div",{staticClass:"col-auto q-ml-xs"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Refresh",expression:"'Refresh'",modifiers:{top:!0}}],attrs:{icon:"eva-refresh",color:"gray","no-border":"","is-flat":"",size:"20px"},on:{click:t.getRequestList}})],1),e("div",{staticClass:"col-auto q-ml-xs q-mr-md"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Export",expression:"'Export'",modifiers:{top:!0}}],attrs:{"is-flat":"","no-border":"",icon:"mdi-table-arrow-right"},on:{click:t.export_Data}})],1)],1),e("div",{staticClass:"subdetcontent"},[t.loadingBarContent?e("BaseLoadingBarSheet",{staticClass:"loading-content"}):t._e(),e("BaseScrollbar",{attrs:{height:"calc(100vh - 180px)"}},[e("PortalList",{attrs:{items:t._items,columns:t._columns,form:t.form,list:t.workflowRequestList,"process-level":t.processLevel,"form-view":t.formView,workflow:t.workflow},on:{"update:formView":[function(e){t.formView=e},t.handleFormViewUpdate],"update:form-view":function(e){t.formView=e},actions:t.showLinks,subactions:t.showSubLinks,open:t.openProcess,opensubprocess:t.openSubProcess,viewFile:t.openFile}})],1)],1),t._e()],1)],1):t._e()])]),e("Sheet",{attrs:{width:"30vw","sub-actions":t.checkListTemplate,"sub-actions-height":105,upload:t.uploadAccess},on:{input:t.closeAttachmentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Attachments ")]},proxy:!0},{key:"actions",fn:function(){return[t.selectedProcess.processId?e("div",{staticClass:"q-ml-sm text-gray q-mr-sm ellipsis",staticStyle:{"font-size":"10px"}},[t._v(" auto-refresh every 15 seconds ")]):t._e(),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-xs",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getAttachments(0)}}})]},proxy:!0},t.uploadAccess?{key:"upload",fn:function(){return[e("div",{staticClass:"hint",on:{click:function(e){t.rowIndex=null,t.$refs.attachments.click()}}},[e("BaseIcon",{staticClass:"icon",attrs:{name:"eva-cloud-upload-outline",size:"32px",color:"blue"}}),e("div",{staticClass:"title text-blue"},[t._v("UPLOAD FILES")]),e("div",{staticClass:"description"},[t._v("Click here to choose files and upload")])],1)]},proxy:!0}:null,{key:"subActions",fn:function(){return[e("div",{staticClass:"q-mt-sm"},[e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"q-mt-xs"},[t._v("Checklist Documents")]),e("q-space"),e("div",{on:{click:t.downloadAll}},[e("q-chip",{staticClass:"chips grey-hover large",attrs:{outline:"",color:"grey"}},[t._v(" Download All ")])],1)],1),e("div",{staticClass:"row q-mb-md description text-sm text-grey"},[t._v(" It can be useful to ensure that all necessary information and supporting documents are included when submitting a claim ")])])]},proxy:!0}],null,!0),model:{value:t.attachmentSheet,callback:function(e){t.attachmentSheet=e},expression:"attachmentSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 210px)"}},[e("input",{ref:"attachments",staticClass:"hidden",attrs:{type:"file"},on:{change:t.uploadWflowAttachments}}),t._l(t.checkList,(function(s){return[!s.name||s.hasOwnProperty("visible")&&!s.show?t._e():[s.attach?t._e():e("div",{key:s.uid,staticClass:"checkList"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{attrs:{name:"mdi-file-check-outline",color:"primary"}})],1),e("div",{staticClass:"col q-ml-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[t._v(" "+t._s(s.name)+" ")]),s.required?e("div",{staticClass:"col-12 q-mt-sm"},[e("q-chip",{staticClass:"chips small",attrs:{outline:"",color:"red"}},[t._v(" Required ")])],1):t._e()])]),e("div",{staticClass:"col-auto"},[e("div",{staticClass:"col-12",on:{click:function(e){return t.attachTemplate(s.uid)}}},[e("q-chip",{staticClass:"chips primary-hover medium",attrs:{outline:"",color:"primary"}},[e("q-avatar",{staticClass:"q-mr-sm",attrs:{icon:"eva-upload-outline",color:"primary","text-color":"white"}}),t._v(" Upload ")],1)],1),s.template?e("div",{staticClass:"col-12",on:{click:function(e){return t.download(s.id)}}},[e("q-chip",{staticClass:"chips secondary-hover medium",attrs:{outline:"",color:"secondary"}},[e("q-avatar",{staticClass:"q-mr-sm",attrs:{icon:"eva-download-outline",color:"secondary","text-color":"white"}}),t._v(" Download ")],1)],1):t._e()])])])]]})),t._l(t.attachmentList,(function(s){return[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row",class:t.checkTenant?"cursor-pointer":""},[t.selectedProcess.processId?e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:s.checked?"eva-checkmark-circle-2":"eva-radio-button-off-outline",color:"secondary"},on:{click:function(t){s.checked=!s.checked}}})],1):t._e(),e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openFile(s)}}},[t._v(" "+t._s(s.name)+" ")]),t.checkTenant?e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"delete",expression:"'delete'",modifiers:{top:!0}}],attrs:{icon:"eva-trash-2-outline",color:"red","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.attachmentDelete(s)}}})],1):t._e()]),s.formJsonId?e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"col-auto ellipsis attachment-label"},[t._v(" "+t._s(t.getLabel(s.formJsonId))+" ")])]):t._e(),e("div",{staticClass:"meta row"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.createdBy?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(s.createdByEmail))])]:t._e()],2)])]}))],2),e("div",{staticClass:"q-mt-xs defaultBottom"},[e("BaseIcon",{attrs:{name:"mdi-circle-medium",color:"red"}}),t._v(" Required Documents ")],1)],1)]),e("Sheet",{attrs:{width:"30vw",height:"80vh","custom-height":"30"},on:{input:t.closeCommentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments ")]},proxy:!0}]),model:{value:t.commentsSheet,callback:function(e){t.commentsSheet=e},expression:"commentsSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 155px)"}},[t._l(t.commentsList,(function(s,i){return[e("q-chat-message",{key:i,staticClass:"q-ma-sm",attrs:{name:s.createdBy===t.$store.state.session.id?"me":s.createdByEmail,text:[s.comments],"text-html":"",sent:s.createdBy===t.$store.state.session.id,stamp:t.lastCommentDuration(s),"bg-color":s.createdBy===t.$store.state.session.id?"primary-1":"secondary-2"}})]}))],2)],1),e("div",{staticClass:"col q-pa-sm borderTop"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("TextAreaField",{attrs:{"auto-focus":"",placeholder:"Type a new comment..."},model:{value:t.commentText,callback:function(e){t.commentText=e},expression:"commentText"}})],1),e("div",{staticClass:"col-auto",staticStyle:{margin:"auto"}},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Post Comments",expression:"'Post Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm commentAction",attrs:{icon:"eva-paper-plane-outline",color:"primary-11",size:"16px","rotate-class":"rotate-45"},on:{click:t.saveComment}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Advanced Comments",expression:"'Advanced Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm q-mt-sm commentAction",attrs:{icon:"mdi-comment-text-multiple",color:"primary-11",size:"16px"},on:{click:function(e){t.advancedCommentsSheet=!0}}})],1)])])]),e("Sheet",{attrs:{"no-padding":"",width:"100vw"},on:{input:function(e){t.fileSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"attachmentFileHeader"},[t.selectedFile.formJsonId?[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip:green.bottom",value:t.getLabel(t.selectedFile.formJsonId),expression:"getLabel(selectedFile.formJsonId)",arg:"green",modifiers:{bottom:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"mdi-form-select",color:"primary"}})]:t._e(),e("div",{staticClass:"avatar q-ml-sm"},[e("FileIcon",{attrs:{"mime-type":t.fileType(t.selectedFile.name)}})],1),e("div",{staticClass:"q-ml-md"},[e("div",{staticClass:"filename"},[t._v(" "+t._s(t.selectedFile.name)+" ")]),e("div",{staticClass:"meta"},[t.selectedFile.createdAt?[e("div",[t._v(" Archived At: "+t._s(t.$day.format(t.selectedFile.createdAt))+" ")]),e("BaseIcon",{attrs:{name:"mdi-circle-small"}})]:t._e(),t.selectedFile.createdByEmail?[e("div",[t._v("Archived By: "+t._s(t.selectedFile.createdByEmail))])]:t._e(),t.selectedFile.size?e("div",[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),t._v(" File Size: "+t._s(t.fileSize(t.selectedFile.size))+" ")],1):t._e()],2)])],2)]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Actions",expression:"'Actions'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"eva-menu"}},[e("q-menu",{attrs:{"transition-show":"scale","transition-hide":"scale",anchor:"bottom end",self:"top right"}},[e("BaseScrollbar",{staticClass:"q-pb-sm",attrs:{width:"240px"}},t._l(t.documentActionList,(function(s){return e("ListItem",{key:s.id,attrs:{icon:s.icon,label:s.label},on:{click:function(e){return t.documentAction(s)}}})})),1)],1)],1)]},proxy:!0}]),model:{value:t.fileSheet,callback:function(e){t.fileSheet=e},expression:"fileSheet"}},[e("div",{staticClass:"attachmentFileFrame"},[e("div",{staticClass:"file-list"},[e("iframe",{ref:"myFiles",attrs:{id:"file-frame",src:t.fileLink(),frameborder:"0"}})])])]),e("Confirm",{attrs:{icon:"eva-checkmark-circle-2","icon-color":"green",size:"24px"},on:{input:function(e){t.successModalClaim=!1,t.refNo=""}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Claim Registered!")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"q-py-md text-lg"},[e("p",[t._v(" Thank for submitting your Involuntary Unemployment claim to PSG. ")]),e("p",[t._v(" Your reference number is"),e("span",{staticClass:"text-primary"},[t._v(' "'),e("b",[t._v(t._s(t.refNo)+'"')]),t._v(". ")])]),e("p",{staticClass:"text-secondary"},[t._v(" We have sent a link to the email address you provided which allows you to track your claim. ")])])]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{attrs:{label:"Close",color:"primary"},on:{click:function(e){t.successModalClaim=!1,t.refNo="",t.processSheet=!1}}})]},proxy:!0}]),model:{value:t.successModalClaim,callback:function(e){t.successModalClaim=e},expression:"successModalClaim"}}),e("Confirm",{attrs:{icon:"eva-checkmark-circle-2","icon-color":"green",size:"24px"},on:{input:function(e){t.successModal=!1,t.refNo=""}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Request Registered!")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"q-py-md text-lg"},[e("p",[t._v("Thank for submitting your Request.")]),e("p",[t._v(" Your reference number is"),e("span",{staticClass:"text-primary"},[t._v(' "'),e("b",[t._v(t._s(t.refNo)+'"')]),t._v(". ")])]),e("p",{staticClass:"text-secondary"},[t._v(" We have sent a link to the email address you provided which allows you to track your request. ")])])]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{attrs:{label:"Close",color:"primary"},on:{click:function(e){t.successModal=!1,t.refNo="",t.processSheet=!1}}})]},proxy:!0}]),model:{value:t.successModal,callback:function(e){t.successModal=e},expression:"successModal"}}),e("Confirm",{attrs:{icon:"mdi-file-alert","icon-color":"red"},on:{input:t.closeDocumentAlertModal},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Documents Required!")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"q-py-md text-md"},[e("p",[t._v(" Are you sure you want to submit the claim registration without attaching the required documents. ")]),e("p",{staticClass:"text-secondary"},[t._v(" After registration, you will get the link to track your claim."),e("br"),t._v("From there, you can upload the required documents once you have them. ")])])]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",label:"no"},on:{click:t.closeDocumentAlertModal}}),e("BaseButton",{attrs:{label:"yes",color:"primary"},on:{click:t.initiateRequest}})]},proxy:!0}]),model:{value:t.documentAlertModal,callback:function(e){t.documentAlertModal=e},expression:"documentAlertModal"}}),e("Confirm",{attrs:{icon:"mdi-file-alert","icon-color":"red"},on:{input:t.closeAlertModal},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Documents Required!")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"q-py-md text-md"},[e("p",[t._v(" Are you sure you want to submit the request without attaching the required documents. ")]),e("p",{staticClass:"text-secondary"},[t._v(" After registration, you will get the link to track your request."),e("br"),t._v("From there, you can upload the required documents once you have them. ")])])]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",label:"no"},on:{click:t.closeAlertModal}}),e("BaseButton",{attrs:{label:"yes",color:"primary"},on:{click:t.initiateRequest}})]},proxy:!0}]),model:{value:t.alertModal,callback:function(e){t.alertModal=e},expression:"alertModal"}}),e("Modal",{attrs:{width:"60vw",height:"80vh","has-footer":""},on:{input:function(e){t.advancedCommentsSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments")]},proxy:!0},{key:"default",fn:function(){return[e("TextBuilderField",{model:{value:t.advancedCommentText,callback:function(e){t.advancedCommentText=e},expression:"advancedCommentText"}})]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{attrs:{label:"Post",icon:"eva-paper-plane-outline",color:"primary"},on:{click:t.saveAdvancedComment}})]},proxy:!0}]),model:{value:t.advancedCommentsSheet,callback:function(e){t.advancedCommentsSheet=e},expression:"advancedCommentsSheet"}}),e("MetaDataEdit",{attrs:{value:t.showMetaDataEditModal,file:t.workflow,"repository-field":t.repositoryField,"file-data":t.fileData,title:"Index",columns:t._columns,"modal-value":t.workflowModel,"upload-filename":t.uploadFilename},on:{close:t.closeMetaDataEditModal,save:t.saveMetaData}}),t.historyProcessId?e("ProcessHistory",{attrs:{"process-id":t.historyProcessId,"selected-process":t.selectedProcess},on:{close:function(e){t.historyProcessId=0}}}):t._e(),e("SubWorkflowProcess",{attrs:{"workflow-id":t.subWorkflowId||t.subProcessData.id,"main-workflow-id":t.workflow.id,"main-process-id":t.selectedProcess.processId,"selected-process":t.subProcessData,"open-sub-process":t.openSubProcessSheet,portal:!0},on:{closeProcessSheet:t.closeSubProcess}}),t.showAttachmentSheet?e("Attachments",{attrs:{value:t.showAttachmentSheet,"selected-process":t.selectedProcess,workflow:t.workflow,"selected-node":t.selectedNode,"initiate-process":t.initiate,"form-check-list":!1,"check-list":t.checkList,wform:t.form,"repository-details":t.repositoryDetails,"workflow-model":t.workflowModel,"form-upload-files":t.formUploadFiles,"repository-field":t.repositoryField,columns:t.columns,attachments:t.attachmentList,"workflow-id":t.workflow.id,"is-portal":!0},on:{"update:value":function(e){t.showAttachmentSheet=e},"update:attachments":function(e){t.attachmentList=e},attachmentCount:t.attachmentCount}}):t._e(),t.showCommentsSheet?e("Comments",{attrs:{value:t.showCommentsSheet,"selected-process":t.selectedProcess,workflow:t.workflow,"selected-node":t.selectedNode,"initiate-process":t.initiate,"attachment-list":t.attachmentList,"workflow-id":t.workflow.id,"file-names":[],comments:t.commentsList,"display-internal-public":!1,"is-portal":!0},on:{"update:value":function(e){t.showCommentsSheet=e},"update:comments":function(e){t.commentsList=e},commentsCount:t.commentsCount}}):t._e()],1)},o=[],a=(s("14d9"),s("caad"),s("13d5"),s("2f62")),r=s("fd26"),n=s("4bc4"),l=s("381e"),c=s("a7d2"),d=s("dd90"),h=s("bc3a"),m=s.n(h),u=s("fa1f"),f=s("6df3"),p=s("6a70"),v=s("1b0d"),y=s("1c54"),w=function(){var t=this,e=t._self._c;return e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"filter",expression:"'filter'",modifiers:{top:!0}}],attrs:{"is-flat":"","no-border":"",icon:"eva-funnel-outline",color:t.activeFilter?"secondary":"gray"},on:{click:function(e){t.model=!0}}},[e("Sheet",{attrs:{width:"720px","has-footer":""},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Filter "+t._s(t.item)+"s ")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"q-pa-md",attrs:{id:"filters"}},[e("div",{staticClass:"description"},[t._v(" Define filters to find exactly what you are looking for. Filters can be included or excluded. You can also add multiple filter groups. ")]),t.searchContent?[e("TextField",{staticClass:"q-mb-md",attrs:{placeholder:"Search the document by content"},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})]:t._e(),t.filterGroups.length?[t._l(t.filterGroups,(function(s,i){return[e("div",{key:s.id,staticClass:"filter-group"},[e("div",{staticClass:"header"},[e("div",{staticClass:"label q-mr-md"},[t._v("Criteria")]),e("div",{staticClass:"label q-mr-md"},[t._v("Condition")]),e("div",{staticClass:"label q-mr-sm"},[t._v("Value")]),e("BaseActionButton",{attrs:{"is-flat":"",color:"secondary",icon:"eva-plus","no-border":""},on:{click:function(e){return t.addFilter(i)}}})],1),e("BaseSeparator",{staticClass:"q-mb-md",attrs:{"has-inset":""}}),t._l(s.filters,(function(s,o){return e("ValidationObserver",{key:s.id,ref:"form",refInFor:!0,staticClass:"filter"},[e("ValidationProvider",{key:s.id,staticClass:"col q-mr-md",attrs:{name:"criteria",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:a}){return[e("SelectField",{attrs:{"is-mandatory":"","is-searchable":!0,options:t._columns,error:a[0]},on:{input:function(e){return t.applyDataType(i,o,s.criteria)}},model:{value:s.criteria,callback:function(e){t.$set(s,"criteria",e)},expression:"filter.criteria"}})]}}],null,!0)}),e("ValidationProvider",{staticClass:"col q-mr-md",attrs:{name:"condition",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("SelectField",{attrs:{"is-mandatory":"","is-searchable":!0,options:t.conditions(s.criteria),error:i[0]},model:{value:s.condition,callback:function(e){t.$set(s,"condition",e)},expression:"filter.condition"}})]}}],null,!0)}),"SHORT_TEXT"===s.dataType||"BARCODE"===s.dataType?e("ValidationProvider",{staticClass:"col q-mr-sm",attrs:{name:"value",rules:{required:!["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition)}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("TextField",{attrs:{"is-mandatory":"","is-disabled":["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition),error:i[0]},model:{value:s.value,callback:function(e){t.$set(s,"value",e)},expression:"filter.value"}})]}}],null,!0)}):"NUMBER"===s.dataType?e("ValidationProvider",{staticClass:"col q-mr-sm",attrs:{name:"value",rules:{required:!["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition)}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("NumberField",{attrs:{"is-mandatory":"","is-disabled":["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition),error:i[0]},model:{value:s.value,callback:function(e){t.$set(s,"value",e)},expression:"filter.value"}})]}}],null,!0)}):"DATE"===s.dataType?e("ValidationProvider",{staticClass:"col q-mr-sm",attrs:{name:"value",rules:{required:!["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition)}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("DateField",{attrs:{"is-mandatory":"","is-disabled":["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition),error:i[0]},model:{value:s.value,callback:function(e){t.$set(s,"value",e)},expression:"filter.value"}})]}}],null,!0)}):"TIME"===s.dataType?e("ValidationProvider",{staticClass:"col q-mr-sm",attrs:{name:"value",rules:{required:!["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition)}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("TimeField",{attrs:{"is-mandatory":"","is-disabled":["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition),error:i[0]},model:{value:s.value,callback:function(e){t.$set(s,"value",e)},expression:"filter.value"}})]}}],null,!0)}):"SINGLE_SELECT"===s.dataType?e("ValidationProvider",{staticClass:"col q-mr-sm",attrs:{name:"value",rules:{required:!["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition)}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("SelectField",{attrs:{"is-mandatory":"","is-disabled":["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition),options:t.options(s.criteria),error:i[0]},model:{value:s.arrayValue,callback:function(e){t.$set(s,"arrayValue",e)},expression:"filter.arrayValue"}})]}}],null,!0)}):e("ValidationProvider",{staticClass:"col q-mr-sm",attrs:{name:"value",rules:{required:!["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition)}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("TextField",{attrs:{"is-mandatory":"","is-disabled":["IS_EMPTY","IS_NOT_EMPTY"].includes(s.condition),error:i[0]},model:{value:s.value,callback:function(e){t.$set(s,"value",e)},expression:"filter.value"}})]}}],null,!0)}),e("div",{staticClass:"remove-filter"},[e("BaseActionButton",{attrs:{"is-flat":"",color:"red","no-border":"",icon:"eva-close-outline"},on:{click:function(e){return t.removeFilter(i,o)}}})],1)],1)})),e("BaseSeparator",{attrs:{"has-inset":""}}),e("div",{staticClass:"row"},[e("Action",{staticClass:"col",attrs:{icon:"eva-plus-outline",label:"Add Filter Group"},on:{click:function(e){return t.addFilterGroup(i+1)}}}),e("BaseSeparator",{attrs:{"is-vertical":"","has-inset":""}}),e("Action",{staticClass:"col",attrs:{icon:"eva-trash-2-outline",label:"Delete Group"},on:{click:function(e){return t.removeFilterGroup(i)}}})],1)],2),i!==t.filterGroups.length-1?e("div",{key:i,staticClass:"row justify-center"},[e("Toggle",{staticClass:"q-my-md",attrs:{options:t.groupConditions},on:{input:t.groupCondition},model:{value:s.groupCondition,callback:function(e){t.$set(s,"groupCondition",e)},expression:"group.groupCondition"}})],1):t._e()]}))]:[e("div",{staticClass:"add-filter",on:{click:t.addFilterGroup}},[e("BaseIcon",{attrs:{name:"eva-plus","inherit-color":""}}),e("div",{staticClass:"q-ml-sm"},[t._v("Add Filter")])],1)]],2)]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",label:"clear"},on:{click:t.clearFilter}}),e("BaseButton",{attrs:{label:"apply"},on:{click:t.apply}})]},proxy:!0}]),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})],1)},g=[],b=s("874f"),k=s("9996"),I=s("7bb1"),C=s("b3d1"),S=s("12b8"),_=s("94f5"),T=s("670a"),A=s("970a"),F=s("ad54"),L=s("53c1"),x=s("cedb"),$={name:"PortalFilterItems",components:{ValidationObserver:I["a"],ValidationProvider:I["b"],Sheet:l["a"],TextField:C["a"],SelectField:S["a"],Action:_["a"],Toggle:T["a"],NumberField:F["a"],DateField:L["a"],TimeField:x["a"]},props:{item:{type:String,default:"item"},columns:{type:Array,required:!0},filterBy:{type:Array,required:!0},isBordered:{type:Boolean,default:!1},selectedFilter:{type:Array,default:()=>[]},searchContent:{type:Boolean,default:!1},searchValue:{type:String,default:""}},data(){return{model:!1,groupConditions:["AND","OR"],filterGroups:[],activeFilter:!1,searchText:""}},computed:{_columns(){var t=this.columns.reduce((t,e)=>("isFilter"in e?e.isFilter&&t.push({id:e.id,label:e.label,value:e.name,dataType:"TITLE"!==e.type?e.type:"SHORT_TEXT"}):t.push({id:e.id,label:e.label,value:e.name,dataType:"TITLE"!==e.type?e.type:"SHORT_TEXT"}),t),[]);return t=t.filter(t=>"Process Id"!==t.label),t},apiPath(){return`/repository/${this.$route.query.repositoryId}/uniqueColumnValues`}},watch:{model:{deep:!0,handler(){this.model}},$route:{deep:!0,handler(){this.$route.query.repositoryId||(this.filterGroups=[],this.activeFilter=!1)}}},methods:{conditions(t){if(!t)return[];const e=this.columns.find(e=>e.name===t);return e?Object(A["a"])(e.dataType).map(t=>({id:this.$nano.id(),label:`${Object(b["a"])(Object(k["a"])(t.split(" ")[0]))} ${t.split(" ")[1]?t.split(" ")[1]:""}`,value:t.split(" ")[0]})):void 0},addFilterGroup(t=0){this.filterGroups.splice(t,0,{id:this.$nano.id(),filters:[{id:this.$nano.id(),criteria:"",condition:"",value:""}],groupCondition:(this.filterGroups.length,"")}),this.filterGroups.length&&this.selectedFilter.length&&this.selectedFilter[1]&&1===this.selectedFilter[1].level&&(this.filterGroups[0].filters=[],this.selectedFilter.forEach((t,e)=>{0!=e&&this.filterGroups[0].filters.push({id:this.$nano.id(),criteria:t.fieldName,condition:"IS_EQUALS_TO",value:t.label})}))},removeFilterGroup(t){this.filterGroups.splice(t,1)},addFilter(t){this.filterGroups[t].filters.push({id:this.$nano.id(),criteria:"",condition:"",value:""})},removeFilter(t,e){this.filterGroups[t].filters.splice(e,1)},async apply(){let t=0;if(this.searchContent&&this.$emit("updateSearchValue",this.searchText),this.$refs.form){for(const e of this.$refs.form){const s=await e.validate();s||t++}t||(this.filterGroups[0].groupCondition="",this.filterGroups.length&&(this.filterGroups[0].filters.length||(this.filterGroups=[]),this.filterGroups.forEach(t=>{t.filters.length&&t.filters.forEach(t=>{"SINGLE_SELECT"===t.dataType&&(t.value=JSON.stringify(t.arrayValue))})})),this.$emit("update",this.filterGroups),this.model=!1,this.activeFilter=!0)}else this.searchContent&&(this.$emit("update",this.filterGroups),this.model=!1,this.activeFilter=!0)},applyDataType(t,e,s){this.filterGroups[t].filters[e].value="",this.filterGroups[t].filters[e].condition="",this.filterGroups[t].filters[e].condition="IS_EQUALS_TO",this.filterGroups[t].filters[e].dataType="";let i=this._columns.find(t=>t.value===s);i&&(this.filterGroups[t].filters[e].dataType=i.dataType)},clearFilter(){this.filterGroups=[],this.activeFilter=!1,this.searchText="",this.$emit("refresh")},groupCondition(t){this.filterGroups[this.filterGroups.length-1].groupCondition=t},options(t){let e=this.columns.filter(e=>e.name===t),s=e[0].options;return s}}},E=$,B=(s("2e38"),s("2877")),P=Object(B["a"])(E,w,g,!1,null,"c59e199c",null),O=P.exports,M=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"portalList"}},[e("List",{attrs:{columns:t.columns,items:t.items,form:t.form,list:t.list,"process-level":t.processLevel,"form-view":t.formView,workflow:t.workflow},on:{"update:formView":[function(e){t.formView=e},t.handleFormViewUpdate],"update:form-view":function(e){t.formView=e},actions:t.handleActions,subactions:t.handleSubActions,open:t.handleProcess,opensubprocess:t.handleSubProcess,viewFile:t.handleViewFile}})],1)},D=[],N=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"list"}},[t.loadingBarContent?e("BaseLoadingBarSheet",{staticClass:"loading-content"}):t._e(),e("table",[t.tableHeader?e("thead",[e("tr",[e("th",{staticClass:"sticky icon",staticStyle:{left:"0"}}),t.dummyData?t._t("default"):t._e(),t.title?e("th",{staticClass:"sticky",staticStyle:{left:"36px"}},[t._t("titleHead",(function(){return[t._v(" "+t._s(t.title.label)+" ")]}),{title:t.title.label})],2):t._e(),t._l(t._columns,(function(s){return e("th",{key:s.id},[t._v(" "+t._s(s.label)+" ")])})),e("th",{staticClass:"sticky",staticStyle:{right:"0"}})],2)]):t._e(),e("tbody",[t._l(t.items,(function(s){return[e("tr",{key:s.id,style:{"border-left":t.actionColor(s.lastAction)},on:{click:function(e){return t.expandSubWorkflow(s)}}},[e("td",{staticClass:"sticky icon",staticStyle:{left:"0",width:"36px"}},[e("div",{staticClass:"row items-center justify-center"},[t._t("avatar",(function(){return[s?[s.iconTooltip?[e("BaseIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:s.iconTooltip,expression:"item.iconTooltip",modifiers:{top:!0}}],attrs:{name:s.icon,color:s.color||"secondary"}})]:[e("BaseIcon",{attrs:{name:s.icon,color:s.color||"secondary"}})]]:t._e()]}),{item:s})],2)]),t.title?e("td",{staticClass:"sticky",staticStyle:{left:"36px"}},[t._t("title",(function(){return[e("div",{staticClass:"row"},[e("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:s[t.title.name],expression:"item[title.name]",modifiers:{top:!0}}],staticClass:"font-medium q-mr-xl link-text col",on:{click:function(e){return t.openSheet(s.id)}}},[t._v(" "+t._s(s[t.title.name])+" ")])])]}),{item:s,title:s[t.title.name]})],2):t._e(),t._l(t._columns,(function(i){return e("td",{key:i.id},["TABLE"===i.type?[JSON.parse(s[i.name]).length?[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Table Data",expression:"'Table Data'",modifiers:{top:!0}}],attrs:{icon:"mdi-table","is-flat":"","no-border":""},on:{click:function(e){return e.stopPropagation(),t.showTable(i.label,s[i.name])}}})]:[e("BaseActionButton",{attrs:{icon:"mdi-table","is-flat":"","no-border":"","is-disabled":""}})]]:"FILE_UPLOAD"===i.type?[s[i.name]?e("div",{staticClass:"ellipsis medium"},t._l(JSON.parse(s[i.name]),(function(i,o){return e("div",{key:o,staticClass:"row"},[e("FileIcon",{staticClass:"mini-avatar col-auto q-mr-sm",attrs:{"mime-type":t.fileType(i.fileName)}}),e("span",{staticClass:"text-secondary text-underline col",on:{click:function(e){return t.viewFile(i,s)}}},[t._v(t._s(i.fileName))])],1)})),0):t._e()]:[t._t(i.name,(function(){return[t._v(" "+t._s(t.removeTags(s[i.name])||"-")+" ")]}),{value:s[i.name],item:s})]],2)})),e("td",{staticClass:"sticky icon",staticStyle:{right:"0"}},[t._t("actions",(function(){return[s?[e("div",{staticClass:"row justify-end no-wrap"},[s?t._l(s.tabs,(function(i){return e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:i.label,expression:"tab.label",modifiers:{left:!0}}],key:i.id,staticClass:"tabButtons q-mr-xs",attrs:{"is-flat":"","no-border":"",icon:i.icon,color:"primary",size:"16px"},on:{click:function(e){return e.stopPropagation(),t.$emit("actions",i.value,s.id)}}},[s[i.name]?e("span",{staticClass:"badge"},[t._v(t._s(s[i.name])+" ")]):t._e()])})):t._e(),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Expand",expression:"'Expand'",modifiers:{left:!0}}],staticClass:"tabButtons q-mr-xs",attrs:{"is-flat":"","no-border":"",icon:"mdi-open-in-new",color:"primary",size:"16px"},on:{click:function(e){return t.openSheet(s.id)}}})],2)]:t._e()]}),{item:s})],2)],2),s&&s.displaySubTable&&s.subWorkflow?[s.subWorkflow.length?[e("tr",{key:"subrow"+s.id},[e("td",{attrs:{colspan:t._columns.length+3}},[e("table",{key:"subtable"+s.id,staticClass:"subWorkflowTable",staticStyle:{border:"1px solid var(--divider-color)"}},[t.tableHeader?e("thead",[e("tr",[e("th",{staticClass:"sticky icon",staticStyle:{left:"0"}}),t.dummyData?t._t("default"):t._e(),t.title?e("th",{staticClass:"sticky",staticStyle:{left:"36px"}},[t._t("titleHead",(function(){return[t._v(" "+t._s(t.title.label)+" ")]}),{title:t.title.label})],2):t._e(),t._l(t._subWorkflowColumns,(function(s){return e("th",{key:s.id},[t._v(" "+t._s(s.label)+" ")])})),e("th",{staticClass:"sticky",staticStyle:{right:"0"}})],2)]):t._e(),e("tbody",[t._l(s.subWorkflow,(function(i){return[e("tr",{key:"subbody"+i.id,style:{background:i.inbox?t.darkTheme?"rgb(60, 50, 31)":"rgb(255 228 178)":"","border-left":t.actionColor(s.lastAction)}},[e("td",{staticClass:"sticky icon",staticStyle:{left:"0",width:"36px"},style:{background:i.inbox?t.darkTheme?"rgb(60, 50, 31)":"rgb(255 228 178)":""}},[e("div",{staticClass:"row items-center justify-center"},[t._t("avatar",(function(){return[i.iconTooltip?[e("BaseIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:i.iconTooltip,expression:"subItem.iconTooltip",modifiers:{top:!0}}],attrs:{name:i.icon,color:i.color||"secondary"}})]:[e("BaseIcon",{attrs:{name:i.icon,color:i.color||"secondary"}})]]}),{item:i})],2)]),t.title?e("td",{staticClass:"sticky",staticStyle:{left:"36px"},style:{background:i.inbox?t.darkTheme?"rgb(60, 50, 31)":"rgb(255 228 178)":""}},[t._t("title",(function(){return[e("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:i.requestNo,expression:"subItem.requestNo",modifiers:{top:!0}}],staticClass:"font-medium q-mr-xl link-text",on:{click:function(e){return t.openSubSheet(i)}}},[t._v(" "+t._s(i.requestNo)+" ")])]}),{subItem:i,title:i.subWorkflowName})],2):t._e(),t._l(t._subWorkflowColumns,(function(s){return e("td",{key:s.id},[t._t(s.name,(function(){return[t._v(" "+t._s(i[s.name])+" ")]}),{value:i[s.name],item:i})],2)})),e("td",{staticClass:"sticky icon",staticStyle:{right:"0"},style:{background:i.inbox?t.darkTheme?"rgb(60, 50, 31)":"rgb(255 228 178)":""}},[t._t("actions",(function(){return[i?[e("div",{staticClass:"row justify-end no-wrap"},[i?t._l(i.tabs,(function(o){return e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:o.label,expression:"tab.label",modifiers:{left:!0}}],key:o.id,staticClass:"tabButtons q-mr-xs",attrs:{"is-flat":"","no-border":"",icon:o.icon,color:"primary",size:"16px"},on:{click:function(e){return e.stopPropagation(),t.$emit("subactions",o.value,s,i)}}},[i[o.name]?e("span",{staticClass:"badge"},[t._v(t._s(i[o.name])+" ")]):t._e()])})):t._e(),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Expand",expression:"'Expand'",modifiers:{left:!0}}],staticClass:"tabButtons q-mr-xs",attrs:{"is-flat":"","no-border":"",icon:"mdi-open-in-new",color:"primary",size:"16px"},on:{click:function(e){return t.openSubSheet(i)}}})],2)]:t._e()]}),{subItem:i})],2)],2)]}))],2)])])])]:t._e()]:t._e()]}))],2)]),e("Sheet",{attrs:{width:"100vw","has-footer":!1,"no-padding":!0},on:{input:function(e){t.processSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v('"'+t._s(t.request.requestNo)+'" process details')]},proxy:!0},{key:"actions",fn:function(){return[t.formView?e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Details View",expression:"'Details View'",modifiers:{top:!0}}],staticClass:"q-ml-sm q-mr-sm",attrs:{"is-flat":"",icon:"mdi-table-column"},on:{click:t.openTable}}):e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Form View",expression:"'Form View'",modifiers:{top:!0}}],staticClass:"q-ml-sm q-mr-sm",attrs:{"is-flat":"",icon:"mdi-form-select"},on:{click:t.openForm}})]},proxy:!0},{key:"default",fn:function(){return[e("div",{key:t.request.processId+"det",staticClass:"row"},[e("div",{staticClass:"col"},[e("div",{staticClass:"col-12 q-ma-md",class:{"q-dark":t.darkTheme,"q-light":!t.darkTheme}},[e("q-stepper",{ref:"stepper",attrs:{"alternative-labels":"",color:"primary",animated:""}},t._l(t.stageLevel,(function(s,i){return e("q-step",{key:s.id,attrs:{name:i,title:s.label,prefix:i+1,done:t.currentStep>=i+1}})})),1)],1),e("div",{staticClass:"col-12",attrs:{id:"requestDetails"}},[e("div",{staticClass:"row justify-center"},[e("div",{staticClass:"col q-pa-md"},[e("div",{staticClass:"row items-center"},[e("table",{staticClass:"submittedData q-mb-sm"},[e("tbody",[t.request.createdByName?e("tr",[e("td",{attrs:{colspan:"4"}},[t._v(" Requested By: "+t._s(t.request.createdByName)+" ")])]):t._e(),e("tr",[t.request.raisedBy?e("th",[t._v("Requested User Email")]):t._e(),e("th",[t._v("Requested Date")]),e("th",[t._v("Last Acted By")]),e("th",[t._v("Last Acted On")])]),e("tr",[t.request.raisedBy?e("td",[t._v(" "+t._s(t.request.raisedBy)+" ")]):t._e(),e("td",[t._v(" "+t._s(t.$day.format(t.request.raisedAt))+" ")]),e("td",[t._v(t._s(t.request.transaction_createdByEmail))]),e("td",[t._v(" "+t._s(t.$day.format(t.request.transaction_createdAt))+" ")])])])]),e("BaseScrollbar",{attrs:{height:"calc(100vh - 320px)"}},[t.requestFormData.panels?[e("table",{staticClass:"mainData col-12"},[t._l(t.requestFormData.panels,(function(s){return[e("tr",{key:s.name,staticStyle:{cursor:"pointer"},on:{click:function(t){s.panelsExpandView=!s.panelsExpandView}}},[e("td",{staticStyle:{color:"#643094"},attrs:{colspan:"2"}},[s.panelsExpandView?e("BaseIcon",{staticClass:"icon",attrs:{name:"eva-arrow-downward-outline",size:"20px",color:"primary"}}):e("BaseIcon",{staticClass:"icon",attrs:{name:"eva-arrow-forward-outline",size:"20px",color:"primary"}}),t._v(" "+t._s(s.name||"No Title")+" ")],1)]),s.panelsExpandView?[t._l(s.fields,(function(s,i){return[s&&"[]"!=s?[t.isVisible(i)?["TABLE"!==t.validateType(i)?[e("tr",{key:i},[e("td",{staticClass:"tblHeader ellipsis small"},[t._v(" "+t._s(t.getLabel(i))+" ")]),e("td",{staticClass:"ellipsis"},["FILE_UPLOAD"===t.validateType(i)?[JSON.parse(s).length?e("div",t._l(JSON.parse(s),(function(i){return e("div",{key:i.fileName,staticClass:"q-mb-xs"},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"col row items-center",on:{click:function(e){return t.viewFile(i,s)}}},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(i.fileName)}}),e("span",{staticClass:"cursor-pointer text-underline text-secondary"},[t._v(t._s(i.fileName))])],1)])])})),0):t._e()]:"DATE"===t.validateType(i)?[t._v(" "+t._s(t.$day.format(s,!1))+" ")]:t.validateValue(s)?[t._v(" "+t._s(t.removeTags(s)||"-")+" ")]:[e("a",{attrs:{href:s,target:"_blank"}},[t._v(" "+t._s(s||"-")+" ")])]],2)])]:JSON.parse(s).length?[t.getLabel(i)?e("tr",{key:"trlabel"+i},[e("td",{staticClass:"tblHeader ellipsis small",attrs:{colspan:"2"}},[e("FormFieldLabel",{key:"label"+i,staticClass:"q-mt-sm",attrs:{label:t.getLabel(i)}})],1)]):t._e(),e("tr",{key:"trtable"+i},[e("td",{attrs:{colspan:"2"}},[e("BaseScrollbar",{key:"scroll"+i,staticStyle:{"max-height":"200px"}},[e("table",{key:"table-"+i,staticClass:"sub-table q-mt-sm q-mb-sm"},[e("thead",[e("tr",t._l(t.tableColumns(s,i),(function(s){return e("th",{key:s.id},[t._v(" "+t._s(s.label)+" ")])})),0)]),e("tbody",t._l(t.tableValue(s),(function(o,a){return e("tr",{key:a},t._l(t.tableColumns(s,i),(function(s){return e("td",{key:s.id},[t._v(" "+t._s(o[s.id])+" ")])})),0)})),0)])])],1)])]:t._e()]:t._e()]:t._e()]}))]:t._e()]}))],2)]:t._e()],2)],1)])])])]),e("div",{staticClass:"col-auto q-mr-sm leftBorder"},[t._l(t.tabs,(function(s){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:s.label,expression:"tab.label",modifiers:{left:!0}}],key:s.id,staticClass:"tabButtons",attrs:{"is-flat":"","no-border":"",icon:s.icon,color:"primary"},on:{click:function(e){return t.$emit("actions",s.value,t.request.processId)}}},[s.count?e("span",{staticClass:"badge"},[t._v(t._s(s.count)+" ")]):t._e()])]}))],2)])]},proxy:!0}]),model:{value:t.processSheet,callback:function(e){t.processSheet=e},expression:"processSheet"}}),e("Modal",{attrs:{width:"60vw",height:"80vh"},on:{input:function(e){t.expandTableModal=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(t._s(t.tableTitle))]},proxy:!0},{key:"default",fn:function(){return[e("div",{attrs:{id:"tableData"}},[e("table",[e("thead",[e("tr",t._l(t.tableData[0],(function(s,i){return e("th",{key:i},[t._v(" "+t._s(i)+" ")])})),0)]),e("tbody",t._l(t.tableData,(function(s,i){return e("tr",{key:i},t._l(s,(function(s,i){return e("td",{key:i},[t._v(" "+t._s(s)+" ")])})),0)})),0)])])]},proxy:!0}]),model:{value:t.expandTableModal,callback:function(e){t.expandTableModal=e},expression:"expandTableModal"}})],1)},q=[],R=s("3445"),z={name:"List",components:{Sheet:l["a"],Modal:p["a"],FormFieldLabel:R["a"],FileIcon:u["a"]},props:{columns:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},form:{type:Object,default:()=>{}},list:{type:Array,default:()=>[]},processLevel:{type:Array,default:()=>[]},noBackground:{type:Boolean,default:!1},tableHeader:{type:Boolean,default:!0},formView:{type:Boolean,default:!1},workflow:{type:Object,default:()=>{}}},data(){return{loadingBarContent:!1,processSheet:!1,request:{},stageLevel:[],currentStep:0,tabs:[{id:this.$nano.id(),label:"attachments",value:"ATTACHMENTS",icon:"mdi-attachment",count:0},{id:this.$nano.id(),label:"comments",value:"COMMENTS",icon:"mdi-comment-text-outline",count:0}],expandTableModal:!1,tableTitle:"",tableData:[],dummyData:!0,requestFormData:{}}},computed:{...Object(a["c"])(["darkTheme"]),_columns(){return this.columns.filter(t=>"TITLE"!==t.type&&t.isVisible)},title(){return this.columns.find(t=>"TITLE"===t.type)},_subWorkflowColumns(){let t=[{id:this.$nano.id(),name:"stage",label:"Stage",type:"SINGLE_SELECT",isVisible:!0,isSortable:!0,isGroupable:!1},{id:this.$nano.id(),name:"raisedBy",label:"Raised By",type:"SINGLE_SELECT",isVisible:!0,isSortable:!0,isGroupable:!1},{id:this.$nano.id(),name:"raisedAt",label:"Raised On",type:"DATE",isVisible:!0,isSortable:!0,isGroupable:!1}];return t}},watch:{formView(t){!1===t?this.openTable():!0===t&&(this.processSheet=!1,this.openForm())}},methods:{computedBackgroundColor(){const t=void 0!==this.darkTheme&&this.darkTheme?"#1c313a":"#e0f5fa";return t},expandSubWorkflow(t){t.displaySubTable=!t.displaySubTable,this.dummyData=!this.dummyData},openSubSheet(t){this.$emit("opensubprocess",t)},openForm(){this.$emit("update:formView",!0),this.$emit("open",this.request)},actionColor(t){return this.darkTheme,t?-1!==t.toLowerCase().indexOf("reply")?"5px solid yellow":-1!==t.toLowerCase().indexOf("forward")?"5px solid orange":-1!==t.toLowerCase().indexOf("approve")?"5px solid green":-1!==t.toLowerCase().indexOf("reject")?"5px solid red":"":""},async openTable(){this.$emit("update:formView",!1),this.loadingBarContent=!0,await this.getAttachments(),await this.getComments(),await this.processHistory(),this.processSheet=!0,this.loadingBarContent=!1},transformFormDataToPanelsArray(t,e){const s={formId:t.formId,formEntryId:t.formEntryId,panels:[]};let i=JSON.parse(this.workflow.flowJson),o=[];return i.blocks.forEach(t=>{t.settings.initiateBy.indexOf("PORTAL")>-1&&t.settings.formSecureControls&&t.settings.formSecureControls.length&&o.push(...t.settings.formSecureControls)}),e.forEach((e,i)=>{if(-1===o.indexOf(e.id)){const o=e.settings.title,a=e.fields,r={name:o,panelsExpandView:0===i,fields:{}};a.forEach(e=>{const s=e.id,i=t.fields[s]||"";r.fields[s]=i}),s.panels.push(r)}}),s},async openSheet(t){this.request=this.list.find(e=>e.processId===t),this.request.inbox?(this.$emit("update:formView",!0),this.$emit("open",this.request)):(this.$emit("update:formView",!1),this.loadingBarContent=!0,await this.getAttachments(),await this.getComments(),await this.processHistory(),this.processSheet=!0,this.loadingBarContent=!1),this.requestFormData=await this.transformFormDataToPanelsArray(this.request.formData,this.form.panels)},validateType(t){let e="";return this.form.panels.forEach(s=>{if(!s.fields.length)return;let i=s.fields.find(e=>e.id===t);i&&(e=i.type)}),e},getLabel(t,e){let s="";return this.form.panels.forEach(i=>{if(i.fields.length)for(let o of i.fields)if("table"===e){const e=o.settings.specific.tableColumns.find(e=>e.id===t);e&&(s=e.label)}else if(o.id===t&&!1===o.settings.general.hideLabel)return void(s=o.label)}),s},validateValue(t){let e=/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;return!e.test(t)},removeTags(t){return t?t.replace(/(<([^>]+)>)/gi,""):""},tableValue(t){return t?JSON.parse(t):[]},tableColumns(t,e){let s=[];for(const n of this.form.panels)s.push(...n.fields);let i=s.find(t=>t.id===e),o=[];i.settings.specific.tableColumns.forEach(t=>{"DISABLE"!==t.settings.general.visibility&&o.push(t)});let a=[],r=[];for(let n in this.tableValue(t)[0])a.push(n);return o.forEach(t=>{a.indexOf(t.id)>-1&&r.push(t)}),r},viewFile(t,e){t.createdBy=e.createdBy,t.createdAt=e.createdAt,t.name||(t.name=t.fileName),t.id||(t.id=t.itemId),this.$emit("viewFile",t)},fileType(t){if(t)return t.split(".").reverse()[0].slice(0,4)},showTable(t,e){this.tableData=[],this.tableTitle=t;let s=JSON.parse(e);for(let i of s){let t={};for(let e of Object.keys(i)){const s=this.getLabel(e,"table");t[s]=i[e]}this.tableData.push(t)}this.expandTableModal=!0},async getAttachments(){this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=0)}),this.$store.commit("showLoadingBar");const{error:t,payload:e}=await v["t"].getAttachments(this.request.id,this.request.processId);this.$store.commit("hideLoadingBar"),t?this.$alert.error(t):e.length&&this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=e.length)})},async getComments(){this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=0)}),this.$store.commit("showLoadingBar");const{error:t,payload:e}=await v["t"].getProcessComments(this.request.id,this.request.processId);this.$store.commit("hideLoadingBar"),t?this.$alert.error(t):e.length&&this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=e.length)})},async processHistory(){this.$store.commit("showLoadingBar");const{error:t,payload:e}=await v["t"].processHistory(this.request.id,this.request.processId);this.$store.commit("hideLoadingBar"),t?this.$alert.error(t):e.length&&(this.stageLevel=[],this.currentStep=0,e.forEach(t=>{if(2!==t.actionStatus)if(0===this.stageLevel.filter(e=>e.id===t.activityId).length)this.stageLevel.push({id:t.activityId,label:t.stage,status:t.status}),((t.actionUser||t.subWorkflowHistory)&&t.status&&"Forward"!==t.status||null===t.actionUser&&!t.subWorkflowHistory)&&(this.currentStep+=1);else if(t.status)this.stageLevel.filter(e=>e.id===t.activityId&&e.status!==t.status).length?this.currentStep+=1:this.currentStep-=1;else{let e=this.stageLevel.findIndex(e=>e.id===t.activityId);e>-1&&(this.stageLevel.splice(e,this.stageLevel.length-e),this.stageLevel.push({id:t.activityId,label:t.stage,status:t.status}),t.actionUser&&t.status&&"Forward"!==t.status||null===t.actionUser?this.currentStep=e+1:this.currentStep=e)}}))},isVisible(t){const e=this._columns,s=e.findIndex(e=>e.name===t);return s>-1&&e[s].isVisible}}},j=z,V=(s("9bef"),s("f531")),U=s("87fe"),W=s("93dc"),H=s.n(W),J=Object(B["a"])(j,N,q,!1,null,null,null),G=J.exports;H()(J,"components",{QStepper:V["a"],QStep:U["a"]});var Y={name:"PortalList",components:{List:G},props:{columns:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},form:{type:Object,default:()=>{}},list:{type:Array,default:()=>[]},processLevel:{type:Array,default:()=>[]},formView:{type:Boolean,default:!1},workflow:{type:Object,default:()=>{}}},methods:{handleActions(t,e){this.$emit("actions",t,e)},handleSubActions(t,e,s){this.$emit("subactions",t,e,s)},handleProcess(t){this.$emit("open",t)},handleSubProcess(t){this.$emit("opensubprocess",t)},handleViewFile(t){this.$emit("viewFile",t)},handleFormViewUpdate(t){this.$emit("update:formView",t)}}},Q=Y,X=(s("165f"),Object(B["a"])(Q,M,D,!1,null,null,null)),K=X.exports,Z=s("695e"),tt=s("b6d2"),et=s("42fc"),st=s("cade"),it=s("ee54"),ot=s("8505"),at=s("470f"),rt=s("98cf"),nt=s("909a"),lt=s("7ee8"),ct=s("ec15"),dt=s("bb36"),ht=s("381b"),mt={name:"PortalsAccess",components:{ThemeSwitcher:r["a"],RenderForm:n["a"],Sheet:l["a"],FileIcon:u["a"],TextAreaField:f["a"],Modal:p["a"],Confirm:y["a"],PortalFilterItems:O,PortalList:K,TextBuilderField:Z["a"],Pagination:tt["a"],ListItem:st["a"],MetaDataEdit:it["a"],ProcessHistory:ot["a"],SubWorkflowProcess:at["a"],Attachments:ct["a"],Comments:dt["a"]},props:{tenantId:{type:String,required:!0},portalId:{type:String,required:!0}},data(){return{inbox:!0,loadingBarContent:!1,portalWidth:"100%",breadcrumbs:[],activeItem:"",tabList:[{id:this.$nano.id(),label:"Submit a claim",size:"12",description:"If you wish to initiate a new claim, kindly begin by clicking the 'Submit a claim' button below.",children:[{id:this.$nano.id(),label:"IUI (Involuntary Unemployment)",size:"6",workflowId:13,description:[{id:this.$nano.id(),title:"Required Information",class:"medium",label:"Please have the below documents ready to initiate an Involuntary Unemployment claim",list:[{id:this.$nano.id(),label:"- Record or Employment (ROE)",condition:"OR"},{id:this.$nano.id(),label:"- Employers Statement (If ROE not available)",link:{label:"Click here to download a pdf to be completed by your employer",value:"http://52.172.32.88/ezenterpriseAPI/template/Employer Statement.pdf"}}]},{id:this.$nano.id(),title:"Complete the Claim Form",label:"Fill out the claim form thoroughly, providing all the required information."},{id:this.$nano.id(),title:"Follow Up",label:"Once you have submitted the claim form and the supporting documents, a PSG representative will contact you to follow up on the status of your claim. You will also receive a link by email which will allow you to track the progress of your claim."}]},{id:this.$nano.id(),label:"Sickness / Injury",size:"6",workflowId:13,description:[{id:this.$nano.id(),title:"Required Information",class:"medium",label:"All the below documents are required to initiate a Sickness/Injury Claim",list:[{id:this.$nano.id(),label:"- Employers Statement"},{id:this.$nano.id(),label:"- Physicians Statement"}]},{id:this.$nano.id(),title:"Complete the Claim Form",label:"Fill out the claim form thoroughly, providing all the required information."},{id:this.$nano.id(),title:"Follow Up",label:"Once you have submitted the claim form and the supporting documents, a PSG representative will contact you to follow up on the status of your claim. You will also receive a link by email which will allow you to track the progress of your claim."}]},{id:this.$nano.id(),label:"Document Submission",size:"12",workflowId:1013,description:[{id:this.$nano.id(),title:"",size:"medium",label:"You can also download the claim documents by clicking on the link below and upload them to this portal."},{id:this.$nano.id(),title:"",size:"small",label:"Please note submitting forms through the below link might delay the process compared to submitting online forms on the link above."}]}]},{id:this.$nano.id(),label:"Track your claim",size:"12",description:"To track the progress of your claim, simply click on the 'Track your claim' button below.",workflowId:13}],drilledList:[],workflowId:"",workflow:{},formId:"",form:null,formModel:{},tabs:[{id:this.$nano.id(),label:"attachments",name:"attachmentsCount",value:"ATTACHMENTS",icon:"mdi-attachment",count:0},{id:this.$nano.id(),label:"comments",name:"commentsCount",value:"COMMENTS",icon:"mdi-comment-text-outline",count:0}],attachmentSheet:!1,attachmentLoad:null,commentsSheet:!1,commentText:"",commentsList:[],attachmentList:[],fileSheet:!1,selectedFile:{},selectedProcess:{},checkList:[],docWarning:!1,rowIndex:null,actions:[],processActionsAddOn:[],workflowFormModel:{},saveAction:"",generatePDF:0,workflowRequestList:[],search:"",hasSelectedProcess:0,processLevel:[],successModal:!1,successModalClaim:!1,refNo:"",alertModal:!1,documentAlertModal:!1,formEditAccess:!1,formEditControls:[],readonlyControls:[],formVisibilityAccess:!0,formSecureControls:[],trackRequest:!1,initiate:!1,processSheet:!1,name:"Track your request",label:"",filterBy:[],items:"",selectedFilter:[],title:"Track Portal",workflowRequestListData:[],advancedCommentsSheet:!1,advancedCommentText:"",userList:[],totalItems:0,itemsPerPage:100,currentPage:1,headerTitle:"",documentActionList:[{id:"Download",key:"download",label:"Download",icon:"mdi-download-outline"},{id:"Print",key:"print",label:"Print",icon:"eva-printer-outline"}],repositoryDetails:[],repositoryField:[],showMetaDataEditModal:!1,selectedUploadFile:{},uploadFilename:"",fileData:[],workflowModel:{},historyProcessId:0,subWorkflowId:0,subProcessData:{},openSubProcessSheet:!1,formUploadFiles:[],mandatory:{},fileControlDeleteFile:[],hasCheckFormValidate:!1,formFields:[],subWorkflowFormList:[],fileUploadForControl:!1,fileUploadInput:{},metaDataModal:{},metaDataTitle:"",formView:!1,portalMasterFormId:0,portalSettingJson:{},masterFormFields:[],fileUploadRequired:!1,mandatoryDocument:[],ocrResult:[],btnAction:!1,uploadAccess:!1,showAttachmentSheet:!1,showCommentsSheet:!1,columns:[],selectedNode:"",inboxCount:0,processCount:0,commentAction:1}},computed:{...Object(a["c"])(["darkTheme"]),isLogoRequired(){let t=location.origin;return"https://trial.ezofis.com"!==t||"2"!==this.tenantId||"4"!==this.portalId},_logo(){let t=location.origin;return"https://edmsuat.sobhaapps.com"===t||"https://edms.sobhaapps.com"===t?s("afaa"):"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?s("651a"):"https://trial.ezofis.com"===t&&"2"===this.tenantId&&"46"===this.portalId?s("99c8"):"https://trial.ezofis.com"===t&&"23"===this.tenantId&&"1"===this.portalId?s("3d18"):s("bcdf")(`./name-${this.darkTheme?"dark":"light"}.png`)},logoHeight(){let t=location.origin;return"https://edmsuat.sobhaapps.com"===t||"https://edms.sobhaapps.com"===t?"32px":"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?"36px":"https://trial.ezofis.com"===t&&"2"===this.tenantId&&"46"===this.portalId?"32px":"https://trial.ezofis.com"===t&&"23"===this.tenantId&&"1"===this.portalId?"36px":"24px"},checkTenant(){return"https://ag-appsvc01.azurewebsites.net"!==origin&&"https://ag-appsvc05.azurewebsites.net"!==origin},isMaximized(){return"100%"===this.portalWidth},formName(){return this.formId?this.form.settings.general.name:""},formDescription(){return this.formId?this.form.settings.general.description:""},panels(){return this.formId?this.form.panels:[]},secondaryPanels(){return this.formId?this.form.secondaryPanels:[]},formSettings(){return this.formId?this.form.settings:{}},checkListTemplate(){return!!this.checkList.length&&this.checkList.filter(t=>t.template).length>0},_enableControls(){let t=[],e=[];return this.panels.forEach(s=>{if(s.fields.length){let i=s.fields.filter(t=>"SINGLE_SELECT"===t.type||"SINGLE_CHOICE"===t.type||"MULTIPLE_CHOICE"===t.type||"MULTI_SELECT"===t.type);i.length&&i.forEach(s=>{if(s.settings.validation.enableSettings&&s.settings.validation.enableSettings.length){let i=[];s.settings.validation.enableSettings.forEach(t=>{t.controls.length&&(i.push({value:t.value,childControls:t.controls}),t.controls.forEach(t=>{i.indexOf(t)<0&&e.push(t)}))}),i.length&&t.push({id:s.id,parentControls:i})}})}}),{listControls:e,controls:t}},_items(){return this.workflowRequestList.map(t=>({id:t.processId,icon:this.checkStatusIcon(t),color:this.checkStatusColor(t),iconTooltip:1==t.flowStatus?"Completed":"In-progress",requestNo:t.requestNo,raisedBy:t.raisedBy,raisedAt:this.$day.format(t.raisedAt),stage:t.stage,tabs:this.tabs,inbox:t.inbox,attachmentsCount:t.attachmentCount,commentsCount:t.commentsCount,lastAction:t.lastAction,...this.getFormData(t),subWorkflow:t.subworkflowTransaction.map(t=>({tabs:this.tabs,activityId:t.activityId,userId:t.activityUserId,color:1==t.flowStatus?"green":"orange",iconTooltip:1==t.flowStatus?"Completed":"In-progress",icon:1==t.flowStatus?"mdi-check-circle-outline":"mdi-progress-clock",processId:t.processId,raisedAt:this.$day.format(t.raisedAt),raisedBy:t.raisedBy,raisedByUser:t.raisedByUserId,requestNo:t.requestNo,review:t.review,stageName:t.stageName,id:t.subWorkFlowId,stageType:t.stageType,stage:t.stageName,subWorkFlowId:t.subWorkFlowId,subWorkflowName:t.subWorkflowName,transactionId:t.transactionId,inbox:String(t.activityUserId)===String(this.$store.state.session.id),attachmentsCount:t.attachmentCount,commentsCount:t.commentsCount,displaySubTable:!1,actionUser:t.activityUserEmail,lastAction:t.lastAction}))}))},_columns(){let t=[];this.workflowRequestList.length&&t.push({id:this.$nano.id(),name:"requestNo",label:"Request No",type:"TITLE",isVisible:!0,isSortable:!0,isGroupable:!1}),this.panels.forEach(e=>{if(e.fields.length)for(let s of e.fields)"DIVIDER"===s.type||"LABEL"===s.type||"PARAGRAPH"===s.type||!s.label&&"TABLE"!==s.type||"DISABLE"===s.settings.general.visibility||t.push({id:this.$nano.id(),name:s.id,label:s.label,type:s.type,isVisible:!0,isSortable:!0,isGroupable:!1})});let e=[{id:this.$nano.id(),label:"Running",value:"running"},{id:this.$nano.id(),label:"Completed",value:"completed"}],s=[];return this.processLevel.forEach(t=>{s.push({id:this.$nano.id(),label:t.label,value:t.label.toLowerCase()})}),t.push({id:this.$nano.id(),name:"status",label:"Status",type:"SINGLE_SELECT",options:e,isVisible:!1,isSortable:!0,isGroupable:!1},{id:this.$nano.id(),name:"stage",label:"Stage",type:"SINGLE_SELECT",options:s,isVisible:!0,isSortable:!0,isGroupable:!1},{id:this.$nano.id(),name:"actionUser",label:"Action User",type:"SINGLE_SELECT",options:this.userList,isVisible:!1,isSortable:!0,isGroupable:!1},{id:this.$nano.id(),name:"raisedBy",label:"Raised By",type:"SINGLE_SELECT",options:this.userList,isVisible:!0,isSortable:!0,isGroupable:!1},{id:this.$nano.id(),name:"raisedAt",label:"Raised On",type:"DATE",isVisible:!0,isSortable:!0,isGroupable:!1},{id:this.$nano.id(),name:"id",label:"Process Id",type:"SHORT_TEXT",isVisible:!1,isSortable:!0,isGroupable:!1}),t},mandatoryFilling(){return this.mandatory.filledValue&&this.mandatory.nonFilledValue?Math.floor(this.mandatory.filledValue/(this.mandatory.filledValue+this.mandatory.nonFilledValue)*100):this.mandatory.filledValue?100:0},getFieldIndicatorList(t){let e=[],s=this.subWorkflowFormList.find(e=>e.id===t.formData.formId),i=JSON.parse(s.formJson);i.panels.forEach(t=>{e.push(...t.fields)});let o=0,a=0,r=t.formData.fields;return e.forEach(t=>{this.isVisible(t.id)&&"REQUIRED"===t.settings.validation.fieldRule&&"NORMAL"===t.settings.general.visibility&&"YES"===t.settings.validation.answerIndicator&&(this.showAnswerIndicator=!0,Array.isArray(r[t.id])?r[t.id].length?o+=1:a+=1:"<p></p>"===r[t.id]?this.removeTags(r[t.id])?o+=1:a+=1:r[t.id]?o+=1:a+=1)}),{filledValue:o,nonFilledValue:a}}},watch:{workflowFormModel:{deep:!0,immediate:!0,handler(){this.workflowFormModel&&this.saveAction&&(Object.keys(this.selectedProcess).length?this.processRequest():this.checkRequiredDocuments())}},itemsPerPage:{deep:!0,immediate:!0,handler(){this.workflowId&&this.workflowRequestList&&this.itemsPerPage}},currentPage:{deep:!0,immediate:!0,handler(){this.workflowId&&this.workflowRequestList&&this.currentPage}},checkList:{deep:!0,immediate:!0,handler(){if(this.checkList.length){let t=[];this.checkList.forEach(e=>{e.required&&!e.attach&&t.push(e)}),this.mandatoryDocument=t}}},fileUploadRequired:{immediate:!0,handler(){if(this.checkList.length){let t=[];this.checkList.forEach(e=>{e.required&&!e.attach&&t.push(e)}),this.mandatoryDocument=t}}},attachmentSheet:{immediate:!0,handler(){this.attachmentSheet&&this.selectedProcess.processId?(this.getAttachments(),this.attachmentLoad=setInterval(()=>{this.getAttachments()},15e3)):clearInterval(this.attachmentLoad)}},form:{deep:!0,immediate:!0,handler(){this.form&&this.form.formJson&&this.getColumns()}}},created(){("https://demo.ezofis.com"===location.origin||"http://52.172.32.88"===location.origin)&&1==this.portalId?this.drilledList=this.tabList:(this.tabList=[],this.getPortal()),this.getUsers()},methods:{getlist(t){!t==this.inbox&&(this.inbox=t,this.getRequestList())},handleFormViewUpdate(t){this.formView=t,t||(this.processSheet=!1)},checkDocument(){this.docWarning=!1,this.checkList.length&&this.checkList.forEach(t=>{t.required&&!t.attach&&(this.docWarning=!0)})},resetList(){this.activeItem={},this.breadcrumbs=[],this.drilledList=this.tabList},checkStatusIcon(t){return 1==t.flowStatus?t.lastAction.toLowerCase().indexOf("reject")>-1?"eva-close-circle-outline":"eva-checkmark-circle-2-outline":"mdi-progress-clock"},checkStatusColor(t){return 1==t.flowStatus?t.lastAction.toLowerCase().indexOf("reject")>-1?"red":"positive":"orange"},async showLinks(t,e){"ATTACHMENTS"===t?(e&&(this.selectedProcess=this.workflowRequestList.find(t=>t.processId===e),this.attachmentList=[],await this.getAttachments(),this.selectedProcess.inbox?this.selectedNode="inbox":this.selectedNode="completed"),this.showAttachmentSheet=!0):"COMMENTS"===t?(e&&(this.selectedProcess=this.workflowRequestList.find(t=>t.processId===e),this.commentsList=[],await this.getComments(),this.selectedProcess.inbox?this.selectedNode="inbox":this.selectedNode="completed"),this.showCommentsSheet=!0):"HISTORY"===t&&this.selectedProcess.processId&&(this.historyProcessId=this.selectedProcess.processId)},async showSubLinks(t,e,s){"ATTACHMENTS"===t?(s.processId&&(this.selectedProcess=e.subWorkflow.find(t=>t.processId===s.processId),this.attachmentList=[],await this.getAttachments(s.id)),this.attachmentSheet=!0):"COMMENTS"===t&&(s.processId&&(this.selectedProcess=e.subWorkflow.find(t=>t.processId===s.processId),this.commentsList=[],await this.getComments(s.id)),this.commentsSheet=!0)},closeAttachmentsSheet(){this.attachmentSheet=!1},closeCommentsSheet(){this.closeCommnetsSheet=!1},lastCommentDuration(t){const e=t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt),s=new Intl.RelativeTimeFormat("en"),i={years:31536e3,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1},o=(e.getTime()-Date.now())/1e3;for(let a in i)if(i[a]<Math.abs(o)){const t=o/i[a];return s.format(Math.round(t),a)}},fileType(t){if(t)return t.split(".").reverse()[0].slice(0,4)},fileSize(t){return Object(c["a"])(t)},fileLink(){let t=location.origin.replace("http://localhost:8080","http://52.172.32.88");if(this.selectedFile.name){let e=this.selectedFile.name.split(".").pop();return this.selectedFile.initiate?Object(d["d"])(e)?"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?`https://ag-appsvc04.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=1`:"https://trial.ezofis.com"===t?`https://trial.ezofis.com/docsviewer/index.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=1`:"https://app.ezofis.com"===t?`https://ezdocsviewer.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=1`:`${t}/PDFViewer/web/viewer.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=1`:"http://52.172.32.88"===t?`http://52.172.32.88/DocsViewer/index.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=1`:`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/1`:Object(d["d"])(e)?"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?`https://ag-appsvc04.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&type=2&filename=${this.selectedFile.name}`:"https://trial.ezofis.com"!==t||Object(d["c"])(e)?"https://app.ezofis.com"===t?`https://ezdocsviewer.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.workflow.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}&action=download,print`:`${t}/PDFViewer/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.workflow.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}&action=download,print`:`https://trial.ezofis.com/docsviewer/index.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.workflow.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}&action=download,print`:Object(d["b"])(e)||"http://52.172.32.88"!==t?`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`:`http://52.172.32.88/DocsViewer/index.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&type=2&filename=${this.selectedFile.name}`}},openFile(t){this.selectedFile=t;let e=location.origin;"https://ag-appsvc01.azurewebsites.net"===e||"https://ag-appsvc05.azurewebsites.net"===e||(this.fileSheet=!0)},download(t){window.open(`https://appuat.ezofis.com/ezofisapi/api/workflow/viewChecklist?wId=${this.workflowId}&id=${t}`)},downloadAll(){this.checkList.forEach(t=>{t.id&&t.template&&window.open(`https://appuat.ezofis.com/ezofisapi/api/workflow/viewChecklist?wId=${this.workflowId}&id=${t.id}`)})},attachTemplate(t){this.rowIndex=t,this.$refs.attachments.click()},searchList(){this.search?this.workflowRequestList=this.workflowRequestListData.filter(t=>{for(let e in t){let s=this._columns.findIndex(t=>t.name===e);if(s>=0&&t[e]&&String(t[e]).toLowerCase().includes(this.search.toLowerCase()))return t}}):this.workflowRequestList=this.workflowRequestListData},lastActionDuration(t){const e=t.transaction_createdAt instanceof Date?t.transaction_createdAt:new Date(t.transaction_createdAt),s=new Intl.RelativeTimeFormat("en"),i={years:31536e3,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1},o=(e.getTime()-Date.now())/1e3;for(let a in i)if(i[a]<Math.abs(o)){const t=o/i[a];return s.format(Math.round(t),a)}},getLabel(t,e){let s="";return this.form.panels.forEach(i=>{if(i.fields.length)for(let o of i.fields)if("table"===e){const e=o.settings.specific.tableColumns.find(e=>e.id===t);e&&(s=e.label)}else if(o.id===t)return void(s=o.label)}),s},validateType(t){let e=!0;return this.form.panels.forEach(s=>{if(s.fields.length)for(let i of s.fields)if(i.id===t&&"TABLE"===i.type)return void(e=!1)}),e},updateFilterBy(){},getMandatory(t){const e=this.getLabel(t);for(let s of this.panels)for(let t of s.fields)if(t.label===e)return"REQUIRED"===t.settings.validation.fieldRule;return!1},getFormData(t,e){const s={};if(t.formData&&t.formData.fields)for(let i of Object.keys(t.formData.fields))if(e){const e=this.getLabel(i);s[e]=this.removeTags(t.formData.fields[i])}else s[i]=this.removeTags(t.formData.fields[i]);return s},removeTags(t){return t?t.replace(/(<([^>]+)>)/gi,""):""},logOut(){window.localStorage.clear(),this.$router.push({name:"portals-signin"})},export_Data(){let t=[];t=this.workflowRequestList.map(t=>({"Request Number":t.requestNo,"Raised By":t.raisedBy,"Raised At":this.$day.format(t.raisedAt),Stage:t.stage,...this.getFormData(t,!0)})),t.length&&Object(et["a"])(t)},async getPortal(){this.$store.commit("showLoadingBar");const{error:t,payload:e}=await v["m"].getPortal(this.portalId);if(this.$store.commit("hideLoadingBar"),t)this.$alert.error(t);else if(e){if(e.settingsJson){let t=JSON.parse(e.settingsJson);t.authentication&&"MASTER_LOGIN"===t.authentication.loginType&&(this.portalMasterFormId=t.authentication.formId,this.portalSettingJson=t.authentication,this.getMasterForm())}this.title=e.name,this.formId="",this.form=null,this.workflowId="",this.checkList=[],this.saveAction="",this.workflowFormModel={},this.actions=[],this.processLevel=[],this.docWarning=!1,this.attachmentList=[],this.commentsList=[],this.workflowId=e.workflowId,this.trackRequest=!0,this.subWorkflowFormList=[],this.getWorkflow()}},async getWorkflow(){this.$store.commit("showLoadingBar");const{error:t,payload:e}=await v["t"].getWorkflow(this.workflowId);if(this.$store.commit("hideLoadingBar"),t)return void this.$alert.error(t);this.workflow=e;let s=JSON.parse(this.workflow.flowJson),i=s.blocks.find(t=>"START"===t.type);i&&i.settings.initiateBy.indexOf("PORTAL")>-1&&(this.initiate=!0);let o=[];s.blocks.forEach(t=>{"START"===t.type||"INTERNAL_ACTOR"===t.type||"END"===t.type?this.processLevel.push({id:t.id,label:t.settings.label}):"WORKFLOW_CONNECTOR"===t.type&&(console.log(t),o.push(t.settings.subWorkflowId))}),o.length,s.settings.general.initiateUsing.formId&&this.getForm(s.settings.general.initiateUsing.formId),this.getRepository()},async getForm(t){this.$store.commit("showLoadingBar");const{error:e,payload:s}=await v["g"].getForm(t);if(this.$store.commit("hideLoadingBar"),e)return void this.$alert.error(e);this.formId=t.toString(),this.form=JSON.parse(s.formJson);const i=[...this.form.panels,...this.form.secondaryPanels];if(!i.length)return;let o=[];for(const a of i)o.push(...a.fields);o.forEach(t=>{"DIVIDER"===t.type||"LABEL"===t.type||"PARAGRAPH"===t.type||!t.label&&"TABLE"!==t.type||"DISABLE"===t.settings.general.visibility||this.formFields.push({id:this.$nano.id(),label:t.label||t.type,value:t.id,type:t.type,settings:t.settings})}),this.trackRequest&&this.getRequestList(!0)},async getComments(t){this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=0)}),this.commentsList=[],this.$store.commit("showLoadingBar");const{error:e,payload:s}=await v["t"].getProcessComments(t||this.workflow.id,this.selectedProcess.processId);this.$store.commit("hideLoadingBar"),e?this.$alert.error(e):s.length&&(this.commentsList=s,this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=this.commentsList.length)}))},async saveComment(){if(this.commentText)if(this.selectedProcess.processId){this.$store.commit("showLoadingBar");const{error:t}=await v["t"].insertProcessComment(this.workflow.id,this.selectedProcess.processId,this.selectedProcess.transactionId,{comments:this.commentText,showTo:this.commentAction});if(this.$store.commit("hideLoadingBar"),t)return void this.$alert.error(t);this.commentText="",this.getComments()}else this.commentsList.push({comments:this.commentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id}),this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=this.commentsList.length)}),this.commentText=""},async saveAdvancedComment(){if(this.advancedCommentText)if(this.selectedProcess.processId){this.$store.commit("showLoadingBar");const{error:t}=await v["t"].insertProcessComment(this.workflow.id,this.selectedProcess.processId,this.selectedProcess.transactionId,{comments:this.advancedCommentText,showTo:this.commentAction});if(this.$store.commit("hideLoadingBar"),t)return void this.$alert.error(t);this.advancedCommentText="",this.advancedCommentsSheet=!1,this.getComments()}else this.commentsList.push({comments:this.advancedCommentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id}),this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=this.commentsList.length)}),this.advancedCommentText="",this.advancedCommentsSheet=!1},async getRepository(){const{error:t,payload:e}=await v["p"].getRepository(this.workflow.repositoryId);t?this.$alert.error(t):(this.repositoryDetails=e,this.repositoryField=e.fields)},saveMetaData(t){let e=[];if(this.repositoryField.forEach(s=>{e.push({name:s.name,value:t[s.name],type:s.dataType})}),e.forEach(t=>{let e=this.formFields.find(e=>Object(k["a"])(e.label)===Object(k["a"])(t.name));e&&t.value&&(this.workflowModel[e.value]=t.value)}),this.fileUploadForControl){this.metaDataModal=t;let s=this.fileUploadInput;this.uploadFilesFromForm(s.files,s.control,s.fieldId,JSON.stringify(e),s.aiSettings)}else this.uploadAttachments(this.selectedUploadFile,JSON.stringify(e))},closeMetaDataEditModal(){this.showMetaDataEditModal=!1,this.$refs.attachments&&(this.$refs.attachments.value=null)},async uploadWflowAttachments(t){this.fileUploadForControl=!1,"STATIC"===this.repositoryDetails.fieldsType?(this.selectedUploadFile=t,this.uploadFilename=t.target.files[0].name,this.showMetaDataEditModal=!0):this.uploadAttachments(t)},async uploadAttachments(t,e){if(this.selectedProcess.processId){const e=t.target.files[0],i=new FormData;i.append("workflowId",this.workflow.id),i.append("repositoryId",this.workflow.repositoryId),i.append("processId",this.selectedProcess.processId),i.append("transactionId",this.selectedProcess.transactionId),i.append("fields",""),i.append("file",e);let o=t.target.files[0].name;const a=o.split(".").pop();if(this.rowIndex){let t=this.checkList.filter(t=>t.uid===this.rowIndex);i.append("filename",t[0].name+"."+a),o=t[0].name+"."+a}if(!Object(d["a"])(a))return void this.$alert.info("This file format is not supported");this.$store.commit("showLoadingBar");try{const e=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/workflow/attachmentWithProcessId",method:"POST",data:i,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}}),{status:s,data:o}=e;if(t.target.value="",200!==s||!o)throw e;this.$alert.success("Document attached")}catch(s){this.$alert.error("Error uploading file"),console.error(s)}this.$store.commit("hideLoadingBar"),this.checkList.length&&this.checkList.forEach(t=>{if(t.uid===this.rowIndex)return t.attach=!0,void(this.fileUploadRequired=!this.fileUploadRequired)}),t.target.value=""}else{const i=t.target.files[0],o=new FormData;o.append("file",i),o.append("repositoryId",this.workflow.repositoryId),e&&(this.fileData=JSON.parse(e),o.append("fields",e));let a=t.target.files[0].name;const r=a.split(".").pop();if(this.rowIndex){let t=this.checkList.filter(t=>t.uid===this.rowIndex);o.append("filename",t[0].name+"."+r),a=t[0].name+"."+r}if(!Object(d["a"])(r))return void this.$alert.info("This file format is not supported");this.$store.commit("showLoadingBar");try{const e=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/upload",method:"POST",data:o,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}});this.$store.commit("hideLoadingBar");const{status:s,data:r}=e;if(t.target.value="",200!==s)throw"Invalid response";let n=JSON.parse(r);this.attachmentList.push({id:Number(n.fileId),name:a,createdAt:(new Date).toISOString(),createdByEmail:this.$store.state.session.email,size:i.size,initiate:!0,uid:this.rowIndex}),this.$alert.success("Document attached"),this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length)}),this.checkList.length&&this.checkList.forEach(t=>{if(t.uid===this.rowIndex)return t.attach=!0,void(this.fileUploadRequired=!this.fileUploadRequired)})}catch(s){console.error(s),this.$alert.error("error attaching file")}}},async getAttachments(t=0){if(this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=0)}),this.selectedProcess.processId){this.checkList=[];let e=JSON.parse(this.workflow.flowJson),s=e.blocks.find(t=>t.id===this.selectedProcess.activityId);s&&s.settings.fileSettings&&s.settings.fileSettings.fileCheckList.length&&(this.checkList=s.settings.fileSettings.fileCheckList,this.checkList.forEach(t=>{t.uid=this.$nano.id(),t.attach=!1,this.fileUploadRequired=!this.fileUploadRequired}));let i=this.attachmentList.length;this.$store.commit("showLoadingBar");const{error:o,payload:a}=await v["t"].getAttachments(t||this.workflow.id,this.selectedProcess.processId);if(this.$store.commit("hideLoadingBar"),o)return void this.$alert.error(o);a.length?(this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=a.length)}),i!==a.length&&(this.attachmentList=a.map(t=>({...t,checked:!1})))):this.attachmentList=[],this.checkList.length&&(this.checkList.forEach(t=>{let e=this.attachmentList.filter(e=>{let s=e.name.substr(0,e.name.lastIndexOf("."));if(t.name===s)return e});e.length?t.attach=!0:t.attach=!1,this.fileUploadRequired=!this.fileUploadRequired}),this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length)}))}},async attachmentDelete(t){if(t.fileControl){let e=this.workflowModel[t.fieldId];if(e.length){let s=e.findIndex(e=>e.fileId===t.id);s>=0&&this.workflowModel[t.fieldId].splice(s,1);let i=this.formUploadFiles.findIndex(e=>e.fileId===t.id&&e.fileId===t.fileId);i>=0&&this.formUploadFiles.splice(s,1),t.control.length&&t.control.forEach(t=>{this.workflowModel[t]=""})}let s=this.attachmentList.findIndex(t=>t.fileControl);s>=0&&(this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length-1)}),this.attachmentList.splice(s,1))}else if(this.$store.commit("showLoadingBar"),t.initiate){const{error:e}=await v["r"].deleteUploadedFiles([t.id]);if(e)return void this.$alert.error(e);this.$store.commit("hideLoadingBar"),this.attachmentList=this.attachmentList.filter(e=>e.id!==t.id),this.checkList.forEach(e=>{e.uid===t.uid&&(e.attach=!1,this.fileUploadRequired=!this.fileUploadRequired)}),this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length)})}else{const{error:e}=await v["p"].fileDelete(this.workflow.repositoryId,t.id);if(e)return void this.$alert.error(e);this.$store.commit("hideLoadingBar"),this.getAttachments()}},checkRequiredDocuments(){let t=[];if(t=this.checkList.filter(t=>t.required&&!t.attach),t.length){let t=location.origin;"https://demo.ezofis.com"===t||"http://52.172.32.88"===t?1==this.portalId?this.documentAlertModal=!0:this.alertModal=!0:this.docWarning?this.alertModal=!0:(this.$alert.warning("Mandatory documents required"),this.saveAction="",this.workflowFormModel={})}else this.initiateRequest()},closeAlertModal(){this.saveAction="",this.workflowFormModel={},this.alertModal=!1},closeDocumentAlertModal(){this.saveAction="",this.workflowFormModel={},this.documentAlertModal=!1},async initiateRequest(){let t=[];this.attachmentList.length&&this.attachmentList.forEach(e=>{e.formAttach||t.push(e.id)});let e=[];this.docWarning&&(e=this.checkList.filter(t=>t.required&&!t.attach));let s=[];this.formFields.forEach(t=>{if("FILE_UPLOAD"===t.type&&this.workflowModel[t.value]){let e=[];this.workflowModel[t.value].forEach(t=>{t.fileId&&e.push(t.fileId)}),e.length&&s.push({jsonId:t.value,fileIds:e}),delete this.workflowFormModel[t.value]}});let i={workflowId:this.workflow.id,review:"Save"===this.saveAction?"":this.saveAction,comments:this.commentsList,formData:{formId:this.formId,fields:this.workflowFormModel,formUpload:s},fileIds:t,fileChecklistStatus:this.docWarning?1:0,fileInfo:e,portalId:this.portalId,hasFormPDF:this.generatePDF};this.saveAction="",this.workflowFormModel={},this.$store.commit("showLoadingBarSave");const{error:o,payload:a}=await v["t"].processTransaction(i);if(this.$store.commit("hideLoadingBarSave"),o)return void this.$alert.error(o);this.alertModal=!1,this.$alert.success(a.requestNo+" Request Initiated"),this.refNo=a.requestNo,this.refresh(a.requestNo);let r=location.origin;("https://demo.ezofis.com"===r||"http://52.172.32.88"===r)&&1==this.portalId?this.successModalClaim=!0:this.successModal=!0,this.resetList()},async processRequest(){let t=[];this.formFields.forEach(e=>{if("FILE_UPLOAD"===e.type&&this.workflowModel[e.value]){let s=[];this.workflowModel[e.value].forEach(t=>{t.fileId&&s.push(t.fileId)}),s.length&&t.push({jsonId:e.value,fileIds:s}),delete this.workflowFormModel[e.value]}});let e={};this.formId&&(e={workflowId:this.workflow.id,transactionId:this.selectedProcess.transactionId,review:"Save"===this.saveAction?"":this.saveAction,formData:{formId:this.formId,formEntryId:this.selectedProcess.formData.formEntryId,fields:this.workflowFormModel,formUpload:t}}),this.saveAction="",this.workflowFormModel={},this.$store.commit("showLoadingBarSave");const{error:s}=await v["t"].processTransaction(e);this.$store.commit("hideLoadingBarSave"),s?this.$alert.error(s):(""===e.review?this.$alert.info(this.selectedProcess.requestNo+" data saved, awaiting your action to submit"):e.review.toLowerCase().indexOf("reject")>-1?this.$alert.danger(this.selectedProcess.requestNo+" Request Rejected Successfully"):this.$alert.success(this.selectedProcess.requestNo+" Request Processed"),this.fileControlDeleteFile.length&&(this.fileControlDeleteFile.forEach(t=>{this.fileControlDeletedFile(t)}),this.fileControlDeleteFile=[]),this.processSheet=!1,this.getRequestList())},async getRequestList(t){this.workflow.id&&(this.loadingBarContent=!0,this.workflowRequestList=[],this.inbox?(await this.getInboxList(),await this.getSubWorkflowInboxList(),t&&(await this.getSentCount(),await this.getCompletedCount())):(await this.getSentList(),await this.getCompletedList()),this.workflowRequestListData=this.workflowRequestList.map(t=>({...t,...this.getFormData(t)})),this.loadingBarContent=!1)},async getSentCount(){const{error:t,payload:e}=await v["t"].getSentList(this.workflow.id,{filterBy:[],itemsPerPage:100,currentPage:1});t?this.$alert.error(t):e.data.forEach(t=>{t.value.forEach(t=>{let e=this.workflowRequestList.filter(e=>e.processId===t.processId);if(0===e.length){let e=!0;t.subworkflowTransaction&&t.subworkflowTransaction.length&&t.subworkflowTransaction.forEach(t=>{t.activityUserId!==this.$store.state.session.id||(e=!1)}),e&&(this.processCount+=1)}})})},async getCompletedCount(){const{error:t,payload:e}=await v["t"].getCompletedList(this.workflow.id,{filterBy:[],itemsPerPage:100,currentPage:1});t?this.$alert.error(t):e.data.forEach(t=>{t.value.forEach(t=>{let e=this.workflowRequestList.filter(e=>e.processId===t.processId);0===e.length&&(this.processCount+=1)})})},async getSentList(){var t;const{error:e,payload:s}=await v["t"].getSentList(this.workflow.id,{filterBy:[],itemsPerPage:100,currentPage:1});e?this.$alert.error(e):(this.totalItems=this.totalItems+(null===(t=s.meta)||void 0===t?void 0:t.totalItems)||0,s.data.forEach(t=>{t.value.forEach(t=>{let e=this.workflowRequestList.filter(e=>e.processId===t.processId);if(0===e.length){let e=!0;if(t.subworkflowTransaction&&t.subworkflowTransaction.length&&t.subworkflowTransaction.forEach(t=>{t.activityUserId!==this.$store.state.session.id||(e=!1)}),e){let e=0,s=JSON.parse(this.workflow.flowJson),i=!0;s.blocks.forEach(s=>{s.id!==t.activityId&&i?e+=1:(1==t.flowStatus&&(e+=1),i=!1)}),this.workflowRequestList.push({...t,step:e,visible:!0,expand:!1,inbox:!1}),this.workflowRequestList.sort((t,e)=>new Date(e.transaction_createdAt)-new Date(t.transaction_createdAt))}}})}),this.processCount=this.workflowRequestList.length)},async getCompletedList(){var t;const{error:e,payload:s}=await v["t"].getCompletedList(this.workflow.id,{filterBy:[],itemsPerPage:100,currentPage:1});e?this.$alert.error(e):(this.totalItems=this.totalItems+(null===(t=s.meta)||void 0===t?void 0:t.totalItems)||0,s.data.forEach(t=>{t.value.forEach(t=>{let e=this.workflowRequestList.filter(e=>e.processId===t.processId);if(0===e.length){let e=0,s=JSON.parse(this.workflow.flowJson),i=!0;s.blocks.forEach(s=>{s.id!==t.activityId&&i?e+=1:(1==t.flowStatus&&(e+=1),i=!1)}),this.workflowRequestList.push({...t,step:e,visible:!0,expand:!1,inbox:!1}),this.workflowRequestList.sort((t,e)=>new Date(e.transaction_createdAt)-new Date(t.transaction_createdAt)),this.workflowRequestList.sort((t,e)=>new Date(e.inbox)-new Date(t.inbox))}})}),this.processCount=this.workflowRequestList.length)},async getInboxList(){var t;const{error:e,payload:s}=await v["t"].getInboxList(this.workflow.id,{filterBy:[],itemsPerPage:100,currentPage:1});e?this.$alert.error(e):(this.totalItems=(null===(t=s.meta)||void 0===t?void 0:t.totalItems)||0,s.data.forEach(t=>{t.value.forEach(t=>{let e=this.workflowRequestList.filter(e=>e.processId===t.processId);if(0===e.length){let e=0,s=JSON.parse(this.workflow.flowJson),i=!0;s.blocks.forEach(s=>{s.id!==t.activityId&&i?e+=1:(1==t.flowStatus&&(e+=1),i=!1)}),this.workflowRequestList.push({...t,step:e,visible:!0,expand:!1,inbox:!0}),this.workflowRequestList.sort((t,e)=>new Date(e.transaction_createdAt)-new Date(t.transaction_createdAt))}})}),this.inboxCount=this.workflowRequestList.length)},async getSubWorkflowInboxList(){var t;const{error:e,payload:s}=await v["t"].getSentList(this.workflow.id,{filterBy:[],itemsPerPage:100,currentPage:1});e?this.$alert.error(e):(this.totalItems=this.totalItems+(null===(t=s.meta)||void 0===t?void 0:t.totalItems)||0,s.data.forEach(t=>{t.value.forEach(t=>{let e=this.workflowRequestList.filter(e=>e.processId===t.processId);if(0===e.length){let e=!1;if(t.subworkflowTransaction&&t.subworkflowTransaction.length&&t.subworkflowTransaction.forEach(t=>{t.activityUserId!==this.$store.state.session.id||(e=!0)}),e){let e=0,s=JSON.parse(this.workflow.flowJson),i=!0;s.blocks.forEach(s=>{s.id!==t.activityId&&i?e+=1:(1==t.flowStatus&&(e+=1),i=!1)}),this.workflowRequestList.push({...t,step:e,visible:!0,expand:!1,inbox:!1}),this.workflowRequestList.sort((t,e)=>new Date(e.transaction_createdAt)-new Date(t.transaction_createdAt))}}})}),this.inboxCount=this.workflowRequestList.length)},async refresh(t){this.$store.commit("showLoadingBar");const{error:e,payload:s}=await v["t"].getSentList(this.workflow.id,{filterBy:[],itemsPerPage:100,currentPage:1});if(this.$store.commit("hideLoadingBar"),e)this.$alert.error(e);else if(s.data.length){const e=s.data[0].value.findIndex(e=>e.requestNo===t);e<0?await this.refresh(t):this.getRequestList()}else await this.refresh(t)},openNewRequest(){this.btnAction=!1,this.selectedProcess={},this.formModel={},this.commentsList=[],this.attachmentList=[],this.actions=[],this.ocrResult=[],this.uploadAccess=!0,this.tabs.find(t=>{t.count=0});let t=JSON.parse(this.workflow.flowJson),e=t.blocks.find(t=>"START"===t.type);if(e){if(e.settings.initiateBy.indexOf("PORTAL")>-1){this.headerTitle=e.settings.label,e.settings.fileSettings&&e.settings.fileSettings.fileCheckList.length&&(this.checkList=e.settings.fileSettings.fileCheckList,this.checkList.forEach(t=>{t.uid=this.$nano.id(),t.attach=!1,this.fileUploadRequired=!this.fileUploadRequired}),this.docWarning=e.settings.fileSettings.partial);let s=t.rules.find(t=>t.fromBlockId===e.id);s&&this.actions.push(s.proceedAction)}e.settings.formEditAccess&&(""===e.settings.formEditAccess?(this.formEditAccess=!0,this.formEditControls=[]):"FULL"===e.settings.formEditAccess?(this.formEditAccess=!1,this.formEditControls=[]):"PARTIAL"===e.settings.formEditAccess&&(this.formEditAccess=!1,this.formEditControls=e.settings.formEditControls)),e.settings.formVisibilityAccess?(this.formVisibilityAccess=!0,this.formSecureControls=[]):(this.formVisibilityAccess=!1,this.formSecureControls=e.settings.formSecureControls),this.generatePDF=e.settings.generatePDF?1:0}this.selectedNode="inbox",this.processSheet=!0,this.portalMasterFormId&&this.getMasterFormData(this.portalMasterFormId)},async openProcess(t){if(this.btnAction=!1,this.actions=[],this.selectedProcess=t,this.formModel={},this.itemModel={},this.formEditAccess=!0,this.attachmentList=[],this.commentsList=[],this.ocrResult=[],this.formView=!1,this.uploadAccess=!1,this.selectedProcess.formData){let t=Object.keys(this.selectedProcess.formData.fields),e={};t.forEach(t=>{e[t]=this.validateTypeValue(this.selectedProcess.formData.fields[t])}),this.formModel=e}if(this.headerTitle=this.selectedProcess.requestNo,this.selectedProcess.inbox){this.uploadAccess=!0,this.formView=!0;let t=JSON.parse(this.workflow.flowJson),e=t.blocks.find(t=>t.id===this.selectedProcess.activityId);if(e){if(e.settings.fileSettings&&e.settings.fileSettings.fileCheckList.length&&(this.checkList=e.settings.fileSettings.fileCheckList,this.checkList.forEach(t=>{t.uid=this.$nano.id(),t.attach=!1,this.fileUploadRequired=!this.fileUploadRequired}),this.docWarning=e.settings.fileSettings.partial),t.rules.forEach(t=>{t.fromBlockId===this.selectedProcess.activityId&&this.actions.indexOf(t.proceedAction)<0&&(this.actions.push(t.proceedAction),this.processActionsAddOn.push({action:t.proceedAction,remarks:t.remarks||!1,passwordAccess:t.passwordAccess||!1,confirm:t.confirm||!1}))}),e.settings.formEditAccess&&(""===e.settings.formEditAccess?(this.formEditAccess=!0,this.formEditControls=[]):"FULL"===e.settings.formEditAccess?(this.formEditAccess=!1,this.formEditControls=[]):"PARTIAL"===e.settings.formEditAccess&&(this.formEditAccess=!1,this.formEditControls=e.settings.formEditControls)),e.settings.formVisibilityAccess?(this.formVisibilityAccess=!0,this.formSecureControls=[]):(this.formVisibilityAccess=!1,this.formSecureControls=e.settings.formSecureControls),t.settings.general.processNumberPrefix.indexOf("[")>-1){let e=JSON.parse(t.settings.general.processNumberPrefix);this.readonlyControls=[];let s=e.filter(t=>"formColumn"===t.key);s.length&&s.forEach(t=>{this.readonlyControls.push(t.value),this.formEditControls.splice(this.formEditControls.indexOf(t.value),1)})}this.generatePDF=e.settings.generatePDF?1:0}}this.actions.length?this.selectedNode="inbox":this.selectedNode="sent",this.getComments(),this.getAttachments(),this.processSheet=!0},validateTypeValue(t){if(t)try{var e=JSON.parse(t);if("object"===typeof e)return e}catch(s){return t}return t},async getWorkflowData(t){var e;this.$store.commit("showLoadingBar"),this.workflowRequestList=[];const{error:s,payload:i}=await v["o"].getWorkflowData(this.workflow.id,{filterBy:t,itemsPerPage:100,currentPage:1,mode:""});this.$store.commit("hideLoadingBar"),s?this.$alert.error(s):(this.totalItems=(null===(e=i.meta)||void 0===e?void 0:e.totalItems)||0,i.data.forEach(t=>{t.value.forEach(t=>{let e=0,s=JSON.parse(this.workflow.flowJson),i=!0;s.blocks.forEach(s=>{s.id!==t.activityId&&i?e+=1:(1==t.flowStatus&&(e+=1),i=!1)}),this.workflowRequestList.push({...t,step:e,visible:!0,expand:!1,inbox:!1}),this.workflowRequestList.sort((t,e)=>new Date(e.transaction_createdAt)-new Date(t.transaction_createdAt))})}))},async getUsers(){this.userList=[];const{error:t,payload:e}=await v["s"].getUserList();t?this.$alert.error("Error fetching users"):e&&e.map(t=>{this.userList.push({id:this.$nano.id(),label:t.value,value:String(t.id)})})},documentAction(t){if("Email_Sharing"===t.id);else if("Print"===t.id){if(this.selectedFile.name){let t=this.selectedFile.name.split(".").pop();Object(d["d"])(t)?(localStorage.setItem("filePrint",!0),localStorage.setItem("filePrintId",this.selectedFile.id)):this.$refs.myFiles.contentWindow.print()}this.filePrintSession()}else if("Download"===t.id){let t="";t=`https://appuat.ezofis.com/ezofisapi/api/menu/file/download/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`,window.open(t,"_blank")}},closeSubProcess(){this.openSubProcessSheet=!1,this.subProcessData={},this.getRequestList()},mandatoryControlsList(t){this.mandatory=t},deletedFiles(t,e){if(this.fileControlDeleteFile.push(t),e){e.controls&&e.controls.length&&e.controls.forEach(t=>{this.workflowModel[t]=""}),this.ocrResult=[];let t=this.attachmentList.findIndex(t=>t.name===e.file.name&&t.id===e.file.fileId&&t.fileControl);t>=0&&(this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length-1)}),this.attachmentList.splice(t,1))}},checkFormValidation(){this.hasCheckFormValidate=!0},async filePrintSession(){const{error:t}=await v["k"].filePrintSession({repositoryId:this.selectedFile.repositoryId,itemId:this.selectedFile.id,activityId:4});t&&this.$alert.error(t)},async openSubProcess(t){this.subWorkflowId=t.id,this.loadingBarContent=!0;const{payload:e}=await v["o"].getWorkflowData(this.subWorkflowId,{filterBy:[{filters:[{criteria:"requestNo",condition:"IS_EQUALS_TO",value:t.requestNo,valueTo:"",arrayValue:"",dataType:"SHORT_TEXT"}],groupCondition:""}],itemsPerPage:10,currentPage:1,mode:""});this.loadingBarContent=!1;const{data:s}=e;s.length&&s[0].value.length&&(this.subProcessData=s[0].value[0],this.subProcessData.inbox=t.inbox,this.openSubProcessSheet=!0)},async uploadFilesFromForm(t,e,s,i,o){this.formUploadFiles=[];const a=new FormData;if(t.length){for(let l of t){if(l.name&&!l.error){a.append("repositoryId",this.workflow.repositoryId),a.append("file",l),a.append("filename",l.name),i?a.append("fields",i):a.append("fields",""),Object(lt["a"])(o)||o.formControlValidate&&("MASTER"===o.formControlValidate.optionsType&&(a.append("masterFormId",o.formControlValidate.masterFormId),a.append("masterFormColumn",o.formControlValidate.masterFormColumn)),o.fileDataValidate.length&&a.append("isValidateFile",o.fileDataValidate.includes("EXPIRY_DATE")));try{const t=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/upload",method:"POST",data:a,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"},onUploadProgress:function(t){let e=Math.round(100*t.loaded/t.total),i=this.workflowModel[s].findIndex(t=>t.name===l.name);i>=0&&(this.$set(this.workflowModel[s][i],"uploadedPercentage",0),this.workflowModel[s][i].uploadedPercentage=e>50&&100!==e?e:98)}.bind(this)}),{status:i,data:o}=t;if(200!==i)throw"Invalid response";l.createdAt=this.$day.newDateTime(),l.createdBy=this.$store.state.session.email;let r=JSON.parse(o);l.fileId=r.fileId,l.fieldId=s,l.fileDataValidate=r.OCRfieldlist,this.attachmentList.push({id:Number(r.fileId),name:l.name,createdAt:(new Date).toISOString(),createdByEmail:this.$store.state.session.email,size:l.size,initiate:!0,formAttach:!0,fileControl:!0,fieldId:s,control:e}),this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length)})}catch(r){console.error(r),this.$alert.error("error attaching file")}}let t=this.workflowModel[s].findIndex(t=>t.name===l.name);t>=0&&(this.workflowModel[s][t].uploadedPercentage=100)}let n=Array.from(t);this.formUploadFiles=[];for(let t of n)if(t.name){const e=await Object(rt["a"])(t);this.formUploadFiles.push({name:t.name,size:t.size,file:e,fileId:t.fileId,createdBy:t.createdBy,createdAt:t.createdAt,workflowId:this.selectedProcess.id,processId:this.selectedProcess.processId,fieldId:t.fieldId,fileDataValidate:t.fileDataValidate})}e&&e.length&&e.forEach(t=>{let e=this.readonlyControls.findIndex(e=>e===t);e>=0&&this.readonlyControls.splice(e,1)}),this.$store.commit("hideLoadingBarSave")}},async fileControlDeletedFile(t){this.$store.commit("showLoadingBar");let e=[];t.forEach(t=>{t.id&&e.push(t.id)});let s={ids:e,formInfo:{formId:this.formId,formEntryId:this.selectedProcess.formData.formEntryId,jsonId:t[0].jsonId}};const{error:i}=await v["p"].fileControlDeleteFile(this.workflow.repositoryId,s);this.$store.commit("hideLoadingBar"),i&&this.$alert.error(i)},async getSubWorkflows(t){const{error:e,payload:s}=await v["t"].getWorkflows({mode:"BROWSE",sortBy:{criteria:"",order:"DESC"},groupBy:"",filterBy:[{filters:[{criteria:"id",condition:"IS_EQUALS_TO",value:"["+t.toString()+"]",dataType:"SINGLE_SELECT"}],groupCondition:""}],itemsPerPage:0,currentPage:0,hasSecurity:!1});if(e)this.$alert.error("Error fetching workflows");else if(s&&s.data.length){let t=[];s.data[0].value.forEach(e=>{t.push(e.wFormId)}),t.length&&await this.getSubWorkflowForms(t)}},async getSubWorkflowForms(t){const{error:e,payload:s}=await v["g"].getForms({mode:"BROWSE",sortBy:{criteria:"",order:"DESC"},groupBy:"",filterBy:[{filters:[{criteria:"id",condition:"IS_EQUALS_TO",value:"["+t.toString()+"]",dataType:"SINGLE_SELECT"}],groupCondition:""}],itemsPerPage:0,currentPage:0,hasSecurity:!1});e?this.$alert.error("Error fetching forms"):s&&s.data.length&&s.data[0].value.forEach(t=>{this.subWorkflowFormList.push({id:t.id,name:t.name,formJson:t.formJson})})},async uploadFileForControl(t,e,s,i){if(this.fileUploadInput={files:t,control:e,fieldId:s,aiSettings:i},"STATIC"===this.repositoryDetails.fieldsType){let t=this.getLabel(s);this.uploadFilename=t;const e=this.repositoryField.reduce((t,e)=>e.level>t.level?e:t,this.repositoryField[0]),i=e.id;if(this.attachmentList.length){let t=this.attachmentList.length-1;await this.getFileData(this.attachmentList[t],"file")}const o=this.fileData.find(t=>i==t.id),a={id:e.id,name:e.name,value:t,type:e.dataType};this.fileData.length?o.value=t:this.fileData.push(a);const r=this.repositoryField.filter(t=>!0===t.isMandatory).map(t=>t.id),n=r.every(t=>{const e=this.fileData.find(e=>e.id===t);return e&&""!==e.value});if(this.showMetaDataEditModal=!n,n){const t={};this.fileData.forEach(e=>{t[e.name]=""!==e.value?e.value:""}),this.fileUploadForControl=!0,this.saveMetaData(t)}else this.fileUploadForControl=!0,this.showMetaDataEditModal=!0}else this.uploadFilesFromForm(t,e,s,"",i)},async getFileData(t,e){const{error:s,payload:i}=await v["p"].getFileData({repositoryId:t.repositoryId,itemId:t.id});s?this.$alert.error(s):i&&(t.fileData?this.fileData=t.fileData:this.fileData=i,"file"!==e&&(this.fileDetailsSheet=!0))},async getOCRResult(t,e,s,i){const o=new FormData;let a=[];if(e&&e.length){if(e.forEach(t=>{this.readonlyControls.push(t)}),e.forEach(t=>{let e=this.formFields.find(e=>e.value===t);e&&a.push(`${e.label}, ${e.type}`)}),t.length){for(let e of t){if(e.name&&!e.error){o.append("repositoryId",this.workflow.repositoryId),o.append("file",e),a.length&&o.append("formFields",JSON.stringify(a));try{const t=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/uploadforStaticMetadata",method:"POST",data:o,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"},onUploadProgress:function(t){let i=Math.round(100*t.loaded/t.total),o=this.workflowModel[s].findIndex(t=>t.name===e.name);o>=0&&(this.$set(this.workflowModel[s][o],"uploadedPercentage",0),this.workflowModel[s][o].uploadedPercentage=i<50?i:49)}.bind(this)}),{status:i,data:a}=t;if(200!==i)throw"Invalid response";let r=Object(nt["a"])(a,this.$store.state.identity.key,this.$store.state.identity.iv),n=JSON.parse(r),l=JSON.parse(n),c=JSON.parse(l);Array.isArray(c)&&(c.forEach(t=>{let e=this.formFields.find(e=>e.label===t.name);e&&t.value&&(this.workflowModel[e.value]=t.value)}),this.ocrResult=c)}catch(r){console.error(r),this.$alert.error("error on get ocr result")}}this.workflowModel[s].findIndex(t=>t.name===e.name)}this.$store.commit("hideLoadingBarSave"),this.uploadFileForControl(t,e,s,i)}}else this.uploadFileForControl(t,e,s,i)},async getMasterForm(){this.$store.commit("showLoadingBar");const{error:t,payload:e}=await v["g"].getForm(this.portalMasterFormId);this.$store.commit("hideLoadingBar"),t?this.$alert.error(t):e.controllist.length&&(this.masterFormFields=e.controllist)},async getMasterFormData(t){this.$store.commit("showLoadingBar");let e=[];"string"===typeof this.portalSettingJson.usernameField?e.push({filters:[{criteria:this.portalSettingJson.usernameField,condition:"IS_EQUALS_TO",value:this.$store.state.session.email,dataType:"SHORT_TEXT"}],groupCondition:""}):this.portalSettingJson.usernameField.forEach(t=>{e.push({filters:[{criteria:t,condition:"IS_EQUALS_TO",value:this.$store.state.session.email,dataType:"SHORT_TEXT"}],groupCondition:e.length>0?"OR":""})});const{error:s,payload:i}=await v["g"].getFormEntries(t,{mode:"BROWSE",sortBy:{criteria:"",order:"DESC"},groupBy:"",filterBy:e,itemsPerPage:10,currentPage:1,portalId:this.portalId});if(this.$store.commit("hideLoadingBar"),s)return void this.$alert.error(s);const{data:o}=i;if(o.length&&o[0].value.length){let t=o[0].value[0];this.formFields.forEach(e=>{let s=this.masterFormFields.find(t=>Object(k["a"])(t.name)===Object(k["a"])(e.label));s&&(this.workflowModel[e.value]=t[s.jsonId])})}},attachmentCount(t){this.tabs.find(e=>{"ATTACHMENTS"===e.value&&(e.count=t)})},commentsCount(t){this.tabs.find(e=>{"COMMENTS"===e.value&&(e.count=t)})},getColumns(){this.formFields=[];let t=location.origin;this.columns=[{id:"requestNo",name:"requestNo",label:"Request No",type:"TITLE",isVisible:!0,isSortable:!0,dataType:ht["a"].SHORT_TEXT}],this.isTenantGOTO()&&this.columns.push({id:"mlCondition",name:"mlCondition",label:"",type:"MLCONDITION",isVisible:!0,dataType:ht["a"].SHORT_TEXT,isFilter:!1}),(this.isTenantArmgroup()||"https://trial.ezofis.com"===t&&12===this.$store.state.session.tenantId)&&this.columns.push({id:"mlCondition",name:"mlCondition",label:"",type:"MLCONDITION",isVisible:!0,dataType:ht["a"].SHORT_TEXT,isFilter:!1});let e=[{id:"stage",name:"stage",label:"Stage",type:"NORMAL",isVisible:!0,dataType:ht["a"].SHORT_TEXT},{id:"actionUser",name:"actionUser",label:"Action User",type:"NORMAL",options:this.userList,isVisible:!0,dataType:ht["a"].SINGLE_SELECT},{id:"raisedBy",name:"raisedBy",label:"Raised By",type:"NORMAL",options:this.userList,isVisible:!0,dataType:ht["a"].SINGLE_SELECT},{id:"raisedAt",name:"raisedAt",label:"Raised On",type:"NORMAL",isVisible:!0,isSortable:!0,dataType:ht["a"].DATE},{id:"lastAction",name:"lastAction",label:"Last Action",type:"NORMAL",isVisible:!0,dataType:ht["a"].SHORT_TEXT},{id:"lastActionBy",name:"lastActionBy",label:"Last Action By",type:"NORMAL",options:this.userList,isVisible:!0,dataType:ht["a"].SINGLE_SELECT},{id:"lastActionOn",name:"lastActionOn",label:"Last Action On",type:"NORMAL",isVisible:!0,dataType:ht["a"].DATE},{id:"duration",name:"duration",label:"Duration",type:"NORMAL",isVisible:!0,dataType:ht["a"].SHORT_TEXT}];if(this.isTenantArmgroup()||"http://localhost:8080"===t||"https://trial.ezofis.com"===t&&12===this.$store.state.session.tenantId){if(this.workflow.wFormId&&this.wform.formJson){let t=JSON.parse(this.wform.formJson);const e=[...t.panels,...t.secondaryPanels];if(!e.length)return;let s=[];for(const a of e)s.push(...a.fields);let i=s.find(t=>"Initials"===t.label);i&&this.columns.push({id:i.id,name:i.id,label:i.label,type:"NORMAL",isVisible:!0,dataType:i.type,apiLoad:!0,isFilter:!0});let o=s.find(t=>"Benefit Claimed"===t.label);o&&this.columns.push({id:o.id,name:o.id,label:o.label,type:"NORMAL",isVisible:!0,dataType:o.type,apiLoad:!0,isFilter:!0})}this.columns.push({id:"stage",name:"stage",label:"Stage",type:"NORMAL",isVisible:!0,dataType:ht["a"].SHORT_TEXT},{id:"actionUser",name:"actionUser",label:"Action User",type:"NORMAL",options:this.userList,isVisible:!0,dataType:ht["a"].SINGLE_SELECT},{id:"lastAction",name:"lastAction",label:"Last Action",type:"NORMAL",isVisible:!0,dataType:ht["a"].SHORT_TEXT},{id:"lastActionBy",name:"lastActionBy",label:"Last Action By",type:"NORMAL",options:this.userList,isVisible:!0,dataType:ht["a"].SINGLE_SELECT},{id:"lastActionOn",name:"lastActionOn",label:"Last Action On",type:"NORMAL",isVisible:!0,dataType:ht["a"].DATE},{id:"duration",name:"duration",label:"Duration",type:"NORMAL",isVisible:!0,dataType:ht["a"].SHORT_TEXT},{id:"raisedBy",name:"raisedBy",label:"Raised By",type:"NORMAL",options:this.userList,isVisible:!0,dataType:ht["a"].SINGLE_SELECT},{id:"raisedAt",name:"raisedAt",label:"Raised On",type:"NORMAL",isVisible:!0,dataType:ht["a"].DATE})}else this.columns.push(...e);if(this.workflow.wFormId&&this.wform.formJson){let t=JSON.parse(this.wform.formJson);const e=[...t.panels,...t.secondaryPanels];if(!e.length)return;let s=[];for(const r of e)s.push(...r.fields);let i=JSON.parse(this.workflow.flowJson),o=[];const a=i.blocks.reduce((t,e)=>(e.settings.formSecureControls&&e.settings.formSecureControls.length&&("string"===typeof e.settings.formSecureControls[0]?e.settings.users.forEach(s=>{t.push({[s]:e.settings.formSecureControls})}):e.settings.formSecureControls.forEach(e=>{e.formFields.length&&t.push({[e.userId]:e.formFields})})),t),[]);a.forEach(t=>{t[this.$store.state.session.id]&&o.push(...t[this.$store.state.session.id])}),s.forEach(t=>{if("DIVIDER"!==t.type&&"LABEL"!==t.type&&"PARAGRAPH"!==t.type&&(t.label||"TABLE"===t.type)&&"DISABLE"!==t.settings.general.visibility)if(o.length)if("object"===typeof o[0]){let e=o.findIndex(t=>t.userId===this.$store.state.session.id);if(e>=0){let s=o[e].formFields,i=s.findIndex(e=>e===t.id);-1===i&&(this.myInbox||this.columns.push({id:t.id,name:t.id,label:t.label,type:"NORMAL",isVisible:!0,dataType:t.type,apiLoad:!0,isFilter:!0}),this.formFields.push({id:this.$nano.id(),label:t.label||t.type,value:t.id,type:t.type,settings:t.settings}))}}else{let e=o.findIndex(e=>e===t.id);-1===e&&(this.myInbox||this.columns.push({id:t.id,name:t.id,label:t.label,type:"NORMAL",isVisible:!0,dataType:t.type,apiLoad:!0,isFilter:!0}),this.formFields.push({id:this.$nano.id(),label:t.label||t.type,value:t.id,type:t.type,settings:t.settings}))}else{if(!this.myInbox){let e=this.columns.findIndex(e=>e.id===t.id);-1===e&&this.columns.push({id:t.id,name:t.id,label:t.label,type:"NORMAL",isVisible:!0,dataType:t.type,apiLoad:!0,isFilter:!0})}this.formFields.push({id:this.$nano.id(),label:t.label||t.type,value:t.id,type:t.type,settings:t.settings})}})}else this.workflow.repositoryId&&this.repository.fields&&this.repository.fields.forEach(t=>{t.name&&"TABLE"!==t.dataType&&(this.myInbox||this.columns.push({id:t.id,name:t.name,label:t.name,type:"NORMAL",isVisible:!0,dataType:t.dataType}))})}}},ut=mt,ft=(s("c76c"),s("58ea")),pt=s("2c91"),vt=s("b047"),yt=s("cb32"),wt=s("8169"),gt=s("4e73"),bt=Object(B["a"])(ut,i,o,!1,null,"3e4fef9a",null);e["default"]=bt.exports;H()(bt,"components",{QCircularProgress:ft["a"],QSpace:pt["a"],QChip:vt["a"],QAvatar:yt["a"],QChatMessage:wt["a"],QMenu:gt["a"]})},"11f5":function(t,e,s){"use strict";s("4759")},1549:function(t,e,s){"use strict";var i=s("2250"),o=s("a809"),a=s("5132"),r=s("e621");function n(t,e){return e.length<2?t:Object(a["a"])(t,Object(r["a"])(e,0,-1))}var l=n,c=s("4dc8");function d(t,e){return e=Object(i["a"])(e,t),t=l(t,e),null==t||delete t[Object(c["a"])(Object(o["a"])(e))]}e["a"]=d},"165f":function(t,e,s){"use strict";s("0be7")},"1a1b":function(t,e,s){},"2ac6":function(t,e,s){"use strict";s("0ce8")},"2e38":function(t,e,s){"use strict";s("4a61")},3002:function(t,e,s){},3256:function(t,e,s){},"381b":function(t,e,s){"use strict";const i={SHORT_TEXT:"SHORT_TEXT",NUMBER:"NUMBER",BOOLEAN:"BOOLEAN",DATE:"DATE",TIME:"TIME",DATE_TIME:"DATE_TIME",SINGLE_SELECT:"SINGLE_SELECT",TABLE:"TABLE",BARCODE:"BARCODE",OMR:"OMR",AUTO_GENERATED:"AUTO_GENERATED"};Object.freeze(i),e["a"]=i},"3d18":function(t,e,s){t.exports=s.p+"img/bell-logo.96393834.png"},4045:function(t,e,s){"use strict";s("1a1b")},"40f9":function(t,e,s){"use strict";s("c589")},"42fc":function(t,e,s){"use strict";s.d(e,"a",(function(){return B}));s("d9e2");function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t,e){if(!t)throw new Error(e)}function a(t){return Object.keys(t)}function r(t){return Object.keys(t).map((function(e){return[e,t[e]]}))}function n(t,e,s){var i="."+e,o=new RegExp("(\\".concat(e,")?$"));return s(t).replace(o,i)}function l(t){return"555xmlHello .  world!".trim().replace(/^([0-9,;]|(xml))+/,""),t.replace(/[^_a-zA-Z 0-9:\-\.]/g,"").replace(/^([ 0-9-:\-\.]|(xml))+/i,"").replace(/ +/g,"-")}function c(t){return Array(t+1).join(" ")}function d(t){return t.replace(/([<>&])/g,(function(t,e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return""}}))}function h(t,e,s){switch(e){case"txt":var i="text/plain;charset=utf-8";return s?URL.createObjectURL(new Blob([t],{type:i})):"data:,".concat(i)+encodeURIComponent(t);case"css":i="text/css;charset=utf-8";return s?URL.createObjectURL(new Blob([t],{type:i})):"data:,".concat(i)+encodeURIComponent(t);case"html":i="text/html;charset=utf-8";return s?URL.createObjectURL(new Blob([t],{type:i})):"data:,".concat(i)+encodeURIComponent(t);case"json":i="text/json;charset=utf-8";return s?URL.createObjectURL(new Blob([t],{type:i})):"data:,".concat(i)+encodeURIComponent(t);case"csv":i="text/csv;charset=utf-8";return s?URL.createObjectURL(new Blob([t],{type:i})):"data:,".concat(i)+encodeURIComponent(t);case"xls":i="text/application/vnd.ms-excel;charset=utf-8";return s?URL.createObjectURL(new Blob([t],{type:i})):"data:,".concat(i)+encodeURIComponent(t);case"xml":i="text/application/xml;charset=utf-8";return s?URL.createObjectURL(new Blob([t],{type:i})):"data:,".concat(i)+encodeURIComponent(t);default:return""}}function m(t,e,s,i){void 0===s&&(s="download"),void 0===i&&(i=!0);var o=h(t,e,i),a=document.createElement("a");a.href=o,a.download=s,a.setAttribute("style","visibility:hidden"),document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!1,view:window})),document.body.removeChild(a)}var u=function(){return u=Object.assign||function(t){for(var e,s=1,i=arguments.length;s<i;s++)for(var o in e=arguments[s],e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},u.apply(this,arguments)},f=function(t,e){var s="function"===typeof Symbol&&t[Symbol.iterator];if(!s)return t;var i,o,a=s.call(t),r=[];try{while((void 0===e||e-- >0)&&!(i=a.next()).done)r.push(i.value)}catch(n){o={error:n}}finally{try{i&&!i.done&&(s=a["return"])&&s.call(a)}finally{if(o)throw o.error}}return r};function p(t){if(!t||i(t)&&!t.length||!i(t)&&!a(t).length)return function(t){return t};var e=i(t)?t.reduce((function(t,e){var s;return u(u({},t),(s={},s[e]=e,s))}),Object.create(null)):t;return function(t){return i(t)?t.map((function(t){return r(t).reduce((function(t,s){var i=f(s,2),o=i[0],a=i[1];return o in e&&(t[e[o]]=a),t}),Object.create(null))})).filter((function(t){return a(t).length})):r(t).reduce((function(t,s){var i=f(s,2),o=i[0],a=i[1];return o in e&&(t[e[o]]=a),t}),Object.create(null))}}function v(t){var e="Invalid export data. Please provide a valid JSON";try{return"string"===typeof t?JSON.parse(t):t}catch(s){throw new Error(e)}}function y(t,e,s){void 0===e&&(e=null);var i="Invalid export data. Please provide valid JSON object";try{return JSON.stringify(t,e,s)}catch(o){throw new Error(i)}}function w(t){return t.map(r).reduce((function(e,s,i){return s.reduce((function(e,s){var o=f(s,2),a=o[0],r=o[1],n=e[a]||Array.from({length:t.length}).map((function(t){return""}));return n[i]=("string"!==typeof r?JSON.stringify(r):r)||"",e[a]=n,e}),e)}),Object.create(null))}function g(t,e){return void 0===e&&(e=function(t){return t}),e(r(t).map((function(t){var e=f(t,2),s=e[0],i=e[1];return{fieldName:s,fieldValues:i}})))}function b(t){var e=/,|"|\n/.test(t)?'"':"",s=t.replace(/"/g,'""');return"".concat(e).concat(s).concat(e)}var k={beforeTableEncode:function(t){return t},delimiter:","};function I(t,e){void 0===e&&(e={});var s=u(u({},k),e),i=s.beforeTableEncode,o=s.delimiter;if(!t.length)return"";var a=w(t),r=g(a,i),n=r.map((function(t){var e=t.fieldName;return e})).join(o)+"\r\n",l=r.map((function(t){var e=t.fieldValues;return e})).map((function(t){return t.map(b)})),c=l.reduce((function(t,e){return t.map((function(t,s){return"".concat(t).concat(o).concat(e[s])}))}));return n+c.join("\r\n")}function C(t,e){o(t.length>0);var s=w(t),i=g(s,e),a=i.map((function(t){var e=t.fieldName;return e})).join("</b></th><th><b>"),r=i.map((function(t){var e=t.fieldValues;return e})).map((function(t){return t.map((function(t){return"<td>".concat(t,"</td>")}))})),n=r.reduce((function(t,e){return t.map((function(t,s){return"".concat(t).concat(e[s])}))}));return"\n    <table>\n      <thead>\n        <tr><th><b>".concat(a,"</b></th></tr>\n      </thead>\n      <tbody>\n        <tr>").concat(n.join("</tr>\n        <tr>"),"</tr>\n      </tbody>\n    </table>\n  ")}var S={beforeTableEncode:function(t){return t}};function _(t,e){var s=u(u({},S),e).beforeTableEncode;if(!t.length)return"";var i='<html>\n  <head>\n    <meta charset="UTF-8" />\n  </head >\n  <body>\n    '.concat(C(t,s),"\n  </body>\n</html >\n");return i}function T(t){var e='<?xml version="1.0" encoding="utf-8"?><!DOCTYPE base>\n'.concat(A(t,"base"),"\n");return e}function A(t,e,s,o){void 0===s&&(s="element"),void 0===o&&(o=0);var a=l(e),n=c(o);if(null===t||void 0===t)return"".concat(n,"<").concat(a," />");var h=i(t)?t.map((function(t){return A(t,s,s,o+2)})).join("\n"):"object"===typeof t?r(t).map((function(t){var e=f(t,2),i=e[0],a=e[1];return A(a,i,s,o+2)})).join("\n"):n+"  "+d(String(t)),m="".concat(n,"<").concat(a,">\n").concat(h,"\n").concat(n,"</").concat(a,">");return m}var F={txt:"txt",css:"css",html:"html",json:"json",csv:"csv",xls:"xls",xml:"xml"};function L(t){var e=t.data,s=t.fileName,a=void 0===s?"download":s,r=t.extension,l=t.fileNameFormatter,c=void 0===l?function(t){return t.replace(/\s+/,"_")}:l,d=t.fields,h=t.exportType,u=void 0===h?"txt":h,f=t.replacer,w=void 0===f?null:f,g=t.space,b=void 0===g?4:g,k=t.processor,C=void 0===k?m:k,S=t.withBOM,A=void 0!==S&&S,F=t.beforeTableEncode,L=void 0===F?function(t){return t}:F,x=t.delimiter,$=void 0===x?",":x,E="Invalid export data. Please provide an array of objects",B="Can't export unknown data type ".concat(u,"."),P="Can't export string data to ".concat(u,".");if("string"===typeof e)switch(u){case"txt":case"css":case"html":return C(e,u,n(a,null!==r&&void 0!==r?r:u,c));default:throw new Error(P)}var O=p(d),M=O(v(e)),D=y(M,w,b);switch(u){case"txt":case"css":case"html":return C(D,u,n(a,null!==r&&void 0!==r?r:u,c));case"json":return C(D,u,n(a,null!==r&&void 0!==r?r:"json",c));case"csv":o(i(M),E);var N="\ufeff",q=I(M,{beforeTableEncode:L,delimiter:$}),R=A?N+q:q;return C(R,u,n(a,null!==r&&void 0!==r?r:"csv",c));case"xls":o(i(M),E);R=_(M,{beforeTableEncode:L});return C(R,u,n(a,null!==r&&void 0!==r?r:"xls",c));case"xml":R=T(M);return C(R,u,n(a,null!==r&&void 0!==r?r:"xml",c));default:throw new Error(B)}}L.types=F,L.processors={downloadFile:m};var x=L,$=x;const E=()=>{function t(t,e,s){if(t)try{const i=e||"exported-data",o=$.types[s||"xls"];$({data:t,fileName:i,exportType:o})}catch(i){throw new Error("Parsing failed!")}}return{exportDataFromJSON:t}};function B(t,e){if(!t)return this.$alert.info("Data not found");let s=new Date;return e||(e=`${s.getFullYear()}${s.getMonth()+1}${s.getDate()}${s.getHours()}${s.getMinutes()}${s.getSeconds()}`),E().exportDataFromJSON(t,e,null)}},"467fa":function(t,e,s){},4697:function(t,e,s){"use strict";s("d30f")},"470f":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"process-sheet"}},[e("Sheet",{attrs:{width:t.formWidth,"has-footer":!t.isCustomizedWorkflow||!t.initiateProcess,"no-padding":""},on:{input:t.closeProcessSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" "+t._s(t.headerTitle)+" ")]},proxy:!0},{key:"actions",fn:function(){return[t.isCustomizedWorkflow||"DOCUMENT"===t.workflow.initiatedBy?t._e():[t.mandatory.filledValue||t.mandatory.nonFilledValue?[e("q-circular-progress",{staticClass:"q-mr-sm",attrs:{"show-value":"","font-size":"12px",value:t.mandatoryFilling,size:"lg",thickness:.22,color:"primary","track-color":"grey-3"}},[t._v(" "+t._s(t.mandatoryFilling)+"% ")])]:t._e(),t.mandatory.filledValue?e("div",{staticClass:"chip-success q-mr-sm"},[e("div",{},[t._v(t._s(t.mandatory.filledValue)+" ready")])]):t._e(),t.mandatory.nonFilledValue?e("div",{staticClass:"chip-warning",on:{click:t.checkFormValidation}},[e("div",{},[t._v(t._s(t.mandatory.nonFilledValue)+" need to work")])]):t._e()],t.mandatoryDocument.length?[e("div",{staticClass:"chip-warning cursor-pointer",on:{click:function(e){t.attachmentSheet=!0}}},[e("div",{},[t._v(t._s(t.mandatoryDocument.length)+" document required")])])]:t._e(),t.itemModel.itemId?e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Actions",expression:"'Actions'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"eva-menu"}},[e("q-menu",{attrs:{"transition-show":"scale","transition-hide":"scale",anchor:"bottom end",self:"top right"}},[e("BaseScrollbar",{staticClass:"q-pb-sm",attrs:{width:"240px"}},t._l(t.documentActionList,(function(s){return e("ListItem",{key:s.id,attrs:{icon:s.icon,label:s.label},on:{click:function(e){return t.processDocumentAction(s.id)}}})})),1)],1)],1):t._e(),t.formView||t.initiateProcess||0!==t.actions.length?t.initiateProcess||0!==t.actions.length?t._e():e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Details View",expression:"'Details View'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"mdi-table-column"},on:{click:function(e){t.formView=!1}}}):e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Form View",expression:"'Form View'",modifiers:{top:!0}}],staticClass:"q q-mr-sm",attrs:{"is-flat":"",icon:"mdi-form-select"},on:{click:function(e){t.formView=!0}}}),t.isCustomizedWorkflow?t._e():e("BaseActionButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:t.isMaximized?"eva-collapse":"eva-expand"},on:{click:t.toggleWidth}})]},proxy:!0},{key:"footer",fn:function(){return[t.actions.length?e("div",{staticClass:"footer row"},["inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess?e("BaseButton",{staticClass:"q-ml-md",attrs:{label:"Save",color:"secondary"},on:{click:function(e){return t.validateRequest("Save")}}}):t._e(),t._l(t.actions,(function(s){return["Approve"===s||"Complete"===s||"Rightsize"===s?e("BaseButton",{key:s,staticClass:"q-ml-md",attrs:{label:s,color:"positive"},on:{click:function(e){return t.validateRequest(s)}}}):"Reject"===s||"Terminate"===s||"Force Close"===s||"Decline"===s?e("BaseButton",{key:s,staticClass:"q-ml-md",attrs:{label:s,color:"red"},on:{click:function(e){return t.validateRequest(s)}}}):"Forward"===s||s.indexOf("Reply")>-1||"Rollback"===s||"Assign"===s?e("BaseButton",{key:s,staticClass:"q-ml-md",attrs:{label:s,color:"orange"},on:{click:function(e){return t.validateRequest(s)}}}):e("BaseButton","To Requester"===s?{key:s,staticClass:"q-ml-md",attrs:{label:s,color:"pink"},on:{click:function(e){return t.validateRequest(s)}}}:{key:s,staticClass:"q-ml-md",attrs:{label:s},on:{click:function(e){return t.validateRequest(s)}}})]}))],2):t._e()]},proxy:!0}]),model:{value:t.processSheet,callback:function(e){t.processSheet=e},expression:"processSheet"}},[e("div",{staticClass:"row",attrs:{id:"content-wrapper"}},[t.formId?e("div",{staticClass:"col"},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 115px)"}},[t.formView?e("div",{attrs:{id:"form-view"}},[t.formId&&Object.keys(t.form).length?e("RenderForm",{attrs:{"form-id":t.formId,panels:t.panels,"secondary-panels":t.secondaryPanels,"form-settings":t.formSettings,"form-model":t.formModel,"save-action":t.saveAction,"workflow-form-model":t.workflowFormModel,"workflow-model":t.workflowModel,"is-readonly":t.formEditAccess,"form-edit-controls":t.formEditControls,"readonly-controls":t.readonlyControls,"form-visibility-access":t.formVisibilityAccess,"form-secure-controls":t.formSecureControls,"enable-controls":t._enableControls,"check-list":t.checkList,"form-fields":t.formFields,"data-validation-values":t.dataValidationValues,"form-check-list":t.formCheckList,"form-upload-files":t.formUploadFiles,"has-check-form-validate":t.hasCheckFormValidate},on:{"update:saveAction":function(e){t.saveAction=e},"update:save-action":function(e){t.saveAction=e},"update:workflowFormModel":function(e){t.workflowFormModel=e},"update:workflow-form-model":function(e){t.workflowFormModel=e},"update:workflowModel":function(e){t.workflowModel=e},"update:workflow-model":function(e){t.workflowModel=e},"update:checkList":function(e){t.checkList=e},"update:check-list":function(e){t.checkList=e},"update:formCheckList":function(e){t.formCheckList=e},"update:form-check-list":function(e){t.formCheckList=e},"update:hasCheckFormValidate":function(e){t.hasCheckFormValidate=e},"update:has-check-form-validate":function(e){t.hasCheckFormValidate=e},uploadFiles:t.getOCRResult,mandatoryControlsList:t.mandatoryControlsList,deletedFiles:t.deletedFiles}}):t._e(),t.signList.length?e("div",{staticClass:"q-pa-md",attrs:{id:"approvalSignature"}},[e("div",{staticClass:"title q-mb-sm"},[t._v("Approval Signature")]),e("BaseSeparator",{staticClass:"q-my-sm"}),e("div",{staticClass:"row"},[t._l(t.signList,(function(s){return[e("div",{key:s.id,staticClass:"col-3 q-mb-sm"},[e("img",{staticClass:"imgCenter col",attrs:{src:t.signLink(s.id)}}),e("div",{staticClass:"text row"},[e("span",{staticClass:"col-12 text-bold"},[t._v(t._s(s.stage))]),e("span",{staticClass:"col-12"},[t._v(t._s(s.createdByEmail))]),e("span",{staticClass:"col-12"},[t._v(t._s(t.$day.format(s.createdAt)))])])])]}))],2)],1):t._e(),t.userSignature?e("SignatureField",{staticClass:"q-pa-md",attrs:{label:"Signature"},model:{value:t.signImg,callback:function(e){t.signImg=e},expression:"signImg"}}):t._e()],1):e("div",{staticClass:"q-pa-md"},[t.requestFormData.length?e("div",{staticClass:"col-12",attrs:{id:"requestDetails"}},[e("div",{staticClass:"row justify-center"},[e("div",{staticClass:"col"},[e("div",{staticClass:"row items-center"},[e("table",{staticClass:"submittedData q-mb-sm"},[e("tbody",[t.requestFormData[0].value[0].createdByName?e("tr",[e("td",{attrs:{colspan:"4"}},[t._v(" Requested By: "+t._s(t.requestFormData[0].value[0].createdByName)+" ")])]):t._e(),e("tr",[t.requestFormData[0].value[0].raisedBy?e("th",[t._v(" Requested User Email ")]):t._e(),e("th",[t._v("Requested Date")]),e("th",[t._v("Last Acted By")]),e("th",[t._v("Last Acted On")])]),e("tr",[t.requestFormData[0].value[0].raisedBy?e("td",[t._v(" "+t._s(t.requestFormData[0].value[0].raisedBy)+" ")]):t._e(),e("td",[t._v(" "+t._s(t.$day.format(t.requestFormData[0].value[0].raisedAt))+" ")]),e("td",[t._v(" "+t._s(t.requestFormData[0].value[0].transaction_createdByEmail)+" ")]),e("td",[t._v(" "+t._s(t.$day.format(t.requestFormData[0].value[0].transaction_createdAt))+" ")])])])]),e("BaseScrollbar",{attrs:{height:"calc(100vh - 275px)"}},[[e("table",{staticClass:"mainData col-12"},[t._l(t.requestFormData[0].value[0].formData.fields,(function(s,i){return[s&&"[]"!=s?["TABLE"!==t.validateType(i)?[e("tr",{key:`${i}-${s}`},[e("td",{staticClass:"tblHeader ellipsis small"},[t._v(" "+t._s(t.getLabel(i))+" ")]),e("td",{staticClass:"ellipsis"},["FILE_UPLOAD"===t.validateType(i)?[JSON.parse(s).length?e("div",t._l(JSON.parse(s),(function(i){return e("div",{key:i.fileName,staticClass:"q-mb-xs"},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"col row items-center",on:{click:function(e){return t.viewFile(i,s)}}},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(i.fileName)}}),e("span",{staticClass:"cursor-pointer text-underline text-secondary"},[t._v(t._s(i.fileName))])],1)])])})),0):t._e()]:"DATE"===t.validateType(i)?[t._v(" "+t._s(t.$day.format(s,!1))+" ")]:t.validateValue(s)?[t._v(" "+t._s(t.removeTags(s)||"-")+" ")]:[e("a",{attrs:{href:s,target:"_blank"}},[t._v(" "+t._s(s||"-")+" ")])]],2)])]:JSON.parse(s).length?[t.getLabel(i)?e("tr",{key:"trlabel-"+i},[e("td",{staticClass:"tblHeader ellipsis small",attrs:{colspan:"2"}},[e("FormFieldLabel",{key:"label-"+i,staticClass:"q-mt-sm",attrs:{label:t.getLabel(i)}})],1)]):t._e(),e("tr",{key:"trtable1-"+i},[e("td",{attrs:{colspan:"2"}},[e("BaseScrollbar",{key:"scroll-"+i,staticStyle:{"max-height":"200px"}},[e("table",{key:"table-"+i,staticClass:"sub-table q-mt-sm q-mb-sm"},[e("thead",[e("tr",t._l(t.tableValue(s)[0],(function(s,i){return e("th",{key:i},[t._v(" "+t._s(t.getLabel(i,"table"))+" ")])})),0)]),e("tbody",t._l(t.tableValue(s),(function(s,i){return e("tr",{key:i},t._l(s,(function(s,i){return e("td",{key:i},[t._v(" "+t._s(s)+" ")])})),0)})),0)])])],1)])]:t._e()]:t._e()]}))],2)]],2)],1)])])]):t._e()])])],1):t._e(),t.itemModel.itemId?e("div",{staticClass:"col"},[e("div",{staticClass:"fileFrame"},[e("div",{staticClass:"file-list"},[e("iframe",{ref:"myProcessFiles",attrs:{id:"file-frame",src:t.itemLink(),frameborder:"0"}})])])]):t._e(),t.formId||t.itemModel.itemId?e("div",{staticClass:"col-auto q-mr-sm leftBorder"},[t._l(t.tabs,(function(s){return[t.checkTabAccess?e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:s.label,expression:"tab.label",modifiers:{left:!0}}],key:s.id,staticClass:"tabButtons",attrs:{"is-flat":"","no-border":"",icon:s.icon,color:"primary"},on:{click:function(e){return t.showLinks(s.value)}}},[s.count?e("span",{staticClass:"badge"},[t._v(t._s(s.count)+" ")]):t._e()]):t._e()]}))],2):t._e()])]),e("Sheet",{attrs:{width:"30vw","sub-actions":!(!t.selectedProcess.processId||!t.attachmentList.length),upload:"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess,"no-padding":""},on:{input:t.closeAttachmentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Attachments ")]},proxy:!0},{key:"actions",fn:function(){return[t.selectedProcess.processId?e("div",{staticClass:"q-ml-sm text-gray q-mr-sm ellipsis",staticStyle:{"font-size":"10px"}},[t._v(" auto-refresh every 15 seconds ")]):t._e(),t.selectedProcess.processId?e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getAttachments()}}}):t._e()]},proxy:!0},"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess?{key:"upload",fn:function(){return[e("div",{staticClass:"hint",on:{click:function(e){t.rowIndex=null,t.$refs.attachments.click()}}},[e("BaseIcon",{staticClass:"icon",attrs:{name:"eva-cloud-upload-outline",size:"32px",color:"blue"}}),e("div",{staticClass:"title text-blue"},[t._v("UPLOAD FILES")]),e("div",{staticClass:"description"},[t._v("Click here to choose files and upload")])],1)]},proxy:!0}:null,t.selectedProcess.processId&&t.attachmentList.length?{key:"subActions",fn:function(){return[e("CheckboxField",{staticClass:"col-auto q-pt-sm q-pb-sm",on:{input:t.fileSelectAll},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}}),t._v(" Select All "),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"mail share",expression:"'mail share'",modifiers:{top:!0}}],staticClass:"q-ml-sm",attrs:{"is-disabled":!t.selectedFileCount,icon:"mdi-email-send-outline",color:"secondary","no-border":"","is-flat":"",size:"18px"},on:{click:t.documentShare}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"merge documents (only PDF)",expression:"'merge documents (only PDF)'",modifiers:{top:!0}}],attrs:{"is-disabled":!(t.selectedFileCount>1&&t.isSelectedPDF),icon:"mdi-file-document-multiple-outline",color:"secondary","no-border":"","is-flat":"",size:"18px"},on:{click:t.documentMerge}})]},proxy:!0}:null],null,!0),model:{value:t.attachmentSheet,callback:function(e){t.attachmentSheet=e},expression:"attachmentSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode?"calc(100vh - 200px)":""}},[e("input",{ref:"attachments",staticClass:"hidden",attrs:{type:"file"},on:{change:t.uploadWflowAttachments}}),t._l(t.checkList,(function(s){return[s.name?[s.attach?e("div",{key:s.uid},[t._l(t.attachmentFilterCheckList(s.name),(function(s){return[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row"},[t.selectedProcess.processId?e("div",{staticClass:"col-auto"},[s.loading?[e("BaseIcon",{staticClass:"q-mr-sm loading",attrs:{name:"mdi-loading",color:"secondary"}})]:[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:s.checked?"eva-checkmark-circle-2":"eva-radio-button-off-outline",color:"secondary"},on:{click:function(t){s.checked=!s.checked}}})]],2):e("div",[s.loading?[e("BaseIcon",{staticClass:"q-mr-sm loading",attrs:{name:"mdi-loading",color:"secondary"}})]:t._e()],2),e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openFile(s)}}},[t._v(" "+t._s(s.name)+" ")]),s.formJsonId?e("div",{staticClass:"col-auto"},[e("q-chip",{staticClass:"cursor-pointer green-hover",attrs:{outline:"",color:"green"}},[t._v(" "+t._s(t.getLabel(s.formJsonId))+" ")])],1):t._e(),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Download",expression:"'Download'",modifiers:{top:!0}}],attrs:{icon:"eva-download-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Download")}}})],1),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Print",expression:"'Print'",modifiers:{top:!0}}],attrs:{icon:"eva-printer-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Print")}}})],1)]),e("div",{staticClass:"meta row"},[e("div",{staticClass:"col row"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.createdBy?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(s.createdByEmail))])]:t._e(),s.size?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(t.fileSize(s.size)))])]:t._e()],2),e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Metadata",expression:"'Metadata'",modifiers:{top:!0}}],attrs:{icon:"eva-file-text-outline",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.getFileData(s)}}})],1),[("inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode)&&s.createdBy===t.$store.state.session.id||t.initiateProcess?[e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"delete",expression:"'delete'",modifiers:{top:!0}}],attrs:{icon:"eva-trash-2-outline",color:"red","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.attachmentDelete(s)}}})],1),e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Re-Upload",expression:"'Re-Upload'",modifiers:{top:!0}}],attrs:{icon:"mdi-file-upload",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){e.stopPropagation(),t.reuploadFile=s,t.reupload(s.name)}}})],1)]:t._e()]],2)])]}))],2):e("div",{key:s.uid,staticClass:"checkList"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{attrs:{name:"mdi-file-check-outline",color:"primary"}})],1),e("div",{staticClass:"col q-ml-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[t._v(" "+t._s(s.name)+" ")]),s.required?e("div",{staticClass:"col-12 q-mt-sm"},[e("q-chip",{staticClass:"chips small",attrs:{outline:"",color:"red"}},[t._v(" Required ")])],1):t._e()])]),e("div",{staticClass:"col-auto"},[e("div",{staticClass:"col-12",on:{click:function(e){return t.attachTemplate(s.uid)}}},[e("q-chip",{staticClass:"chips primary-hover medium",attrs:{outline:"",color:"primary"}},[e("q-avatar",{staticClass:"q-mr-sm",attrs:{icon:"eva-upload-outline",color:"primary","text-color":"white"}}),t._v(" Upload ")],1)],1),s.template?e("div",{staticClass:"col-12",on:{click:function(e){return t.download(s.id)}}},[e("q-chip",{staticClass:"chips secondary-hover medium",attrs:{outline:"",color:"secondary"}},[e("q-avatar",{staticClass:"q-mr-sm",attrs:{icon:"eva-download-outline",color:"secondary","text-color":"white"}}),t._v(" Download ")],1)],1):t._e()])])])]:t._e()]})),t._l(t.attachmentList,(function(s){return[t.isCheckList(s.name)?[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row"},[s.loading?[e("BaseIcon",{staticClass:"q-mr-sm loading",attrs:{name:"mdi-loading",color:"secondary"}})]:t._e(),t.selectedProcess.processId?e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:s.checked?"eva-checkmark-circle-2":"eva-radio-button-off-outline",color:"secondary"},on:{click:function(t){s.checked=!s.checked}}})],1):t._e(),e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openFile(s)}}},[t._v(" "+t._s(s.name)+" ")]),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Download",expression:"'Download'",modifiers:{top:!0}}],attrs:{icon:"eva-download-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Download")}}})],1),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Print",expression:"'Print'",modifiers:{top:!0}}],attrs:{icon:"eva-printer-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Print")}}})],1)],2),s.formJsonId?e("div",{staticClass:"row q-mb-xs"},[e("div",{staticClass:"col"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-auto ellipsis attachment-label"},[t._v(" "+t._s(t.getLabel(s.formJsonId))+" ")])])]),e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Metadata",expression:"'Metadata'",modifiers:{top:!0}}],attrs:{icon:"eva-file-text-outline",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.getFileData(s)}}})],1),("inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode)&&s.createdBy===t.$store.state.session.id||t.initiateProcess?e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"delete",expression:"'delete'",modifiers:{top:!0}}],attrs:{icon:"eva-trash-2-outline",color:"red","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.attachmentDelete(s)}}})],1):t._e()]):t._e(),e("div",{staticClass:"meta row"},[e("div",{staticClass:"col row"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.createdBy?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(s.createdByEmail))])]:t._e(),s.size?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(t.fileSize(s.size)))])]:t._e()],2),s.formJsonId?t._e():[e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Metadata",expression:"'Metadata'",modifiers:{top:!0}}],attrs:{icon:"eva-file-text-outline",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.getFileData(s)}}})],1),("inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode)&&s.createdBy===t.$store.state.session.id||t.initiateProcess?e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"delete",expression:"'delete'",modifiers:{top:!0}}],attrs:{icon:"eva-trash-2-outline",color:"red","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.attachmentDelete(s)}}})],1):t._e()]],2)])]:t._e()]}))],2)],1)]),e("Sheet",{attrs:{width:"30vw",height:"80vh","custom-height":"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode?"30":"0","no-padding":""},on:{input:t.closeCommentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments ")]},proxy:!0},{key:"actions",fn:function(){return[t.selectedProcess.processId?e("div",{staticClass:"q-ml-sm text-gray q-mr-sm ellipsis",staticStyle:{"font-size":"10px"}},[t._v(" auto-refresh every 30 seconds ")]):t._e(),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getComments(0)}}})]},proxy:!0}]),model:{value:t.commentsSheet,callback:function(e){t.commentsSheet=e},expression:"commentsSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:t.commentsSheetHeight}},[t._l(t.commentsList,(function(s,i){return[e("q-chat-message",{key:i,staticClass:"q-ma-sm",attrs:{name:s.createdBy===t.$store.state.session.id?"me":s.createdByEmail||s.externalCommentsby,text:[s.comments],"text-html":"",sent:s.createdBy===t.$store.state.session.id,stamp:t.lastCommentDuration(s),"bg-color":s.createdBy===t.$store.state.session.id?"primary-1":"secondary-1"},scopedSlots:t._u([{key:"avatar",fn:function(){return[s.embedFileList&&s.embedFileList.length?e("div",{staticClass:"file-icons"},[e("FileIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:s.embedFileList[0].fileName,expression:"row.embedFileList[0].fileName",modifiers:{top:!0}}],key:"Icon-"+i,staticClass:"file-icon q-mr-sm",attrs:{"mime-type":t.fileType(s.embedFileList[0].fileName)}})],1):t._e()]},proxy:!0}],null,!0)})]}))],2)],1),"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode?e("div",{staticClass:"col borderTop"},[e("div",{staticClass:"row"},[t.checkTenant()&&!t.portal?[e("div",{staticClass:"col actions"},[t.attachmentList.length&&t.fileNames.length?e("div",{staticClass:"row select-action q-pa-sm action-container"},[e("CheckboxField",{staticClass:"col-auto q-pr-sm",attrs:{label:"Add Comment to PDF"},model:{value:t.attachComment,callback:function(e){t.attachComment=e},expression:"attachComment"}}),t.attachComment?e("SelectField",{staticClass:"col field comment-attach attach-cmd",attrs:{"is-searchable":!0,options:t.fileNames},model:{value:t.selectedFileForAttach,callback:function(e){t.selectedFileForAttach=e},expression:"selectedFileForAttach"}}):t._e()],1):t._e(),t.displayInternalPublic?e("SingleChoiceField",{staticClass:"action-container",class:{"internal-public":t.attachmentList.length>0,"col q-pa-sm":!0,"internal-public-margin":t.attachComment},attrs:{options:t.commentActions,"show-options-wrapper":!1,"options-per-line":2},model:{value:t.commentAction,callback:function(e){t.commentAction=e},expression:"commentAction"}}):t._e()],1)]:t._e(),t.isTenantGOTOComments()?[e("SingleChoiceField",{staticClass:"col q-mb-sm actions",attrs:{options:t.jiraCommentActions,"options-per-line":2},model:{value:t.jiraCommentAction,callback:function(e){t.jiraCommentAction=e},expression:"jiraCommentAction"}})]:t._e()],2),e("div",{staticClass:"row text-area-action q-ml-sm q-mr-sm"},[e("div",{staticClass:"col"},[e("TextAreaField",{attrs:{"auto-focus":"",placeholder:"Type a new comment..."},model:{value:t.commentText,callback:function(e){t.commentText=e},expression:"commentText"}})],1),e("div",{staticClass:"col-auto",staticStyle:{margin:"auto","margin-right":"8px"}},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Post Comments",expression:"'Post Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm comment-actions",attrs:{icon:"eva-paper-plane-outline",color:"primary-11",size:"16px","rotate-class":"rotate-45"},on:{click:t.saveComment}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Advanced Comments",expression:"'Advanced Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm q-mt-sm comment-actions",attrs:{icon:"mdi-comment-text-multiple",color:"primary-11",size:"16px"},on:{click:function(e){t.advancedCommentsSheet=!0}}})],1)])]):t._e()]),e("Sheet",{attrs:{width:"30vw","no-padding":""},on:{input:function(e){t.mailTransactionSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Mail Transactions ")]},proxy:!0},{key:"actions",fn:function(){return[e("div",{staticClass:"q-ml-sm text-gray q-mr-sm ellipsis",staticStyle:{"font-size":"10px"}},[t._v(" auto-refresh every 30 seconds ")]),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getMailTransactions()}}})]},proxy:!0}]),model:{value:t.mailTransactionSheet,callback:function(e){t.mailTransactionSheet=e},expression:"mailTransactionSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("div",{staticClass:"q-pl-sm"},[e("Tabs",{attrs:{tabs:t.mailTabs},model:{value:t.mailTab,callback:function(e){t.mailTab=e},expression:"mailTab"}})],1),"OUTGOING"===t.mailTab?[e("BaseScrollbar",{attrs:{height:"calc(100vh - 120px)"}},[t._l(t.outgoingMails,(function(s){return[e("div",{key:"outgoing"+s.id,staticClass:"mailTransactionList"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:"eva-email-outline",color:"primary"}})],1),e("div",{staticClass:"col-auto"},[t._v(" "+t._s(s.subject)+" ")])]),e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:"eva-person-outline",color:"secondary"}})],1),e("div",{staticClass:"col-auto"},[t._v(t._s(s.email))])]),e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:"eva-clock-outline",color:"orange"}})],1),e("div",{staticClass:"col-auto"},[t._v(" "+t._s(t.$day.format(s.createdAt,!0))+" ")])])]),e("div",{staticClass:"col-auto q-mr-sm"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"attachments",expression:"'attachments'",modifiers:{top:!0}}],staticClass:"q-mb-sm",attrs:{icon:"eva-attach-2-outline",color:"primary","is-flat":"",size:"16px"},on:{click:function(e){return e.stopPropagation(),t.showMailAttachments(s)}}},[s.attachmentCount?e("span",{staticClass:"badge"},[t._v(t._s(s.attachmentCount)+" ")]):t._e()]),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"resend",expression:"'resend'",modifiers:{top:!0}}],attrs:{icon:"mdi-send",color:"secondary","is-flat":"",size:"16px"},on:{click:function(e){return e.stopPropagation(),t.resendMail(s.ezMailId)}}})],1)])])]}))],2)]:t._e(),"INCOMING"===t.mailTab?[e("BaseScrollbar",{attrs:{height:"calc(100vh - 120px)"}},[t._l(t.incomingMails,(function(s){return[e("div",{key:"incoming"+s.id,staticClass:"mailTransactionList"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:"eva-email-outline",color:"primary"}})],1),e("div",{staticClass:"col-auto"},[t._v(" "+t._s(s.subject)+" ")])]),e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:"eva-person-outline",color:"secondary"}})],1),e("div",{staticClass:"col-auto"},[t._v(t._s(s.email))])]),e("div",{staticClass:"row q-mb-sm"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:"eva-clock-outline",color:"orange"}})],1),e("div",{staticClass:"col-auto"},[t._v(" "+t._s(t.$day.format(s.createdAt,!0))+" ")])])]),e("div",{staticClass:"col-auto q-mr-sm"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"attachments",expression:"'attachments'",modifiers:{top:!0}}],staticClass:"q-mb-sm",attrs:{icon:"eva-attach-2-outline",color:"primary","is-flat":"",size:"16px"},on:{click:function(e){return e.stopPropagation(),t.showMailAttachments(s)}}},[s.attachmentCount?e("span",{staticClass:"badge"},[t._v(t._s(s.attachmentCount)+" ")]):t._e()])],1)])])]}))],2)]:t._e()],2)]),e("Sheet",{attrs:{width:"30vw","no-padding":""},on:{input:function(e){t.mailAttachmentSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Mail Attachments ")]},proxy:!0}]),model:{value:t.mailAttachmentSheet,callback:function(e){t.mailAttachmentSheet=e},expression:"mailAttachmentSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 200px)"}},[t._l(t.mailAttachmentList,(function(s){return[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row"},[e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openAttachmentFile(s)}}},[t._v(" "+t._s(s.name)+" ")])]),e("div",{staticClass:"meta"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.size?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(t.fileSize(s.size)))])]:t._e()],2)])]}))],2)],1)]),e("Sheet",{attrs:{"no-padding":"",width:"100vw"},on:{input:function(e){t.fileSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"attachmentFileHeader"},[t.selectedFile.formJsonId?[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip:green.bottom",value:t.getLabel(t.selectedFile.formJsonId),expression:"getLabel(selectedFile.formJsonId)",arg:"green",modifiers:{bottom:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"mdi-form-select",color:"primary"}})]:t._e(),e("div",{staticClass:"avatar q-ml-sm"},[e("FileIcon",{attrs:{"mime-type":t.fileType(t.selectedFile.name)}})],1),e("div",{staticClass:"q-ml-md"},[e("div",{staticClass:"filename"},[t._v(" "+t._s(t.selectedFile.name)+" ")]),e("div",{staticClass:"meta"},[e("div",[t._v("Archived At: "+t._s(t.$day.format(t.selectedFile.createdAt)))]),e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v("Archived By: "+t._s(t.selectedFile.createdByEmail))]),t.selectedFile.size?e("div",[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),t._v(" File Size: "+t._s(t.fileSize(t.selectedFile.size))+" ")],1):t._e()],1)])],2)]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Actions",expression:"'Actions'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"eva-menu"}},[e("q-menu",{attrs:{"transition-show":"scale","transition-hide":"scale",anchor:"bottom end",self:"top right"}},[e("BaseScrollbar",{staticClass:"q-pb-sm",attrs:{width:"240px"}},t._l(t.documentActionList,(function(s){return e("ListItem",{key:s.id,attrs:{icon:s.icon,label:s.label},on:{click:function(e){return t.documentAction(s.id)}}})})),1)],1)],1)]},proxy:!0}]),model:{value:t.fileSheet,callback:function(e){t.fileSheet=e},expression:"fileSheet"}},[e("div",{staticClass:"attachmentFileFrame"},[e("div",{staticClass:"file-list"},[e("iframe",{ref:"myAttachmentFiles",attrs:{id:"file-frame",src:t.fileLink(),frameborder:"0"}})])])]),e("Modal",{attrs:{width:"60vw",height:"80vh","has-footer":""},on:{input:function(e){t.saveAction="",t.workflowFormModel={},t.advancedCommentsSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments")]},proxy:!0},{key:"default",fn:function(){return[e("TextBuilderField",{model:{value:t.advancedCommentText,callback:function(e){t.advancedCommentText=e},expression:"advancedCommentText"}})]},proxy:!0},{key:"footer",fn:function(){return[t.checkTenant()&&!t.portal?[e("div",{staticClass:"row actions advance-cmd"},[t.attachmentList.length&&t.fileNames.length?[e("CheckboxField",{staticClass:"col-auto q-pr-sm",staticStyle:{margin:"auto"},attrs:{label:"Add Comment to PDF"},model:{value:t.attachComment,callback:function(e){t.attachComment=e},expression:"attachComment"}}),t.attachComment?e("SelectField",{staticClass:"field comment-attach",attrs:{"is-searchable":!0,options:t.fileNames},on:{input:t.handleAttachComment},model:{value:t.selectedFileForAttach,callback:function(e){t.selectedFileForAttach=e},expression:"selectedFileForAttach"}}):t._e()]:t._e()],2),t.checkTenant()&&t.displayInternalPublic?e("SingleChoiceField",{staticClass:"actions q-mr-sm noborder",attrs:{options:t.commentActions,"options-per-line":2},model:{value:t.commentAction,callback:function(e){t.commentAction=e},expression:"commentAction"}}):t._e()]:t._e(),t.isTenantGOTOComments()?[e("SingleChoiceField",{staticClass:"col q-mb-sm actions",attrs:{options:t.jiraCommentActions,"options-per-line":2},model:{value:t.jiraCommentAction,callback:function(e){t.jiraCommentAction=e},expression:"jiraCommentAction"}})]:t._e(),e("BaseButton",{attrs:{label:"Post Comments",icon:"eva-paper-plane-outline",color:"primary"},on:{click:t.saveAdvancedComment}})]},proxy:!0}]),model:{value:t.advancedCommentsSheet,callback:function(e){t.advancedCommentsSheet=e},expression:"advancedCommentsSheet"}}),e("Modal",{attrs:{width:"40vw",height:"60vh","has-footer":""},on:{input:function(e){t.saveAction="",t.workflowFormModel={},t.processForwardModal=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t.processForwardGroupAction?t._e():e("span",[t._v('"'+t._s(t.selectedProcess.requestNo)+'"')]),t._v(" Process Forward")]},proxy:!0},{key:"default",fn:function(){return[e("div",{attrs:{id:"processForward"}},[e("MultiSelectField",{staticClass:"field",attrs:{label:"users",options:t.userList},model:{value:t.forwardUsers,callback:function(e){t.forwardUsers=e},expression:"forwardUsers"}}),e("MultiSelectField",{staticClass:"field",attrs:{label:"group",options:t.groupList},model:{value:t.forwardGroups,callback:function(e){t.forwardGroups=e},expression:"forwardGroups"}}),t.processForwardGroupAction?e("TextAreaField",{staticClass:"field q-mt-md",attrs:{placeholder:"Type a comment..."},model:{value:t.commentText,callback:function(e){t.commentText=e},expression:"commentText"}}):t._e()],1)]},proxy:!0},{key:"footer",fn:function(){return[t.isTenantGOTO()?[e("BaseButton",{attrs:{label:"Assign",color:"orange"},on:{click:function(e){t.processForwardModal=!1,t.processForwardGroupAction?t.groupProcessRequest():t.processRequest(!1,!1)}}})]:[e("BaseButton",{attrs:{label:"Forward",color:"orange"},on:{click:function(e){t.processForwardModal=!1,t.processForwardGroupAction?t.groupProcessRequest():t.processRequest(!1,!1)}}})]]},proxy:!0}]),model:{value:t.processForwardModal,callback:function(e){t.processForwardModal=e},expression:"processForwardModal"}}),e("Sheet",{attrs:{width:"40vw","has-footer":""},on:{input:t.closeJiraIssueSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" JIRA - Create Issue ")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"jiraIssue",attrs:{id:"content-wrapper"}},[e("ValidationObserver",{ref:"form"},[e("div",{staticClass:"field-wrapper"},[e("ValidationProvider",{attrs:{name:"Issue Name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("TextField",{staticClass:"field",attrs:{label:"Issue Name","is-mandatory":"",error:s[0]},model:{value:t.issueName,callback:function(e){t.issueName=e},expression:"issueName"}})]}}])}),t._e(),t._e(),e("ValidationProvider",{attrs:{name:"Description",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("TextAreaField",{staticClass:"field",attrs:{label:"Description","is-mandatory":"",error:s[0]},model:{value:t.issueDescription,callback:function(e){t.issueDescription=e},expression:"issueDescription"}})]}}])}),t._e(),t._e(),t._e()],1)])],1)]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{attrs:{label:"Create Issue",color:"primary"},on:{click:t.createJiraIssue}})]},proxy:!0}]),model:{value:t.jiraIssueSheet,callback:function(e){t.jiraIssueSheet=e},expression:"jiraIssueSheet"}}),e("MetaDataEdit",{attrs:{value:t.showMetaDataEditModal,file:t.workflow,"repository-field":t.repositoryField,"file-data":t.fileData,title:t.metaDataTitle||"Index",columns:t.columns,"modal-value":t.workflowModel,"read-only":!0,"upload-filename":t.uploadFilename,"meta-data-fields":t.metaDataModal},on:{close:t.closeMetaDataEditModal,save:t.saveMetaData}}),e("Sheet",{attrs:{width:"30vw"},on:{input:t.closeTaskSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Tasks ")]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Add Task",expression:"'Add Task'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-plus",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.addTask()}}})]},proxy:!0}]),model:{value:t.taskSheet,callback:function(e){t.taskSheet=e},expression:"taskSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[t._l(t.taskEntries,(function(s){return[e("div",{key:s.id,staticClass:"taskEntries"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-auto q-mr-md",staticStyle:{"margin-top":"3px"},on:{click:function(e){return t.viewTask(s.id)}}},[t._v(" "+t._s(s.name)+" ")]),e("q-chip",{attrs:{size:"10px",color:t.getColor(s.priority),"text-color":"white"}},[t._v(" "+t._s(s.priority)+" ")]),e("q-chip",{attrs:{size:"10px",color:t.getColor(s.status),"text-color":"white"}},[t._v(" "+t._s(s.status)+" ")])],1)]),e("div",{staticClass:"meta row"},[e("div",{staticClass:"col-12"},[t._v("Assigned To: "+t._s(s.assigned))]),e("div",{staticClass:"col-12"},[t._v(" Start Date: "+t._s(t.$day.format(s.startDate,!1))+" "),e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),t._v(" End Date: "+t._s(t.$day.format(s.endDate,!1))+" ")],1)])])]}))],2)]),t.taskFormId?e("AddTask",{attrs:{value:t.addTaskSheet,"form-settings":t.addTaskForm.settings,panels:t.addTaskForm.panels,"secondary-panels":t.addTaskForm.secondaryPanels,"form-id":t.taskFormId,"repository-id":t.taskRepositoryId,"task-model":t.selectedTask,"workflow-task":!0,mode:t.taskMode},on:{close:function(e){t.addTaskSheet=!1},addEntry:t.addTaskEntry}}):t._e(),t.importExcel?e("ImportPopup",{staticClass:"row items-center q-mr-xs",attrs:{"chip-button":!0,"data-imported":t.dataImported,"form-id":String(t.masterFormId)},on:{upload:function(e){return t.$refs.input.click()},close:function(e){t.dataImported=!1}}}):t._e(),e("input",{ref:"input",staticClass:"hidden",attrs:{type:"file",accept:".csv,.xls,.xlsx"},on:{change:t.uploadFile}}),e("Confirm",{attrs:{icon:"mdi-file-alert","icon-color":"red"},on:{input:t.closeAlertModal},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Documents Required!")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"q-py-md text-md"},[e("p",[t._v(" Are you sure you want to submit the request without attaching the required documents. ")])])]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",label:"no"},on:{click:t.closeAlertModal}}),e("BaseButton",{attrs:{label:"yes",color:"primary"},on:{click:t.proceedSubmission}})]},proxy:!0}]),model:{value:t.alertModal,callback:function(e){t.alertModal=e},expression:"alertModal"}}),e("EmailSharing",{attrs:{"repository-id":t.workflow.repositoryId,"file-list":t.selectedFileList},on:{"update:fileList":function(e){t.selectedFileList=e},"update:file-list":function(e){t.selectedFileList=e}},model:{value:t.emailSharingSheet,callback:function(e){t.emailSharingSheet=e},expression:"emailSharingSheet"}}),e("FileDetails",{attrs:{"file-data":t.fileData},model:{value:t.fileDetailsSheet,callback:function(e){t.fileDetailsSheet=e},expression:"fileDetailsSheet"}}),t.historyProcessId?e("ProcessHistory",{attrs:{"process-id":t.historyProcessId,"selected-process":t.selectedProcess},on:{close:function(e){t.historyProcessId=0}}}):t._e(),t.showFormEntryHistoryModal?e("FormEntryHistory",{attrs:{value:t.showFormEntryHistoryModal,"workflow-id":t.workflow.id,"process-id":t.selectedProcess.processId},on:{"update:value":function(e){t.showFormEntryHistoryModal=e}}}):t._e(),t.showAttachmentSheet?e("Attachments",{attrs:{value:t.showAttachmentSheet,"selected-process":t.selectedProcess,workflow:t.workflow,"selected-node":t.selectedNode,"initiate-process":t.initiateProcess,"form-check-list":t.formCheckList,"check-list":t.checkList,wform:t.wform,"repository-details":t.repositoryDetails,"workflow-model":t.workflowModel,"form-upload-files":t.formUploadFiles,"repository-field":t.repositoryField,columns:t.columns,attachments:t.attachmentList,"workflow-id":t.workflow.id},on:{"update:value":function(e){t.showAttachmentSheet=e},"update:attachments":function(e){t.attachmentList=e},attachmentCount:t.attachmentCount}}):t._e(),t.showCommentsSheet?e("Comments",{attrs:{value:t.showCommentsSheet,"selected-process":t.selectedProcess,workflow:t.workflow,"selected-node":t.selectedNode,"initiate-process":t.initiateProcess,"attachment-list":t.attachmentList,"workflow-id":t.workflow.id,"file-names":t.fileNames,comments:t.commentsList,"display-internal-public":t.displayInternalPublic},on:{"update:value":function(e){t.showCommentsSheet=e},"update:comments":function(e){t.commentsList=e},commentsCount:t.commentsCount}}):t._e()],1)},o=[],a=(s("14d9"),s("13d5"),s("7bb1")),r=s("381e"),n=s("4bc4"),l=s("1b0d"),c=s("0cdc"),d=s("eff0"),h=s("bc3a"),m=s.n(h),u=s("dd90"),f=s("a7d2"),p=s("6a70"),v=s("cade"),y=s("c3d2"),w=s("fa1f"),g=s("ee54"),b=s("869e"),k=s("6df3"),I=s("b3d1"),C=s("9234"),S=s("695e"),_=s("b94d"),T=s("0c04"),A=s("1c54"),F=s("5e23"),L=s("abe1"),x=s("8505"),$=s("98cf"),E=s("909a"),B=s("9996"),P=s("3445"),O=s("b0ba"),M=s("ec15"),D=s("bb36"),N={name:"SubWorkflowProcess",components:{ValidationObserver:a["a"],ValidationProvider:a["b"],MultiSelectField:y["a"],FileIcon:w["a"],ListItem:v["a"],Sheet:r["a"],RenderForm:n["a"],Confirm:A["a"],SignatureField:d["a"],Modal:p["a"],MetaDataEdit:g["a"],CheckboxField:b["a"],TextAreaField:k["a"],TextField:I["a"],SingleChoiceField:C["a"],TextBuilderField:S["a"],Tabs:_["a"],AddTask:T["a"],ImportPopup:c["a"],EmailSharing:F["a"],FileDetails:L["a"],ProcessHistory:x["a"],FormFieldLabel:P["a"],FormEntryHistory:O["a"],Attachments:M["a"],Comments:D["a"]},props:{workflowId:{type:Number,default:0},initiateSubWorkflowProcess:{type:Boolean,default:!1},mainWorkflowId:{type:Number,default:0},mainProcessId:{type:Number,default:0},subProcessLink:{type:String,default:""},selectedProcess:{type:Object,default:()=>{}},openSubProcess:{type:Boolean,default:!1},mainFormFields:{type:Array,default:()=>[]},mainFormModel:{type:Object,default:()=>{}},portal:{type:Boolean,default:!1},subProcessId:{type:Number,default:0}},data(){return{workflow:{},workflowList:[],initiate:!1,processSheet:!1,headerTitle:"",formModel:{},form:{},formId:"",formData:"",actions:[],processActionsAddOn:[],workflowFormModel:{},saveAction:"",commentsList:[],attachmentList:[],initiateProcess:!1,signList:[],formEditAccess:!1,formEditControls:[],readonlyControls:[],formVisibilityAccess:!0,formSecureControls:[],repositoryDetails:{},repositoryField:[],formWidth:"100vw",checkList:[],stageLevel:[],currentStep:0,commentActions:[{id:this.$nano.id(),label:"Internal",value:2},{id:this.$nano.id(),label:"Public",value:1}],commentAction:2,jiraCommentActions:[{id:this.$nano.id(),label:"This resource",value:1},{id:this.$nano.id(),label:"All resource",value:2}],jiraCommentAction:1,formFields:[],checkListRowIndex:null,requestPrefix:"",mlPrediction:"",advancedCommentsSheet:!1,advancedCommentText:"",docWarning:!1,alertModal:!1,actionRemarks:!1,actionPassword:!1,actionPasswordConfirm:!1,actionUserPassword:"",actionComments:!1,actionConfirm:!1,actionConfirmAlert:!1,showMetaDataEditModal:!1,selectedUploadFile:{},workflowModel:{},customVerify:!1,formCheckList:!1,reuploadFile:{},documentActionList:[{id:"Download",key:"download",label:"Download",icon:"mdi-download-outline"},{id:"Print",key:"print",label:"Print",icon:"eva-printer-outline"}],scrollPosition:0,commentsLoad:null,mailTransactionLoad:null,documentLoad:null,documentLoadList:[],uploadFilename:"",filterSearchColumn:{},selectedFilterColumn:"",watchViewerClose:null,saveOnly:!1,wform:[],userSignature:!1,dataValidationValues:[],processForwardModal:!1,forwardUsers:[],forwardGroups:[],processForwardGroupAction:!1,selectedFilter:[],filterBy:[],attachmentLoad:null,signImg:"",selectAll:!1,emailSharingSheet:!1,selectedFileList:[],fileDetailsSheet:!1,fileData:[],jiraConnect:!1,jiraAccounts:[],jiraIssueSheet:!1,issueName:"",projectKey:"",issueType:"",issueDescription:"",issueEpicValue:"",issueAssignee:"",issueAssigneeUsers:[],issueDescriptionTable:!1,issueDescriptionFields:[],jiraConfirmModal:!1,issueRef:{},taskSheet:!1,itemModel:{},errorMessage:"",errorModal:!1,successModal:!1,selectedNode:"",attachmentSheet:!1,commentsSheet:!1,processId:0,tabs:[{id:this.$nano.id(),label:"attachments",value:"ATTACHMENTS",icon:"mdi-attachment",count:0},{id:this.$nano.id(),label:"comments",value:"COMMENTS",icon:"mdi-comment-text-outline",count:0},{id:this.$nano.id(),label:"mail transaction",value:"MAIL",icon:"mdi-email-outline",count:0},{id:this.$nano.id(),label:"history",value:"HISTORY",icon:"mdi-history",count:0},{id:this.$nano.id(),label:"print",value:"PRINT",icon:"mdi-printer",count:0},{id:this.$nano.id(),label:"task",value:"TASK",icon:"eva-cube-outline",count:0},{id:this.$nano.id(),label:"Form Entry History",value:"FORM_ENTRY_HISTORY",icon:"mdi-file-document",count:0}],taskEntries:[],addTaskEnabled:!1,mailTab:"OUTGOING",mailTransactionSheet:!1,commentText:"",mailTransactionList:[],mailAttachmentSheet:!1,mailAttachmentList:[],fileSheet:!1,selectedFile:{},mailTabs:[{id:this.$nano.id(),label:"outgoing",value:"OUTGOING",count:0},{id:this.$nano.id(),label:"incoming",value:"INCOMING",count:0}],userList:[],groupList:[],refreshTree:!0,loadInitial:!0,customReply:!1,userReply:!1,toRequester:!1,customCloseProcessSheet:!1,approvalTypes:[{id:this.$nano.id(),label:"Approve",value:"Approved"},{id:this.$nano.id(),label:"Cancel",value:"Cancelled"}],activeViewLoad:null,hideColumns:[],columns:[],generatePDF:0,documentRequired:!1,hasSelectedProcess:0,hasSelectedWorkflow:0,taskFormId:0,taskRepositoryId:0,addTaskForm:{},addTaskSheet:!1,taskEntryId:[],taskEntryList:[],taskMode:"",selectedTask:{},importExcel:!1,masterFormId:0,dataImported:!1,sameFormFields:[],historyProcessId:0,attachComment:!1,fileNames:[],selectedFileForAttach:0,displayInternalPublic:!1,formUploadFiles:[],mandatory:{},fileControlDeleteFile:[],hasCheckFormValidate:!1,fileUploadForControl:!1,fileUploadInput:{},metaDataUpdate:!1,metaDataModal:{},metaDataTitle:"",requestFormData:[],formView:!0,showFormEntryHistoryModal:!1,showAttachmentSheet:!1,showCommentsSheet:!1}},computed:{formName(){return this.formId?this.form.settings.general.name:""},formDescription(){return this.formId?this.form.settings.general.description:""},panels(){return this.formId?this.form.panels:[]},secondaryPanels(){return this.formId?this.form.secondaryPanels:[]},formSettings(){return this.formId?this.form.settings:{}},selectedFileCount(){let t=this.attachmentList.filter(t=>t.checked).length;return t},isSelectedPDF(){let t=!0;return this.attachmentList.forEach(e=>{let s=e.name.split(".").pop();e.checked&&"pdf"!==s.toLowerCase()&&(t=!1)}),t},isMaximized(){return"100vw"===this.formWidth},_enableControls(){let t=[],e=[];return this.panels&&this.panels.forEach(s=>{if(s.fields.length){let i=s.fields.filter(t=>"SINGLE_SELECT"===t.type||"SINGLE_CHOICE"===t.type||"MULTIPLE_CHOICE"===t.type||"MULTI_SELECT"===t.type);i.length&&i.forEach(s=>{if(s.settings.validation.enableSettings&&s.settings.validation.enableSettings.length){let i=[];s.settings.validation.enableSettings.forEach(t=>{t.controls.length&&(i.push({value:t.value,childControls:t.controls}),t.controls.forEach(t=>{i.indexOf(t)<0&&e.push(t)}))}),i.length&&t.push({id:s.id,parentControls:i})}})}}),{listControls:e,controls:t}},isCustomizedWorkflow(){let t=location.origin;if("https://demo.ezofis.com"===t||"http://52.172.32.88"===t){if(1014===this.workflow.id)return!0}else if(("https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t||"https://trial.ezofis.com"===t&&12===this.$store.state.session.tenantId)&&1===this.workflow.id)return!0;return!1},outgoingMails(){return this.mailTransactionList.filter(t=>"Outgoing"===t.emailType)},incomingMails(){return this.mailTransactionList.filter(t=>"Incoming"===t.emailType)},commentsSheetHeight(){return"inbox"===this.selectedNode||"payment"===this.selectedNode||"common"===this.selectedNode?this.checkCommentsOption()?this.attachmentList.length&&this.fileNames.length?this.attachComment&&this.displayInternalPublic?"calc(100vh - 240px)":this.attachComment&&!this.displayInternalPublic?"calc(100vh - 200px)":!this.attachComment&&this.displayInternalPublic?"calc(100vh - 225px)":"calc(100vh - 190px)":this.displayInternalPublic?"calc(100vh - 190px)":"calc(100vh - 150px)":"calc(100vh - 150px)":""},mandatoryDocument(){return this.checkList.filter(t=>t.required&&!t.attach)},mandatoryFilling(){return this.mandatory.filledValue&&this.mandatory.nonFilledValue?Math.floor(this.mandatory.filledValue/(this.mandatory.filledValue+this.mandatory.nonFilledValue)*100):this.mandatory.filledValue?100:0},request(){return this.selectedProcess}},watch:{workflowFormModel:{deep:!0,immediate:!0,handler(){this.workflowFormModel&&this.saveAction&&(this.initiateProcess,this.checkRequiredDocument())}},attachmentSheet:{immediate:!0,handler(){if(this.attachmentSheet&&this.selectedProcess.processId){if(this.attachmentList.length){let t=this.attachmentList.length-1;this.getFileData(this.attachmentList[t],"file")}this.attachmentLoad=setInterval(()=>{this.getAttachments()},15e3)}else clearInterval(this.attachmentLoad)}},commentsSheet:{immediate:!0,handler(){this.commentsSheet&&this.selectedProcess.processId?this.commentsLoad=setInterval(()=>{this.getComments(this.workflowId,this.selectedProcess.processId)},3e4):clearInterval(this.commentsLoad)}},mailTransactionSheet:{immediate:!0,handler(){this.mailTransactionSheet&&this.selectedProcess.processId?this.mailTransactionLoad=setInterval(()=>{this.getMailTransactions()},3e4):clearInterval(this.mailTransactionLoad)}},taskEntries:{immediate:!0,handler(){this.tabs.find(t=>{"TASK"===t.value&&(t.count=this.taskEntries.length)})}},workflowId:{immediate:!0,handler(){}},initiateSubWorkflowProcess:{immediate:!0,handler(){this.initiateSubWorkflowProcess&&this.getWorkflow()}},processSheet(){this.fileData=[],this.workflowModel={}},dataValidationValues:{immediate:!0,deep:!0,handler(){if(this.customVerify=!1,this.dataValidationValues.length){let t=this.dataValidationValues.filter(t=>"Matched"!==t.status&&"Verified"!==t.status);t.length&&(this.customVerify=!0)}}},customCloseProcessSheet:{deep:!0,immediate:!0,handler(){}},subProcessLink(){this.subProcessLink&&(this.selectedNode="sent",this.showLinks(this.subProcessLink))},openSubProcess:{immediate:!0,handler(){this.openSubProcess&&(this.formId="",this.formView=!1,this.selectedProcess.inbox?(this.formView=!0,this.getWorkflow()):this.getWorkflow("process"))}},selectedProcess:{deep:!0,handler(){this.selectedProcess.processId&&(this.getAttachments(this.workflowId,this.selectedProcess.processId),this.getComments(this.workflowId,this.selectedProcess.processId))}},workflowModel:{deep:!0,handler(){this.sameFormFields.forEach(t=>{t.value&&(this.workflowModel[t.name]=t.value)})}}},created(){this.getTaskForm()},methods:{isTenantArmgroup(){let t=location.origin;return"https://ag-appsvc01.azurewebsites.net"!==t&&"https://ag-appsvc05.azurewebsites.net"!==t||(this.commentAction=2,!1)},checkTabAccess(t){return this.portal?"ATTACHMENTS"===t||"COMMENTS"===t:"TASK"===t?this.addTaskEnabled:"VALIDATION"===t?!!this.isTenantArmgroup():"FORM_ENTRY_HISTORY"!==t||!!this.formId},reset(){this.headerTitle="",this.mandatory={},this.actions=[],this.processActionsAddOn=[],this.form={},this.formId="",this.formFields=[],this.tabs.find(t=>{t.count=0}),this.taskEntries=[],this.commentsList=[],this.attachmentList=[],this.initiateProcess=!0,this.formModel={},this.signList=[],this.formEditAccess=!1,this.formEditControls=[],this.readonlyControls=[],this.formVisibilityAccess=!0,this.formSecureControls=[],this.importExcel=!1},async getWorkflow(t){this.reset(),this.processSheet=!0,this.$store.commit("showLoadingBarSave");const{error:e,payload:s}=await l["t"].getWorkflow(this.workflowId);e?this.$alert.error(e):(this.workflow=s,this.selectedNode=t?"sent":"inbox",this.selectedProcess.inbox?await this.openProcess(!1):await this.openProcess(!t),this.$store.commit("hideLoadingBarSave"))},closeProcessSheet(){this.processSheet=!1,this.saveAction="",this.workflowFormModel={},this.requestFormData=[],this.formView=!0,this.$emit("closeProcessSheet")},getLabel(t){let e="";return Object.keys(this.form).length&&this.form.panels.forEach(s=>{if(!s.fields.length)return;let i=s.fields.find(e=>e.id===t);i&&(e=i.label?i.label:i.type)}),e},async openProcess(t=!1){if(this.getRepository(),t){let t=JSON.parse(this.workflow.flowJson),e=t.blocks.find(t=>"START"===t.type);if(console.log(e.settings.fileSettings),e.settings.fileSettings&&e.settings.fileSettings.fileCheckList.length&&(this.checkList=e.settings.fileSettings.fileCheckList,this.checkList.forEach(t=>{t.uid=this.$nano.id(),t.attach=!1})),e){if("MANUAL"===e.settings.initiateMode){this.headerTitle=""+e.settings.label;let s=t.rules.find(t=>t.fromBlockId===e.id);s&&this.actions.push(s.proceedAction)}else"MANUAL_AUTOMATIC"===e.settings.initiateMode&&(e.settings.users.indexOf(this.$store.state.session.id)>-1||e.settings.users.indexOf("0")>-1)&&e.settings.initiateBy.indexOf("MASTER_FORM")>-1&&(this.importExcel=!0,this.masterFormId=e.settings.masterFormId);if(this.generatePDF=e.settings.generatePDF?1:0,this.documentRequired=e.settings.documentRequired||!1,e.settings.formEditAccess&&(""===e.settings.formEditAccess?(this.formEditAccess=!0,this.formEditControls=[]):"FULL"===e.settings.formEditAccess?(this.formEditAccess=!1,this.formEditControls=[]):"PARTIAL"===e.settings.formEditAccess&&(this.formEditAccess=!1,this.formEditControls=e.settings.formEditControls)),e.settings.formVisibilityAccess?(this.formVisibilityAccess=!0,this.formSecureControls=[]):(this.formVisibilityAccess=!1,this.formSecureControls=e.settings.formSecureControls),e.settings.fileSettings){if(e.settings.fileSettings.fileCheckList.length){let t=e.settings.fileSettings.fileCheckList;t.forEach(t=>{t.uid=this.$nano.id(),t.attach=!1}),this.docWarning=e.settings.fileSettings.partial,this.checkList=t}}else this.checkList=[]}}else{if(this.getFormDetails(),"inbox"===this.selectedNode||"common"===this.selectedNode||"payment"===this.selectedNode){this.formEditAccess=!1;let t=JSON.parse(this.workflow.flowJson),e=t.blocks.find(t=>t.id===this.selectedProcess.activityId);if(e){if(""===e.settings.formEditAccess?(this.formEditAccess=!0,this.formEditControls=[]):"FULL"===e.settings.formEditAccess?(this.formEditAccess=!1,this.formEditControls=[]):"PARTIAL"===e.settings.formEditAccess&&(this.formEditAccess=!1,this.formEditControls=e.settings.formEditControls),e.settings.formVisibilityAccess?(this.formVisibilityAccess=!0,this.formSecureControls=[]):(this.formVisibilityAccess=!1,this.formSecureControls=e.settings.formSecureControls),t.settings.general.processNumberPrefix.indexOf("[")>-1){let e=JSON.parse(t.settings.general.processNumberPrefix);this.readonlyControls=[];let s=e.filter(t=>"formColumn"===t.key);s.length&&s.forEach(t=>{this.readonlyControls.push(t.value),this.formEditControls.indexOf(t.value)>-1&&this.formEditControls.splice(this.formEditControls.indexOf(t.value),1)})}if(e.settings.fileSettings){if(e.settings.fileSettings.fileCheckList.length){let t=e.settings.fileSettings.fileCheckList;t.forEach(t=>{t.uid=this.$nano.id(),t.attach=!1}),this.docWarning=e.settings.fileSettings.partial,this.checkList=t}t.rules.forEach(t=>{t.fromBlockId===this.selectedProcess.activityId&&this.actions.indexOf(t.proceedAction)<0&&(this.actions.push(t.proceedAction),this.processActionsAddOn.push({action:t.proceedAction,remarks:t.remarks||!1,passwordAccess:t.passwordAccess||!1,confirm:t.confirm||!1}))})}else this.checkList=[]}}else this.formEditAccess=!0;this.initiateProcess=!1,this.getModel(this.selectedProcess.processId);let t=location.origin;("https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t||"https://trial.ezofis.com"===t&&12===this.$store.state.session.tenantId)&&this.dataValidation(this.selectedProcess.processId,!1),"https://edmsuat.sobhaapps.com"===t&&55===this.workflow.id&&(this.formEditAccess=!0),this.loadProcessLinks()}this.workflow.wFormId&&(this.formId=String(this.workflow.wFormId),await this.getForm(t,this.workflow.wFormId))},async getFormDetails(){this.$store.commit("showLoadingBarPage");let t=this.selectedProcess.requestNo;const{error:e,payload:s}=await l["o"].getWorkflowData(this.selectedProcess.id,{filterBy:[{groupCondition:"",filters:[{criteria:"requestNo",condition:"IS_EQUALS_TO",value:t}]}],currentPage:1,itemsPerPage:10,mode:""}),{data:i}=s;this.$store.commit("hideLoadingBarPage");let o=i||[];if(o[0].value[0].formData){let t=Object.keys(o[0].value[0].formData.fields),e={};t.forEach(t=>{e[t]=this.validateTypeValue(o[0].value[0].formData.fields[t])}),this.requestFormData=o,this.formModel=o[0].value[0].formData.fields}e&&this.$alert.error(e)},async getRepository(){const{error:t,payload:e}=await l["p"].getRepository(this.workflow.repositoryId);t?this.$alert.error(t):(this.repositoryDetails=e,this.repositoryField=e.fields)},async getAttachments(t=0,e=0){this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=0)});let s=this.attachmentList.length;t||e||(t=this.workflow.id,e=this.selectedProcess.processId),this.$store.commit("showLoadingBar");const{error:i,payload:o}=await l["t"].getAttachments(t,e);if(this.$store.commit("hideLoadingBar"),i)this.$alert.error(i);else{if(o.length?(s!==o.length&&(this.attachmentList=o.map(t=>({...t,checked:!1}))),this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length)})):this.attachmentList=[],this.checkList.length){this.checkList.forEach(t=>{let e=this.attachmentList.filter(e=>{let s=e.name.substr(0,e.name.lastIndexOf("."));if(t.name===s||t.name===s.split("_")[0])return e});e.length?t.attach=!0:t.attach=!1});let t=location.origin;("https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t||"https://trial.ezofis.com"===t&&12===this.$store.state.session.tenantId)&&(this.formCheckList=!0)}this.$emit("attachmentLength",this.attachmentList.length)}},async getForm(t){const{error:e,payload:s}=await l["g"].getForm(this.formId);if(e)this.$alert.error(e);else if(s){this.wform=s,this.form=JSON.parse(this.wform.formJson),t||"CARD"===this.form.settings.general.layout&&(this.form.settings.general.layout="TAB");let e=JSON.parse(this.wform.formJson);const i=[...e.panels,...e.secondaryPanels];if(!i.length)return;let o=[];for(const t of i)o.push(...t.fields);o.forEach(t=>{"DIVIDER"===t.type||"LABEL"===t.type||"PARAGRAPH"===t.type||!t.label&&"TABLE"!==t.type||"DISABLE"===t.settings.general.visibility||this.formFields.push({id:this.$nano.id(),label:t.label||t.type,value:t.id,type:t.type,settings:t.settings})}),this.sameFormFields=[],this.mainFormFields.forEach(t=>{let e=this.formFields.findIndex(e=>t.label===e.label);e>-1&&this.sameFormFields.push({id:this.$nano.id(),index:e,label:t.label,name:this.formFields[e].value,value:this.mainFormModel[t.value]})})}},signLink(t){return`https://appuat.ezofis.com/ezofisapi/api/workflow/signView/${this.$store.state.session.tenantId}/${this.workflow.id}/${t}`},itemLink(){let t=location.origin.replace("http://localhost:8080","http://52.172.32.88");return"inbox"===this.selectedNode||"common"===this.selectedNode||"payment"===this.selectedNode?"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?`https://ag-appsvc04.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.itemModel.repositoryId}&itemId=${this.itemModel.itemId}&type=2&filename=${this.itemModel.name}`:"https://trial.ezofis.com"===t?`https://trial.ezofis.com/docsviewer/index.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.itemModel.repositoryId}&itemId=${this.itemModel.itemId}&type=2&filename=${this.itemModel.name}&action=all`:`${t}/PDFViewer/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.itemModel.repositoryId}&itemId=${this.itemModel.itemId}&wId=${this.workflow.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.itemModel.name}&action=all`:"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?`https://ag-appsvc04.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.itemModel.repositoryId}&itemId=${this.itemModel.itemId}&type=2&filename=${this.itemModel.name}`:"https://trial.ezofis.com"===t?`https://trial.ezofis.com/docsviewer/index.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.itemModel.repositoryId}&itemId=${this.itemModel.itemId}&type=2&filename=${this.itemModel.name}&action=download,print`:`${t}/PDFViewer/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.itemModel.repositoryId}&itemId=${this.itemModel.itemId}&type=2&filename=${this.itemModel.name}&action=download,print`},openFile(t){if(t.loading)this.$alert.info("Please wait to complete the uploading");else{this.selectedFile=t;let e=location.origin;"https://ag-appsvc01.azurewebsites.net"===e||"https://ag-appsvc05.azurewebsites.net"===e?window.open(this.fileLink()):this.fileSheet=!0}},closeAttachmentsSheet(){this.attachmentSheet=!1},closeCommentsSheet(){this.closeCommnetsSheet=!1},closeMetaDataEditModal(){this.showMetaDataEditModal=!1,this.$refs.attachments.value=null},async showLinks(t){if("ATTACHMENTS"===t)this.showAttachmentSheet=!0;else if("COMMENTS"===t){if(this.displayInternalPublic=!1,!this.portal){let t=JSON.parse(this.workflow.flowJson),e=t.blocks.find(t=>"START"===t.type);e&&e.settings.initiateBy.indexOf("PORTAL")>-1&&(this.displayInternalPublic=!0),this.fileNames=[],this.fileNames=this.attachmentList.filter(t=>{let e=t.name.split(".").pop().toUpperCase();return"pdf"===e.toLowerCase()}).map(t=>({id:this.$nano.id(),label:t.name,value:t.id}))}this.showCommentsSheet=!0}else"HISTORY"===t&&this.selectedProcess.processId?this.historyProcessId=this.selectedProcess.processId:"PRINT"===t?this.selectedProcess.formData?window.open(`https://appuat.ezofis.com/ezofisapi/api/form/generatePdfPrint/${this.$store.state.session.tenantId}/${this.workflow.id}/${this.selectedProcess.processId}/${this.formId}/${this.selectedProcess.formData.formEntryId}/1`):this.selectedProcess.itemData&&window.open(`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedProcess.itemData.repositoryId}/${this.selectedProcess.itemData.itemId}/2`):"TASK"===t?this.taskEntries.length?this.taskSheet=!0:this.addTask():"MAIL"===t?(this.getMailTransactions(),this.mailTransactionSheet=!0):"FORM_ENTRY_HISTORY"===t&&(this.showFormEntryHistoryModal=!0)},lastActionDuration(t){const e=t.transaction_createdAt instanceof Date?t.transaction_createdAt:new Date(t.transaction_createdAt),s=new Intl.RelativeTimeFormat("en"),i={years:31536e3,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1},o=(e.getTime()-Date.now())/1e3;for(let a in i)if(i[a]<Math.abs(o)){const t=o/i[a];return s.format(Math.round(t),a)}},validateTypeValue(t){if(t)try{var e=JSON.parse(t);if("object"===typeof e)return e}catch(s){return t}return t},validateType(t){let e="";return this.panels&&this.panels.length&&this.panels.forEach(s=>{if(!s.fields.length)return;let i=s.fields.find(e=>e.id===t);i&&(e=i.type)}),e},validateValue(t){let e=/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;return!e.test(t)},async getFileData(t,e){const{error:s,payload:i}=await l["p"].getFileData({repositoryId:t.repositoryId,itemId:t.id});s?this.$alert.error(s):i&&(t.fileData?this.fileData=t.fileData:this.fileData=i,"file"!==e&&(this.fileDetailsSheet=!0))},async sendCommentsToJira(t,e,s){if(this.$store.commit("showLoadingBar"),1===this.jiraCommentAction){var i;let e=null===(i=this.formFields.find(t=>"Resource ID"===t.label))||void 0===i?void 0:i.value;t=this.selectedProcess.formData.fields[e]+","+t}t=`${this.$store.state.session.firstName} ${this.$store.state.session.lastName}: ${t}`;let o={cloudIntegrationId:this.jiraAccounts[0].id,url:this.selectedProcess.jiraIssueInfo.self,data_onpremise:{body:t},issueId:e,ezCommentId:s};const{error:a,payload:r}=await l["j"].insertJiraIssueComments(o);if(this.$store.commit("hideLoadingBar"),a){this.$alert.error("error posting comments to jira");let t=JSON.parse(a);return this.errorMessage=t.errorMessages,void(this.errorModal=!0)}console.log(r),this.jiraCommentAction=1},async uploadAttachments(t,e){if(this.selectedProcess.processId){const i=t.target.files[0],o=new FormData;o.append("workflowId",this.workflow.id),o.append("repositoryId",this.workflow.repositoryId),o.append("processId",this.selectedProcess.processId),o.append("transactionId",this.selectedProcess.transactionId),this.formData=o,e?(o.append("fields",e),this.formData=e):o.append("fields",""),o.append("file",i);let a=t.target.files[0].name;const r=a.split(".").pop();if(this.checkListRowIndex){let t=this.checkList.filter(t=>t.uid===this.checkListRowIndex);o.append("filename",t[0].name+"."+r),a=t[0].name+"."+r}if(!Object(u["a"])(r))return void this.$alert.info("This file format is not supported");this.$store.commit("showLoadingBar");try{const t=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/workflow/attachmentWithProcessId",method:"POST",data:o,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}}),{status:e,data:s}=t;if(200!==e||!s)throw t;this.$alert.success("Document attached"),this.documentLoad=setInterval(()=>{this.getAttachments(),clearInterval(this.documentLoad)},15e3)}catch(s){this.$alert.error("Error uploading file"),console.error(s)}this.$store.commit("hideLoadingBar"),this.checkList.length&&this.checkList.forEach(t=>{t.uid!==this.checkListRowIndex||(t.attach=!0)}),t.target.value="",Object.keys(this.reuploadFile).length&&(await this.attachmentDelete(this.reuploadFile),this.reuploadFile={})}else{const i=t.target.files[0],o=new FormData;o.append("file",i),o.append("repositoryId",this.workflow.repositoryId),e&&(this.fileData=JSON.parse(e),o.append("fields",e));let a=t.target.files[0].name;const r=a.split(".").pop();if(this.checkListRowIndex){let t=this.checkList.filter(t=>t.uid===this.checkListRowIndex);o.append("filename",t[0].name+"."+r),a=t[0].name+"."+r}else o.append("filename",a);if(!Object(u["a"])(r))return void this.$alert.info("This file format is not supported");try{const s=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/upload",method:"POST",data:o,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}}),{status:n,data:l}=s;if(200!==n)throw"Invalid response";let c=JSON.parse(l);this.$alert.success("Document attached");let d=this.repositoryField.reduce((t,e)=>t.level>e.level?t:e),h=this.fileData.find(t=>t.name===d.name),u=!1;"pdf"!==r.toLowerCase()&&(u=!0,this.documentLoadList.push(Number(c.fileId)),this.documentLoad=setInterval(()=>{let t=this.attachmentList.find(t=>this.documentLoadList.indexOf(t.id)>-1);t&&(this.documentLoadList.splice(this.documentLoadList.indexOf(t.id),1),t.loading=!1),0===this.documentLoadList.length&&clearInterval(this.documentLoad)},1e4)),this.attachmentList.push({id:Number(c.fileId),name:e?h.value+"."+r:a,createdAt:(new Date).toISOString(),createdByEmail:this.$store.state.session.email,size:i.size,initiate:!0,uid:this.checkListRowIndex,createdBy:this.$store.state.session.id,fileData:this.fileData,repositoryId:this.workflow.repositoryId,loading:u}),this.checkList.length&&this.checkList.forEach(t=>{t.uid!==this.checkListRowIndex||(t.attach=!0)}),t.target.value=""}catch(s){console.error(s),this.$alert.error("error attaching file")}}},async getMailTransactions(){this.mailTransactionList=[],this.tabs.find(t=>{"MAIL"===t.value&&(t.count=0)});let t={filterBy:[]};const{error:e,payload:s}=await l["t"].getMailTransactions(this.workflow.id,this.selectedProcess.processId,t);e?this.$alert.error(e):s.length&&(this.mailTransactionList=s,this.tabs.find(t=>{"MAIL"===t.value&&(t.count=this.mailTransactionList.length)}))},checkCommentsOption(){let t=location.origin;return"https://ag-appsvc01.azurewebsites.net"!==t&&"https://ag-appsvc05.azurewebsites.net"!==t&&("https://app.ezofis.com"!==t&&"https://appuat.ezofis.com"!==t||2!==this.$store.state.session.tenantId||!(!Object.keys(this.selectedProcess).length||!this.selectedProcess.jiraIssueInfo.id))},async uploadWflowAttachments(t){if(this.fileUploadForControl=!1,"STATIC"===this.repositoryDetails.fieldsType){if(this.selectedUploadFile=t,this.customCheckUpload()){let e=this.formFields.find(t=>"Document No"===t.label);this.uploadFilename=e?this.workflowModel[e.value]+".pdf":t.target.files[0].name}else this.uploadFilename=t.target.files[0].name;this.showMetaDataEditModal=!0}else this.uploadAttachments(t)},customCheckUpload(){let t=location.origin;return"https://edmsuat.sobhaapps.com"===t&&(55===this.workflow.id||2092===this.workflow.id)&&0===this.attachmentList.length},checkTenant(){let t=location.origin;return"https://ag-appsvc01.azurewebsites.net"!==t&&"https://ag-appsvc05.azurewebsites.net"!==t||(this.commentAction=2,!1)},isTenantGOTO(){let t=location.origin;return("https://app.ezofis.com"===t||"https://appuat.ezofis.com"===t)&&2===this.$store.state.session.tenantId},isTenantGOTOComments(){if(Object.keys(this.selectedProcess).length){let t=location.origin;if(("https://app.ezofis.com"===t||"https://appuat.ezofis.com"===t)&&2===this.$store.state.session.tenantId&&this.selectedProcess.jiraIssueInfo.id)return!0}return!1},toggleWidth(){this.formWidth="100vw"===this.formWidth?"50vw":"100vw"},clearAttach(){this.selectedFileForAttach=0,this.attachComment=!1},async getComments(t=0,e=0){this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=0)}),this.commentsList=[],t||e||(t=this.workflow.id,e=this.selectedProcess.processId),this.$store.commit("showLoadingBar");const{error:s,payload:i}=await l["t"].getProcessComments(t,e);this.$store.commit("hideLoadingBar"),s?this.$alert.error(s):(i.length&&(this.commentsList=i,this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=this.commentsList.length)})),this.$emit("commentsLength",this.commentsList.length))},async saveComment(){if(this.commentText)if(this.selectedProcess.processId){if("https://app.ezofis.com"!==origin&&"https://appuat.ezofis.com"!==origin||2!==this.$store.state.session.tenantId||!this.selectedProcess.jiraIssueInfo.id||2!==this.jiraCommentAction){const{error:t,payload:e}=await l["t"].insertProcessComment(this.workflow.id,this.selectedProcess.processId,this.selectedProcess.transactionId,{comments:this.commentText,showTo:this.portal?1:this.commentAction,embedJson:JSON.stringify({repositoryId:this.workflow.repositoryId,itemIds:this.attachComment?[this.selectedFileForAttach]:[]})});if(t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.commentText,this.selectedProcess.jiraIssueInfo.id,[e])}else{const{error:t,payload:e}=await l["t"].insertProcessComment_Jira(this.selectedProcess.jiraIssueInfo.id,{comments:this.commentText});if(t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.commentText,this.selectedProcess.jiraIssueInfo.id,e)}this.commentText="",this.getComments()}else this.commentsList.push({comments:this.commentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id}),this.commentText=""},async saveAdvancedComment(){if(this.advancedCommentText){if(this.attachComment&&!this.selectedFileForAttach)return void this.$alert.warning("Select File To Attach");if(this.selectedProcess.processId){if("https://app.ezofis.com"!==origin&&"https://appuat.ezofis.com"!==origin||2!==this.$store.state.session.tenantId||!this.selectedProcess.jiraIssueInfo.id||2!==this.jiraCommentAction){const{error:t,payload:e}=await l["t"].insertProcessComment(this.workflow.id,this.selectedProcess.processId,this.selectedProcess.transactionId,{comments:this.advancedCommentText,showTo:this.portal?1:this.commentAction,embedJson:JSON.stringify({repositoryId:this.workflow.repositoryId,itemIds:this.attachComment?[this.selectedFileForAttach]:[]})});if(t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.advancedCommentText,this.selectedProcess.jiraIssueInfo.id,e)}else{this.$store.commit("showLoadingBar");const{error:t,payload:e}=await l["t"].insertProcessComment_Jira(this.selectedProcess.jiraIssueInfo.id,{comments:this.advancedCommentText});if(this.$store.commit("hideLoadingBar"),t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.advancedCommentText,this.selectedProcess.jiraIssueInfo.id,e)}this.advancedCommentText="",this.advancedCommentsSheet=!1,this.clearAttach(),this.getComments()}else this.commentsList.push({comments:this.advancedCommentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id}),this.advancedCommentText="",this.advancedCommentsSheet=!1,this.tabs.find(t=>{"COMMENTS"===t.value&&(t.count=this.commentsList.length)});this.actionComments&&this.processRequest(!1,!1)}},fileType(t){if(t)return t.split(".").reverse()[0].slice(0,4)},fileSize(t){return Object(f["a"])(t)},fileLink(){let t=location.origin.replace("http://localhost:8080","http://52.172.32.88");if(this.selectedFile.name){let e=this.selectedFile.name.split(".").pop();if(this.selectedFile.initiate){let s=1;"STATIC"===this.repositoryDetails.fieldsType&&"FORM"===this.workflow.initiatedBy&&(s=2);let i="";if(Object(u["d"])(e))i="https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?"https://ag-appsvc04.azurewebsites.net/web/viewer.html":"https://trial.ezofis.com"===t?"https://trial.ezofis.com/docsviewer/index.html":t+"/PDFViewer/web/viewer.html";else{if("http://52.172.32.88"!==t)return`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/${s}`;i="http://52.172.32.88/DocsViewer/index.html"}return`${i}?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=${s}`}{let s="";"inbox"!==this.selectedNode&&"common"!==this.selectedNode&&"payment"!==this.selectedNode||(s="&action=all");let i="";if(Object(u["d"])(e))"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?(s="",i="https://ag-appsvc04.azurewebsites.net/web/viewer.html"):i="https://trial.ezofis.com"!==t||Object(u["c"])(e)?t+"/PDFViewer/web/viewer.html":"https://trial.ezofis.com/docsviewer/index.html";else{if(Object(u["b"])(e)||"http://52.172.32.88"!==t)return`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`;i="http://52.172.32.88/DocsViewer/index.html"}return`${i}?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.workflow.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}${s}`}}},closeTaskSheet(){this.taskSheet=!1},closeJiraIssueSheet(){this.issueName="",this.projectKey="",this.issueType="",this.issueDescription="",this.issueEpicValue="",this.issueAssignee="",this.issueDescriptionTable=!1,this.issueDescriptionFields=[],this.jiraIssueSheet=!1},loadProcessLinks(){this.getComments(),this.getAttachments(),this.getProcessSignature(),this.getMailTransactions()},async getProcessSignature(){this.signList=[];const{error:t,payload:e}=await l["t"].getProcessSignature(this.workflow.id,this.selectedProcess.processId);t?this.$alert.error(t):this.signList=e},async attachmentDelete(t){if(t.fileControl){let e=this.workflowModel[t.fieldId];if(e.length){let s=e.findIndex(e=>e.fileId===t.id);console.log(s),s>=0&&this.workflowModel[t.fieldId].splice(s,1);let i=this.formUploadFiles.findIndex(e=>e.fileId===t.id&&e.fileId===t.fileId);console.log(i),i>=0&&this.formUploadFiles.splice(s,1),t.control.length&&t.control.forEach(t=>{this.workflowModel[t]=""})}let s=this.attachmentList.findIndex(t=>t.fileControl);console.log(s),s>=0&&(this.tabs.find(t=>{"ATTACHMENTS"===t.value&&(t.count=this.attachmentList.length-1)}),this.attachmentList.splice(s,1))}else if(t.initiate){const{error:e}=await l["r"].deleteUploadedFiles([t.id]);if(e)return void this.$alert.error(e);this.attachmentList=this.attachmentList.filter(e=>e.id!==t.id),this.checkList.forEach(e=>{e.uid===t.uid&&(e.attach=!1)})}else{const{error:e}=await l["p"].fileDelete(this.workflow.repositoryId,t.id);if(e)return void this.$alert.error(e);this.getAttachments()}},async saveProcessSignature(t){let e={signBinary:this.signImg.split(",")[1],fileType:"png"};const{error:s}=await l["t"].saveProcessSignature(this.workflow.id,t.processId,t.transactionId,e);s?this.$alert.error(s):this.signImg=""},async getAppConnection(){this.jiraConnect=!1;const{error:t,payload:e}=await l["j"].getJiraConnection({filterBy:[]});t?this.$alert.error(t):e.forEach(t=>{"jira"===t.cloudName&&(this.jiraConnect=!0,this.jiraAccounts.push(t))})},async createJiraIssue(){this.issueRef={};const t=await this.$refs.form.validate();if(!t)return;let e=[],s="",i="",o=0;this.groupKey.forEach(t=>{if(t.checked)return e=[],void(s=t.name)}),""===s&&(this.workflowRequestList.forEach(t=>{t.checked&&e.push(t.transactionId)}),this.issueDescriptionTable&&(i="||Action Taken (Mandatory)",this.issueDescriptionFields.forEach(t=>{i+="||"+t}),i+="||\n",this.workflowRequestList.forEach(t=>{t.checked&&(i+="|| ",this.issueDescriptionFields.forEach(e=>{var s;let a=null===(s=this.formFields.find(t=>t.label===e))||void 0===s?void 0:s.value;"Savings"===e?t.formData.fields[a]?(i+="||"+Number(t.formData.fields[a]).toFixed(2),o+=Number(t.formData.fields[a])):i+="|| ":t.formData.fields[a]?i+="||"+t.formData.fields[a]:i+="|| "}),i+="||\n")}),i+="Potential Savings: "+o.toFixed(2)+"\n"));let a={};a=this.jiraAccounts[0].email?{fields_cloud:{fields:{summary:this.issueName,project:{key:this.projectKey},issuetype:{name:this.issueType},description:{content:[{content:[{text:this.issueDescription+i,type:"text"}],type:"paragraph"}],type:"doc",version:1}}},cloudIntegrationId:this.jiraAccounts[0].id}:{fields_onpremise:{fields:{summary:this.issueName,project:{key:this.projectKey},issuetype:{name:this.issueType},description:this.issueDescription+i,customfield_14635:{value:"No"},customfield_15136:{value:"Maintenance"}}},cloudIntegrationId:this.jiraAccounts[0].id,workflowId:this.workflow.id,transactionId:e,mlPrediction:s,assignee:this.issueAssignee?{name:this.issueAssignee}:{},filterBy:this.filterBy},this.$store.commit("showLoadingBar");const{error:r,payload:n}=await l["j"].createJiraIssue(a);if(this.$store.commit("hideLoadingBar"),r){this.$alert.warning("error creating issue in jira");let t=JSON.parse(r);return console.log(t),this.errorMessage=t.errorMessages,void(this.errorModal=!0)}if(s)this.successModal=!0;else{if(!n)return void this.$alert.warning("error creating issue in jira");this.issueRef=JSON.parse(n),this.issueRef.self=this.getJIRALink(this.issueRef),this.$alert.success("Issue Created in JIRA"),this.jiraConfirmModal=!0}this.closeJiraIssueSheet()},async insertJiraIssueComment(){var t,e;let s="",i="";if(s=null===(t=this.formFields.find(t=>"Reference ID"===t.label))||void 0===t?void 0:t.value,i=null===(e=this.formFields.find(t=>"Remarks"===t.label))||void 0===e?void 0:e.value,this.workflowFormModel[s]&&this.workflowFormModel[i]){this.$store.commit("showLoadingBar");let t={};t=this.jiraAccounts[0].email?{cloudIntegrationId:this.jiraAccounts[0].id,url:this.workflowFormModel[s],data_cloud:{body:this.workflowFormModel[i]}}:{cloudIntegrationId:this.jiraAccounts[0].id,url:this.workflowFormModel[s],data_onpremise:{body:this.workflowFormModel[i]}};const{error:e,payload:o}=await l["j"].insertJiraIssueComments(t);if(this.$store.commit("hideLoadingBar"),e)return void this.$alert.error(e);console.log(o)}},async getJiraUsers(){this.issueAssigneeUsers=[];const{error:t,payload:e}=await l["j"].getJiraUsers({cloudIntegrationId:this.jiraAccounts[0].id});t?this.$alert.error(t):e.length&&e.forEach(t=>{this.issueAssigneeUsers.push({id:t.key,label:t.displayName,value:t.name})})},validateRequest(t){this.saveAction=t,this.itemModel.itemId&&this.processRequest()},async processRequest(t=!0,e=!0){if(t){let t=location.origin;if(("https://app.ezofis.com"===t||"https://appuat.ezofis.com"===t)&&2===this.$store.state.session.tenantId&&"Assign"===this.saveAction&&this.internalForward.proceed)return this.processForwardGroupAction=!1,void(this.processForwardModal=!0);if("Forward"===this.saveAction&&this.internalForward.proceed)return this.processForwardGroupAction=!1,void(this.processForwardModal=!0)}if(e){let t=this.processActionsAddOn.find(t=>t.action===this.saveAction);if(t&&Object.keys(t).length){if(this.actionRemarks=t.remarks,this.actionPassword=t.passwordAccess,this.actionConfirm=t.confirm,this.actionPassword)return void(this.actionPasswordConfirm=!0);if(this.actionRemarks)return this.actionComments=!0,void(this.advancedCommentsSheet=!0);if(this.actionConfirm)return void(this.actionConfirmAlert=!0)}}let s={},i=location.origin;this.userReply&&this.saveAction.indexOf("Reply")>-1?this.saveAction="UserReply":this.toRequester&&"To Requester"===this.saveAction&&(this.saveAction="ToInitiator"),this.customReply&&this.saveAction.indexOf("Reply")>-1&&(this.saveAction="Reply",this.forwardUsers.push(this.selectedProcess.transaction_createdBy));let o=[];this.formFields.forEach(t=>{if("FILE_UPLOAD"===t.type&&this.workflowModel[t.value]){let e=[];this.workflowModel[t.value].forEach(t=>{t.fileId&&e.push(t.fileId)}),e.length&&o.push({jsonId:t.value,fileIds:e}),delete this.workflowFormModel[t.value]}}),this.formId?("https://app.ezofis.com"!==i&&"https://appuat.ezofis.com"!==i||2!==this.$store.state.session.tenantId||"Rollback"!==this.saveAction?"http://demo.ezofis.com"!==i&&"http://52.172.32.88"!==i||6===this.workflow.id&&this.forwardUsers.push(this.selectedProcess.transaction_createdBy):1===this.workflow.id&&this.forwardUsers.push(this.selectedProcess.transaction_createdBy),s={workflowId:this.workflow.id,transactionId:this.selectedProcess.transactionId,review:"Save"===this.saveAction||"CustomVerify"===this.saveAction?"":this.saveAction,formData:{formId:this.formId,formEntryId:this.selectedProcess.formData.formEntryId,fields:this.workflowFormModel,formUpload:o},userIds:this.forwardUsers,groupIds:this.forwardGroups}):this.itemModel&&(s={workflowId:this.workflow.id,transactionId:this.selectedProcess.transactionId,review:"Save"===this.saveAction?"":this.saveAction,formData:{},userIds:this.forwardUsers,groupIds:this.forwardGroups}),this.saveAction="",this.workflowFormModel={},this.saveOnly||this.$store.commit("showLoadingBarSave");const{error:a}=await l["t"].processTransaction(s);this.saveOnly||this.$store.commit("hideLoadingBarSave"),a?this.$alert.error(a):(this.signImg&&await this.saveProcessSignature(this.selectedProcess),this.saveOnly?this.saveOnly=!1:(""===s.review?this.$alert.info(this.selectedProcess.requestNo+" data saved, awaiting your action to submit"):s.review.toLowerCase().indexOf("reject")>-1?this.$alert.danger(this.selectedProcess.requestNo+" Request Rejected Successfully"):this.$alert.success(this.selectedProcess.requestNo+" Request Processed"),this.forwardUsers=[],this.forwardGroups=[],this.customReply=!1,this.userReply=!1,this.toRequester=!1,this.closeProcessSheet()),this.fileControlDeleteFile.length&&(this.fileControlDeleteFile.forEach(t=>{this.fileControlDeletedFile(t)}),this.fileControlDeleteFile=[]))},checkRequiredDocument(){if("Save"===this.saveAction||"Force Close"===this.saveAction)this.proceedSubmission();else{if(this.documentRequired&&0===this.attachmentList.length)return this.$alert.warning("A minimum of one document is required for submission"),this.saveAction="",void(this.workflowFormModel={});let t=this.checkList.filter(t=>t.required&&!t.attach);t.length?this.docWarning?this.alertModal=!0:(this.$alert.warning("Mandatory documents required"),this.saveAction="",this.workflowFormModel={}):this.proceedSubmission()}},proceedSubmission(){this.alertModal=!1,this.initiateProcess?this.initiateRequest():this.processRequest()},closeAlertModal(){this.alertModal=!1,this.saveAction="",this.workflowFormModel={}},getJiraIssueInfo(t){if(t.jiraIssueInfo.id)return{"Ref# Id":t.jiraIssueInfo.id,Key:t.jiraIssueInfo.key,Link:t.jiraIssueInfo.self?this.getJIRALink(t.jiraIssueInfo):"",Assignee:t.jiraIssueInfo.assignee,"Issue Status":t.jiraIssueInfo.issueStatus}},async groupProcessRequest(){let t=[],e="";this.workflowRequestList.forEach(e=>{e.key===this.groupActionKey&&e.checked&&t.push(e.transactionId)}),this.groupKey.forEach(s=>{if(s.checked)return t=[],void(e=s.name)});let s={workflowId:this.workflow.id,transactionId:t,review:"Save"===this.saveAction?"":this.saveAction,fields:this.workflowFormModel,mlPrediction:e,comments:this.commentText,userIds:this.forwardUsers,groupIds:this.forwardGroups,filterBy:this.filterBy};const{error:i}=await l["t"].groupRequestAction(s);this.$store.commit("hideLoadingBar"),i?this.$alert.error(i):(await this.insertJiraIssueComment(),this.saveAction="",this.workflowFormModel={},this.forwardUsers=[],this.forwardGroups=[],this.$alert.success("Group Request Processed"),this.closeRequestActionModal(),this.$emit("refresh",this.workflow.id))},async initiateRequest(){let t=[];this.attachmentList.length&&this.attachmentList.forEach(e=>{t.push(e.id)});let e=[];this.formFields.forEach(t=>{if("FILE_UPLOAD"===t.type&&this.workflowModel[t.value]){let s=[];this.workflowModel[t.value].forEach(t=>{t.fileId&&s.push(t.fileId)}),s.length&&e.push({jsonId:t.value,fileIds:s}),delete this.workflowFormModel[t.value]}});let s={workflowId:this.workflow.id,review:"Save"===this.saveAction?"":this.saveAction,comments:this.commentsList,formData:{formId:this.formId,fields:this.workflowFormModel,formUpload:e},fileIds:t,task:this.taskEntryId,hasFormPDF:this.generatePDF,prefix:this.requestPrefix,mlPrediction:this.mlPrediction};this.$store.commit("showLoadingBarSave");const{error:i,payload:o}=await l["t"].processTransaction(s);this.$store.commit("hideLoadingBarSave"),this.saveAction="",this.workflowFormModel={},this.alertModal=!1,i?this.$alert.error(i):(this.signImg&&await this.saveProcessSignature(o),this.$alert.success(o.requestNo+" Request Initiated"),this.mainProcessId?this.addSubWorkflowProcess(o.processId):this.$emit("update:subProcessId",o.processId),this.closeProcessSheet())},saveMetaData(t){let e=[];if(this.repositoryField.forEach(s=>{e.push({name:s.name,value:t[s.name],type:s.dataType})}),e.forEach(t=>{let e=this.formFields.find(e=>Object(B["a"])(e.label)===Object(B["a"])(t.name));e&&t.value&&(this.workflowModel[e.value]=t.value)}),this.fileUploadForControl){this.metaDataModal=t;let s=this.fileUploadInput;this.uploadFilesFromForm(s.files,s.control,s.fieldId,JSON.stringify(e))}else this.uploadAttachments(this.selectedUploadFile,JSON.stringify(e))},attachTemplate(t){this.checkListRowIndex=t,this.$refs.attachments.click()},attachmentFilterCheckList(t){return this.attachmentList.filter(e=>e.name.substring(0,e.name.lastIndexOf("."))===t||e.name.substring(0,e.name.lastIndexOf(".")).split("_")[0]===t)},isCheckList(t){let e=this.checkList.filter(e=>e.name===t.substring(0,t.lastIndexOf("."))||e.name===t.substring(0,t.lastIndexOf(".")).split("_")[0]);return!e.length},showMailAttachments(t){this.mailAttachmentList=[];let e=t.attachmentJson.split(",");e.forEach(e=>{let s=e.split("\\").pop();this.mailAttachmentList.push({id:this.$nano.id(),mailId:t.id,name:s,createdAt:t.createdAt})}),this.mailAttachmentSheet=!0},openAttachmentFile(t){let e=`https://appuat.ezofis.com/ezofisapi/api/client/viewAttachment/${this.$store.state.session.tenantId}/${t.mailId}/${t.name}`;window.open(e,"_blank")},lastCommentDuration(t){const e=t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt),s=new Intl.RelativeTimeFormat("en"),i={years:31536e3,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1},o=(e.getTime()-Date.now())/1e3;for(let a in i)if(i[a]<Math.abs(o)){const t=o/i[a];return s.format(Math.round(t),a)}},async getTaskForm(){this.taskFormList=[],this.addTaskEnabled=!1;const{error:t,payload:e}=await l["g"].getForms({mode:"BROWSE",sortBy:{criteria:"",order:"DESC"},groupBy:"",filterBy:[{filters:[{criteria:"type",condition:"IS_EQUALS_TO",value:"Task",dataType:""}],groupCondition:""}],itemsPerPage:50,currentPage:1});if(t)return void this.$alert.error(t);const{data:s}=e;s.length&&s[0].value.length&&(this.addTaskEnabled=!0,s[0].value.forEach(t=>{this.taskFormList.push({id:t.id,label:t.name,value:t.id,repositoryId:t.repositoryId,formJson:t.formJson})}),this.taskFormList.length&&1===this.taskFormList.length&&(this.taskFormId=this.taskFormList[0].id,this.taskRepositoryId=this.taskFormList[0].repositoryId,this.addTaskForm=JSON.parse(this.taskFormList[0].formJson)))},async getTaskFormEntry(t,e){const{error:s,payload:i}=await l["g"].getFormEntry(t,e);if(s)this.$alert.error(s);else if(i.length){const t=[...this.addTaskForm.panels,...this.addTaskForm.secondaryPanels];let e=[];for(const i of t)e.push(...i.fields);let s="",o="",a="",r="",n="",l="";e.forEach(t=>{switch(t.label){case"Task Name":s=i[0][t.id];break;case"Task Assign":o=i[0][t.id];break;case"Start Date":a=i[0][t.id];break;case"End Date":r=i[0][t.id];break;case"Priority":n=i[0][t.id];break;case"Task Status":l=i[0][t.id];break}}),this.taskEntries.push({id:i[0].itemid,name:s,assigned:o,startDate:a,endDate:r,priority:n,status:l})}},async getTaskList(){this.taskEntries=[];const{error:t,payload:e}=await l["t"].getTaskEntries(this.selectedWorkflow.id,this.selectedProcess.processId,{filterBy:[{filters:[{criteria:"createdBy",condition:"IS_EQUALS_TO",value:this.$store.state.session.id}]}]});if(t)this.$alert.error(t);else if(e.length){const t=[...this.addTaskForm.panels,...this.addTaskForm.secondaryPanels];let s=[];for(const e of t)s.push(...e.fields);this.taskList=e,e.forEach(t=>{let e="",i="",o="",a="",r="",n="";s.forEach(s=>{switch(s.label){case"Task Name":e=t.entryInfo[0][s.id];break;case"Task Assign":i=t.entryInfo[0][s.id];break;case"Start Date":o=t.entryInfo[0][s.id];break;case"End Date":a=t.entryInfo[0][s.id];break;case"Priority":r=t.entryInfo[0][s.id];break;case"Task Status":n=t.entryInfo[0][s.id];break}}),this.taskEntries.push({id:t.entryInfo[0].itemid,name:e,assigned:i,startDate:o,endDate:a,priority:r,status:n})})}},async insertTaskEntry(t,e){const{error:s}=await l["t"].insertTaskEntry({workflowId:this.selectedWorkflow.id,processId:this.selectedProcess.processId,transactionId:this.selectedProcess.transactionId,wFormId:t,formEntryId:e});s?this.$alert.error(s):this.getTaskList()},addTaskEntry(t,e){this.selectedProcess.processId?this.insertTaskEntry(t,e):(this.taskEntryId.push({formId:t,formEntryId:e}),this.getTaskFormEntry(t,e))},addTask(){this.selectedTask={},this.taskMode="NEW",this.addTaskSheet=!0},viewTask(t){let e=this.taskList.filter(e=>e.formEntryId===t);e.length&&(this.selectedTask=e[0].entryInfo[0],this.selectedTask={id:e[0].formEntryId,...e[0].entryInfo[0]}),this.taskMode="EDIT",this.addTaskSheet=!0},removeTags(t){return t?t.replace(/(<([^>]+)>)/gi,""):""},tableValue(t){return t?JSON.parse(t):[]},async uploadFile(t){const e=t.target.files[0];if("text/csv"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type||"application/vnd.ms-excel"===e.type){const i=new FormData;i.append("formId",this.masterFormId),i.append("file",e);try{this.$store.commit("showLoadingBarSave");const t=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/form/uploadMasterFile",method:"POST",data:i,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}});this.$store.commit("hideLoadingBarSave");const{status:e,data:s}=t;if(200!==e||!s)throw t;this.$alert.success("Data imported successfully")}catch(s){this.$alert.error("Error uploading file"),console.error(s)}this.dataImported=!0,t.target.value=""}else this.$alert.error("Please upload a csv/excel file")},async addSubWorkflowProcess(t){let e={mainWorkflowId:this.mainWorkflowId,subWorkflowId:this.workflowId,mainProcessId:this.mainProcessId,subProcessId:t,subProcessStatus:0,review:""};const{error:s}=await l["t"].addSubWorkflow(e);s?this.$alert.error(s):this.updateSubWorkflowProcess()},getModel(t){if(this.formModel={},this.itemModel={},console.log(this.selectedProcess.processId,t,this.selectedProcess.id,this.workflow.id),this.selectedProcess.processId==t&&this.selectedProcess.id==this.workflow.id)if(this.headerTitle=`${this.selectedProcess.requestNo} - ${this.selectedProcess.stageName}`,this.selectedProcess.formData){let t=Object.keys(this.selectedProcess.formData.fields),e={};t.forEach(t=>{e[t]=this.validateTypeValue(this.selectedProcess.formData.fields[t])}),this.formModel=e}else this.selectedProcess.itemData&&(this.itemModel=this.selectedProcess.itemData)},async dataValidation(t,e=!0){const{error:s,payload:i}=await l["d"].armgroupMLValidation({filterBy:[{filters:[{criteria:"processId",condition:"IS_EQUALS_TO",value:t}],groupCondition:""}],mode:"BROWSE"});s?this.$alert.error(s):i.length?(this.dataValidationValues=i,e&&(this.dataValidationModal=!0)):(this.dataValidationValues=[],e&&this.$alert.info("Data not found"))},async documentMerge(){let t=[];this.attachmentList.forEach(e=>{let s=e.name.split(".").pop();e.checked&&"pdf"===s.toLowerCase()&&t.push(e.id)});let e={ids:t};const{error:s}=await l["t"].documentMerge(this.workflow.id,this.selectedProcess.processId,this.selectedProcess.transactionId,this.workflow.repositoryId,e);s?this.$alert.error(s):this.$alert.success("Document merge process initiated")},async documentShare(){this.selectedFileList=[],this.attachmentList.forEach(t=>{t.checked&&this.selectedFileList.push({id:t.id,name:t.name})}),this.emailSharingSheet=!0},fileMenuAction(t,e){this.selectedFile=t,this.documentAction(e,!0)},fileSelectAll(){this.attachmentList=this.attachmentList.map(t=>({...t,checked:this.selectAll}))},documentAction(t,e){if("Email_Sharing"===t);else if("Print"===t){if(this.selectedFile.name)if(e){let t="";if(this.selectedFile.initiate){let e=1;"STATIC"===this.repositoryDetails.fieldsType&&"FORM"===this.workflow.initiatedBy&&(e=2),t=`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/${e}/1`}else t=`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`;window.open(t,"_blank")}else{let t=this.selectedFile.name.split(".").pop();Object(u["d"])(t)?(localStorage.setItem("filePrint",!0),localStorage.setItem("filePrintId",this.selectedFile.id)):this.$refs.myAttachmentFiles.contentWindow.print()}this.filePrintSession()}else if("Download"===t){let t="";if(this.selectedFile.initiate){let e=1;"STATIC"===this.repositoryDetails.fieldsType&&"FORM"===this.workflow.initiatedBy&&(e=2),t=`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/${e}/2`}else t=`https://appuat.ezofis.com/ezofisapi/api/menu/file/download/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`;window.open(t,"_blank")}},async filePrintSession(){const{error:t}=await l["k"].filePrintSession({repositoryId:this.selectedFile.repositoryId,itemId:this.selectedFile.id,activityId:4});t&&this.$alert.error(t)},async updateSubWorkflowProcess(){const{error:t,payload:e}=await l["q"].updateSubWorkflowProcess(this.mainWorkflowId,this.$store.state.session.tenantId,this.workflowId);t?this.$alert.error(t):console.log(e)},async uploadFilesFromForm(t,e,s,i){this.formUploadFiles=[];const o=new FormData;let a=[];if(e&&e.length&&e.forEach(t=>{let e=this.formFields.find(e=>e.value===t);e&&a.push(`${e.label}, ${e.type}`)}),t.length){for(let e of t)if(e.name&&!e.error){o.append("repositoryId",this.workflow.repositoryId),o.append("file",e),o.append("filename",e.name),a.length&&o.append("formFields",JSON.stringify(a)),i?o.append("fields",i):o.append("fields","");try{const t=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/upload",method:"POST",data:o,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"},onUploadProgress:function(t){let i=Math.round(100*t.loaded/t.total),o=this.workflowModel[s].findIndex(t=>t.name===e.name);o>=0&&(this.$set(this.workflowModel[s][o],"uploadedPercentage",0),this.workflowModel[s][o].uploadedPercentage=i)}.bind(this)}),{status:i,data:a}=t;if(200!==i)throw"Invalid response";e.createdAt=this.$day.newDateTime(),e.createdBy=this.$store.state.session.email;let r=JSON.parse(a);e.fileId=r.fileId,e.fieldId=s}catch(r){console.error(r),this.$alert.error("error attaching file")}}let n=Array.from(t);this.formUploadFiles=[];for(let t of n)if(t.name){const e=await Object($["a"])(t);this.formUploadFiles.push({name:t.name,size:t.size,file:e,fileId:t.fileId,createdBy:t.createdBy,createdAt:t.createdAt,workflowId:this.selectedProcess.id,processId:this.selectedProcess.processId,fieldId:t.fieldId})}e.forEach(t=>{let e=this.readonlyControls.findIndex(e=>e===t);e>=0&&this.readonlyControls.splice(e,1)}),this.$store.commit("hideLoadingBarSave")}},mandatoryControlsList(t){this.mandatory=t},deletedFiles(t){this.fileControlDeleteFile.push(t)},async fileControlDeletedFile(t){this.$store.commit("showLoadingBar");let e=[];t.forEach(t=>{t.id&&e.push(t.id)});let s={ids:e,formInfo:{formId:this.formId,formEntryId:this.selectedProcess.formData.formEntryId,jsonId:t[0].jsonId}};const{error:i}=await l["p"].fileControlDeleteFile(this.workflow.repositoryId,s);this.$store.commit("hideLoadingBar"),i&&this.$alert.error(i)},async checkFormValidation(){this.hasCheckFormValidate=!0},async getOCRResult(t,e,s){const i=new FormData;let o=[];if(e&&e.length){if(e.forEach(t=>{this.readonlyControls.push(t)}),e.forEach(t=>{let e=this.formFields.find(e=>e.value===t);e&&o.push(`${e.label}, ${e.type}`)}),t.length){for(let e of t){if(e.name&&!e.error){i.append("repositoryId",this.workflow.repositoryId),i.append("file",e),o.length&&i.append("formFields",JSON.stringify(o));try{const t=await m()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/uploadforStaticMetadata",method:"POST",data:i,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"},onUploadProgress:function(t){let i=Math.round(100*t.loaded/t.total),o=this.workflowModel[s].findIndex(t=>t.name===e.name);o>=0&&(this.$set(this.workflowModel[s][o],"uploadedPercentage",0),100!==i&&(this.workflowModel[s][o].uploadedPercentage=i))}.bind(this)}),{status:o,data:a}=t;if(200!==o)throw"Invalid response";let r=Object(E["a"])(a,this.$store.state.identity.key,this.$store.state.identity.iv),n=JSON.parse(r),l=JSON.parse(n),c=JSON.parse(l);Array.isArray(c)&&c.forEach(t=>{let e=this.formFields.find(e=>e.label===t.name);e&&t.value&&(this.workflowModel[e.value]=t.value)})}catch(a){console.error(a),this.$alert.error("error on get ocr result")}}this.workflowModel[s].findIndex(t=>t.name===e.name)}this.$store.commit("hideLoadingBarSave"),this.uploadFileForControl(t,e,s)}}else this.uploadFileForControl(t,e,s)},async uploadFileForControl(t,e,s){if(this.fileUploadInput={files:t,control:e,fieldId:s},"STATIC"===this.repositoryDetails.fieldsType){if(this.fileUploadForControl=!1,this.customCheckUpload()){let t=this.formFields.find(t=>"Document No"===t.label);t&&(this.uploadFilename=this.workflowModel[t.value]+".pdf")}this.fileUploadForControl=!0,this.showMetaDataEditModal=!0}else this.uploadFilesFromForm(t,e,s)},async showHistoryStepper(t,e){console.log("called");const{error:s,payload:i}=await l["t"].processHistory(e,t);s?this.$alert.error(s):i.length&&(this.stageLevel=[],this.currentStep=0,i.forEach(t=>{if(2!==t.actionStatus)if(0===this.stageLevel.filter(e=>e.id===t.activityId).length)this.stageLevel.push({id:t.activityId,label:t.stage,status:t.status}),((t.actionUser||t.subWorkflowHistory)&&t.status&&"Forward"!==t.status||null===t.actionUser&&!t.subWorkflowHistory)&&(this.currentStep+=1);else if(t.status)this.stageLevel.filter(e=>e.id===t.activityId&&e.status!==t.status).length?this.currentStep+=1:this.currentStep-=1;else{let e=this.stageLevel.findIndex(e=>e.id===t.activityId);e>-1&&(this.stageLevel.splice(e,this.stageLevel.length-e),this.stageLevel.push({id:t.activityId,label:t.stage,status:t.status}),t.actionUser&&t.status&&"Forward"!==t.status||null===t.actionUser?this.currentStep=e+1:this.currentStep=e)}}))},attachmentCount(t){this.tabs.find(e=>{"ATTACHMENTS"===e.value&&(e.count=t)})},commentsCount(t){this.tabs.find(e=>{"COMMENTS"===e.value&&(e.count=t)})}}},q=N,R=(s("e98d"),s("5ab0"),s("2877")),z=s("58ea"),j=s("4e73"),V=s("b047"),U=s("cb32"),W=s("8169"),H=s("93dc"),J=s.n(H),G=Object(R["a"])(q,i,o,!1,null,"5b96b9ec",null);e["a"]=G.exports;J()(G,"components",{QCircularProgress:z["a"],QMenu:j["a"],QChip:V["a"],QAvatar:U["a"],QChatMessage:W["a"]})},4759:function(t,e,s){},"4a61":function(t,e,s){},"50ff":function(t,e,s){},5132:function(t,e,s){"use strict";var i=s("2250"),o=s("4dc8");function a(t,e){e=Object(i["a"])(e,t);var s=0,a=e.length;while(null!=t&&s<a)t=t[Object(o["a"])(e[s++])];return s&&s==a?t:void 0}e["a"]=a},"5ab0":function(t,e,s){"use strict";s("a945")},"5e23":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("Sheet",{attrs:{value:t.value,"no-padding":!0,"has-footer":"",width:"650px"},on:{input:function(e){return t.$emit("input",!1)}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Document Sharing By Email")]},proxy:!0},{key:"default",fn:function(){return[e("div",{attrs:{id:"document-sharing-details"}},[e("Tabs",{staticClass:"tabs",attrs:{tabs:t.tabs},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}}),e("BaseScrollbar",{attrs:{height:"calc(100vh - 170px)"}},[e("div",{staticClass:"q-pa-md"},[e("ValidationObserver",{ref:"form"},[e("div",{staticClass:"field-wrapper"},[e("ValidationProvider",{attrs:{name:"to",rules:{required:!0,email:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("MultiSelectField",{staticClass:"q-mb-sm",attrs:{label:"to","is-mandatory":"","new-option":"",error:s[0]},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})]}}])}),e("ValidationProvider",{attrs:{name:"subject",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("TextField",{staticClass:"q-mb-sm",attrs:{label:"subject","is-mandatory":"",error:s[0]},model:{value:t.subject,callback:function(e){t.subject=e},expression:"subject"}})]}}])}),"attach link"===t.tab?[e("div",{staticClass:"row"},[e("div",{staticClass:"col-6 q-pr-sm"},[e("ValidationProvider",{attrs:{name:"Expiry from Date",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("DateField",{staticClass:"q-mb-sm",attrs:{label:"Expiry from Date","is-mandatory":"",error:s[0],"minimum-validation":!0},model:{value:t.fromDate,callback:function(e){t.fromDate=e},expression:"fromDate"}})]}}],null,!1,714078504)})],1),e("div",{staticClass:"col-6 q-pl-sm"},[e("ValidationProvider",{attrs:{name:"Expiry to Date",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("DateField",{staticClass:"q-mb-sm",attrs:{label:"Expiry to Date","is-mandatory":"",error:s[0],"minimum-validation":!0},model:{value:t.toDate,callback:function(e){t.toDate=e},expression:"toDate"}})]}}],null,!1,738413864)})],1)])]:t._e(),t._l(t.fileList,(function(s){return[e("q-chip",{key:s.id,staticClass:"chips secondary-hover cursor-pointer",attrs:{outline:"",color:"secondary"}},[e("q-avatar",{attrs:{icon:"mdi-file",color:"secondary","text-color":"white"},on:{click:function(e){return t.remove(s.id)}}}),t._v(" "+t._s(s.name)+" "),e("q-avatar",{staticClass:"close-icon",attrs:{icon:"mdi-close","text-color":"red"},on:{click:function(e){return t.remove(s.id)}}})],1)]})),e("TextBuilderField",{model:{value:t.body,callback:function(e){t.body=e},expression:"body"}})],2)])],1)])],1)]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",label:"cancel"},on:{click:function(e){return t.$emit("input",!1)}}}),e("BaseButton",{attrs:{label:"send"},on:{click:t.documentShare}})]},proxy:!0}])})},o=[],a=(s("14d9"),s("7bb1")),r=s("381e"),n=s("b94d"),l=s("b3d1"),c=s("53c1"),d=s("c3d2"),h=s("695e"),m=s("1b0d"),u={name:"EmailSharing",components:{Sheet:r["a"],ValidationObserver:a["a"],ValidationProvider:a["b"],TextField:l["a"],Tabs:n["a"],DateField:c["a"],MultiSelectField:d["a"],TextBuilderField:h["a"]},props:{value:{type:Boolean,default:!1},repositoryId:{type:Number,default:0},fileList:{type:Array,default:()=>[]}},data(){return{tab:"attach file",tabs:[{id:this.$nano.id(),label:"attach file",value:"attach file"},{id:this.$nano.id(),label:"attach link",value:"attach link"}],email:[],subject:"",body:"",fromDate:"",toDate:"",minimumFromDate:""}},created(){const t=new Date,e=t.toISOString().split("T")[0];this.minimumFromDate=e},methods:{clearFields(){this.tab="attach file",this.email=[],this.subject="",this.body="",this.fromDate="",this.toDate=""},remove(t){if(this.fileList.length>1){let e=this.fileList.filter(e=>e.id!=t);this.$emit("update:fileList",e)}else this.$alert.warning("Minimum one document is required")},async documentShare(){const t=await this.$refs.form.validate();if(!t)return;let e=[];if(this.fileList.forEach(t=>{e.push(t.id)}),"attach file"===this.tab){let t={repositoryId:this.repositoryId,itemIds:e,toAdd:this.email.toString(),subject:this.subject,body:this.body};const{error:s}=await m["k"].documentShare(t);if(s)return void this.$alert.error(s)}else if("attach link"===this.tab){if(this.toDate<this.fromDate)return void this.$alert.warning("ToDate Is Must Be Greater Than Or Equal To FromDate");let t={toAddress:this.email.toString(),subject:this.subject,body:this.body,expiryFromDate:this.fromDate,expiryTodate:this.toDate,repositoryId:this.repositoryId,itemIdArray:e};const{error:s}=await m["k"].documentShareLink(t);if(s)return void this.$alert.error(s)}this.$alert.success("Initiated Document Sharing by Email"),this.clearFields(),this.$emit("input",!1)}}},f=u,p=(s("5fab"),s("2877")),v=s("b047"),y=s("cb32"),w=s("93dc"),g=s.n(w),b=Object(p["a"])(f,i,o,!1,null,"2c37c0ea",null);e["a"]=b.exports;g()(b,"components",{QChip:v["a"],QAvatar:y["a"]})},"5f3d":function(t,e,s){},"5fab":function(t,e,s){"use strict";s("467fa")},"651a":function(t,e,s){t.exports=s.p+"img/psg-logo.20670f47.png"},"670a":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"toggle"}},t._l(t.options,(function(s){return e("div",{key:s,staticClass:"option",class:{"is-selected":t.value===s},on:{click:function(e){return t.$emit("input",s)}}},[t._v(" "+t._s(s)+" ")])})),0)},o=[],a={name:"Toggle",props:{value:{type:String,required:!0},options:{type:Array,required:!0}}},r=a,n=(s("fa79"),s("2877")),l=Object(n["a"])(r,i,o,!1,null,"0e83c5c2",null);e["a"]=l.exports},"686b":function(t,e,s){},"742a":function(t,e,s){"use strict";s("ef04")},7794:function(t,e,s){"use strict";s("caad");var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{attrs:{id:"repository-field"}},[t.showFreeze?e("div",{attrs:{id:"checkbox-field"}},[e("BaseIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Freeze",expression:"'Freeze'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{name:t.freezed?"eva-checkmark-circle-2":"eva-radio-button-off-outline",color:"secondary"},on:{click:t.handleFreeze},model:{value:t.freezed,callback:function(e){t.freezed=e},expression:"freezed"}})],1):t._e(),"SHORT_TEXT"===t.field.dataType||"BARCODE"===t.field.dataType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("TextField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,error:s[0],"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,2138129544)}):t._e(),"NUMBER"===t.field.dataType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory,integer:!t.field.options.allowDecimals}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("NumberField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,error:s[0],"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,3272965974)}):t._e(),"DATE"===t.field.dataType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("DateField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,error:s[0],"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,2736912833)}):t._e(),"TIME"===t.field.dataType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("TimeField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,error:s[0],"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,2195704480)}):t._e(),"DATE_TIME"===t.field.dataType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("DateTimeField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,error:s[0],"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,1802324180)}):t._e(),"SINGLE_SELECT"===t.field.dataType&&["EXISTING"].includes(t.field.options.optionsType)?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("AsyncSelectField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,"api-path":t.apiPath,error:s[0],"new-option":t.field.options.allowToAddNewOptions,"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,364407705)}):t._e(),"SINGLE_SELECT"===t.field.dataType&&"PREDEFINED"===t.field.options.optionsType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("SelectField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,error:s[0],"new-option":t.field.options.allowToAddNewOptions,options:t.predefinedSelectOptions,"is-readonly":t.readOnly,page:"repository"},on:{input:t.handleInput}})]}}],null,!1,3382750843)}):t._e(),"SINGLE_SELECT"===t.field.dataType&&["MASTER"].includes(t.field.options.optionsType)?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("SelectField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,error:s[0],"new-option":t.field.options.allowToAddNewOptions,options:t.options,"is-readonly":t.readOnly,page:"repository"},on:{input:t.handleInput}})]}}],null,!1,768311157)}):t._e(),"BOOLEAN"===t.field.dataType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("SingleChoiceField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,options:t.booleanOptions,error:s[0],"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,61245750)}):t._e(),"OMR"===t.field.dataType?e("ValidationProvider",{staticClass:"full-width",attrs:{name:t.field.name,rules:{required:t.field.isMandatory}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("SingleChoiceField",{attrs:{value:t.value,"is-mandatory":t.field.isMandatory,label:t.label||t.field.name,options:t.omrOptions,error:s[0],"is-readonly":t.readOnly},on:{input:t.handleInput}})]}}],null,!1,1875132930)}):t._e()],1),e("div",{staticClass:"row items-center justify-center q-mt-sm"},[t.visiableSyncBtn?e("BaseButton",{attrs:{label:"Sync",color:"secondary"},on:{click:function(e){return t.$emit("saveSync",t.field)}}}):t._e()],1)])},o=[],a=s("7bb1"),r=s("b3d1"),n=s("ad54"),l=s("53c1"),c=s("cedb"),d=s("d1e5"),h=s("12b8"),m=s("0c21"),u=s("9234"),f=s("0d5e"),p={name:"RepositoryField",components:{ValidationProvider:a["b"],TextField:r["a"],NumberField:n["a"],DateField:l["a"],TimeField:c["a"],DateTimeField:d["a"],SelectField:h["a"],AsyncSelectField:m["a"],SingleChoiceField:u["a"]},props:{field:{type:Object,required:!0},repositoryId:{type:[String,Number],required:!0},value:{type:[String,Number],required:!0},readOnly:{type:Boolean,default:!1},label:{type:String,default:""},syncField:{type:Object,default:()=>{}},parentControl:{type:Boolean,default:!1},rowIndex:{type:Number,required:!0},filter:{type:Boolean,default:!1},freezedData:{type:Object,default:()=>{}},showFreeze:{type:Boolean,default:!1}},data(){return{booleanOptions:[{id:this.$nano.id(),label:this.field.options.truthyValue,value:this.field.options.truthyValue},{id:this.$nano.id(),label:this.field.options.falsyValue,value:this.field.options.falsyValue}],omrOptions:[{id:this.$nano.id(),label:"Yes",value:"true"},{id:this.$nano.id(),label:"No",value:"false"}],visiableSyncBtn:!1,options:[],freeze:!1,freezeData:this.freezedData,freezed:!1}},computed:{predefinedSelectOptions(){return this.field.options.predefinedOptions.map(t=>({id:this.$nano.id(),label:t,value:t}))},apiPath(){return`/repository/${this.repositoryId}/uniqueColumnValues`}},watch:{field:{immediate:!0,async handler(){for(let t in this.syncField)this.syncField[t]===this.field.name&&(this.visiableSyncBtn=!0)}},filter:{immediate:!0,deep:!0,handler(){this.field.filterBy&&this.field.options.masterFormId&&this.getMasterEntriesFilter(this.field)}}},created(){this.freezedData&&(this.freezed=this.field.name in this.freezedData),this.field.options.masterFormId&&this.getMasterEntries(this.field.options.masterFormId,this.field.options.masterTableColumn)},methods:{handleInput(t){this.$emit("input",t),this.parentControl&&this.$emit("filterBy",this.field,this.rowIndex),this.freezed&&this.updateOrAddField(this.field.name,t)},handleFreeze(){this.freezed=!this.freezed,this.freezed?(this.updateOrAddField(this.field.name,this.value),this.$emit("update:freezed",this.freeze)):this.$emit("update:removeFreezed",this.field.name)},updateOrAddField(t,e){t in this.freezeData?this.freezeData[t]=e:this.freezeData={...this.freezeData,[t]:e},this.$emit("update:freezedData",this.freezeData)},async getMasterEntries(t,e){try{const s=await f["b"].post(`/form/${t}/uniqueColumnValues`,JSON.stringify({column:e,keyword:"",rowFrom:0,rowCount:0})),{status:i,data:o}=s;if(200!==i)throw s;const a=JSON.parse(o);a.length&&(this.options=a.map(t=>({id:this.$nano.id(),label:t,value:t})))}catch(s){console.error(s),this.$alert.error("Error fetching options")}},async getMasterEntriesFilter(t){try{const e=await f["b"].post(`/form/${t.options.masterFormId}/uniqueColumnValues`,JSON.stringify({column:t.options.masterTableColumn,keyword:"",rowFrom:0,rowCount:0,filters:t.filterBy})),{status:s,data:i}=e;if(200!==s)throw e;const o=JSON.parse(i);o.length?(this.options=o.map(t=>({id:this.$nano.id(),label:t,value:t})),1===this.options.length&&this.handleInput(this.options[0].value)):(this.field.options.masterFormId&&this.getMasterEntries(this.field.options.masterFormId,this.field.options.masterTableColumn),this.handleInput(""))}catch(e){console.error(e),this.$alert.error("Error fetching options")}}}},v=p,y=(s("87dc"),s("2877")),w=Object(y["a"])(v,i,o,!1,null,"174d3602",null);e["a"]=w.exports},8169:function(t,e,s){"use strict";s("14d9");var i=s("a026"),o=s("87e8");e["a"]=i["default"].extend({name:"QChatMessage",mixins:[o["a"]],props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelSanitize:Boolean,nameSanitize:Boolean,textSanitize:Boolean,stampSanitize:Boolean},computed:{textClass(){return"q-message-text-content q-message-text-content--"+this.op+(void 0!==this.textColor?" text-"+this.textColor:"")},messageClass(){return"q-message-text q-message-text--"+this.op+(void 0!==this.bgColor?" text-"+this.bgColor:"")},containerClass(){return"q-message-container row items-end no-wrap"+(!0===this.sent?" reverse":"")},sizeClass(){if(void 0!==this.size)return"col-"+this.size},op(){return!0===this.sent?"sent":"received"}},methods:{__wrapStamp(t,e){if(void 0!==this.$scopedSlots.stamp)return[e,t("div",{staticClass:"q-message-stamp"},this.$scopedSlots.stamp())];if(this.stamp){const s=!0===this.stampSanitize?"textContent":"innerHTML";return[e,t("div",{staticClass:"q-message-stamp",domProps:{[s]:this.stamp}})]}return[e]},__getText(t,e,s){const i=!0===this.textSanitize?"textContent":"innerHTML";if(!0===s&&!0===e.some(t=>void 0===t.tag&&void 0!==t.text))return[t("div",{class:this.messageClass},[t("div",{class:this.textClass},this.__wrapStamp(t,t("div",e)))])];const o=!0!==s?e=>t("div",{domProps:{[i]:e}}):e.length>1?t=>t:e=>t("div",[e]);return e.map((e,s)=>t("div",{key:s,class:this.messageClass},[t("div",{class:this.textClass},this.__wrapStamp(t,o(e)))]))}},render(t){const e=[];void 0!==this.$scopedSlots.avatar?e.push(this.$scopedSlots.avatar()):void 0!==this.avatar&&e.push(t("img",{class:"q-message-avatar q-message-avatar--"+this.op,attrs:{src:this.avatar,"aria-hidden":"true"}}));const s=[];void 0!==this.$scopedSlots.name?s.push(t("div",{class:"q-message-name q-message-name--"+this.op},this.$scopedSlots.name())):void 0!==this.name&&s.push(t("div",{class:"q-message-name q-message-name--"+this.op,domProps:{[!0===this.nameSanitize?"textContent":"innerHTML"]:this.name}})),void 0!==this.text&&s.push(this.__getText(t,this.text)),void 0!==this.$scopedSlots.default&&s.push(this.__getText(t,this.$scopedSlots.default(),!0)),e.push(t("div",{class:this.sizeClass},s));const i=[];return void 0!==this.$scopedSlots.label?i.push(t("div",{staticClass:"q-message-label"},this.$scopedSlots.label())):void 0!==this.label&&i.push(t("div",{staticClass:"q-message-label",domProps:{[!0===this.labelSanitize?"textContent":"innerHTML"]:this.label}})),i.push(t("div",{class:this.containerClass},e)),t("div",{class:"q-message q-message-"+this.op,on:{...this.qListeners}},i)}})},8505:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("Modal",{attrs:{width:t.externalAccess?"100vw":"70vw","external-access":t.externalAccess},on:{input:t.closeModal},scopedSlots:t._u([{key:"title",fn:function(){return[t._v('"'+t._s(t.historyTitle)+'" Process History')]},proxy:!0},{key:"action",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Export",expression:"'Export'",modifiers:{top:!0}}],attrs:{"is-flat":"","no-border":"",icon:"mdi-table-arrow-right"},on:{click:t.export_Data}})]},proxy:!0},{key:"default",fn:function(){return[e("div",{attrs:{id:"processHistory"}},[e("div",{staticClass:"col-12 q-mb-md q-pt-sm"},[e("Stepper",{attrs:{"stage-level":t.stageLevel,"current-step":t.currentStep}})],1),e("table",{attrs:{id:"history"}},[e("thead",[e("tr",t._l(t.columns,(function(s){return e("th",{key:s.id},[t._v(" "+t._s(s.label)+" ")])})),0)]),e("tbody",[t._l(t.processHistoryData,(function(s){return[e("tr",{key:s.id},t._l(t.columns,(function(i){return e("td",{key:i.id,staticClass:"ellipsis"},[t._t(i.name,(function(){return["DATE"===i.type?[t._v(" "+t._s(t.$day.format(s[i.name])||"-")+" ")]:"stage"===i.name?[t._v(" "+t._s(s[i.name]||"-")+" "),s.subWorkflowHistory?[s.subWorkflowHistory.length?[e("span",{staticClass:"text-secondary"},[t._v(" [CONNECTOR] ")])]:t._e()]:t._e()]:[t._v(" "+t._s(s[i.name]||"-")+" ")]]}),{value:s[i.name],item:s})],2)})),0),s.comments.length?e("tr",{key:s.id,on:{click:function(t){s.showComments=!s.showComments}}},[e("td",{staticClass:"comments",attrs:{colspan:"6"}},[e("BaseIcon",{attrs:{name:s.showComments?"eva-arrow-downward-outline":"eva-arrow-forward-outline",color:"primary"}}),t._v(" Comments ("+t._s(s.comments.length)+") ")],1)]):t._e(),s.comments.length&&s.showComments?e("tr",{key:s.id},[e("td",{attrs:{colspan:"6"}},[e("table",{attrs:{id:"comments1"}},[e("thead",[e("tr",[e("th",{staticClass:"large"},[t._v("Comments")]),e("th",{staticClass:"medium"},[t._v("Commented By")]),e("th",{staticClass:"medium"},[t._v("Commented On")]),e("th",{staticClass:"medium"},[t._v("Attached In")])])]),e("tbody",[t._l(s.comments,(function(s,i){return[e("tr",{key:i},[e("td",{staticClass:"commentsText ellipsis"},[t._v(" "+t._s(t.removeTags(s.comments)||"-")+" ")]),e("td",{staticClass:"ellipsis"},[t._v(" "+t._s(s.createdByEmail||"-")+" ")]),e("td",{staticClass:"ellipsis"},[t._v(" "+t._s(t.$day.format(s.createdAt)||"-")+" ")]),e("td",[s.embedFileList&&s.embedFileList.length?[e("div",{staticClass:"file-icons",on:{click:function(e){return t.openFileByCmd(s.embedFileList[0])}}},[e("FileIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:s.embedFileList[0].fileName,expression:"\n                                    comment.embedFileList[0].fileName\n                                  ",modifiers:{top:!0}}],key:"Icon-"+i,staticClass:"file-icon q-mr-sm",attrs:{"mime-type":t.fileType(s.embedFileList[0].fileName)}}),e("a",{staticClass:"file-link",attrs:{href:"javascript:void(0)"},on:{click:function(t){t.preventDefault()}}},[t._v(t._s(s.embedFileList[0].fileName||"-"))])],1)]:[t._v(" "+t._s("-")+" ")]],2)])]}))],2)])])]):t._e(),s.attachments.length?e("tr",{key:s.id},[e("td",{staticClass:"attachments",attrs:{colspan:"6"},on:{click:function(t){s.showAttachments=!s.showAttachments}}},[e("BaseIcon",{attrs:{name:s.showAttachments?"eva-arrow-downward-outline":"eva-arrow-forward-outline",color:"primary"}}),t._v(" Attachments ("+t._s(s.attachments.length)+") ")],1)]):t._e(),s.attachments.length&&s.showAttachments?e("tr",{key:s.id},[e("td",{attrs:{colspan:"6"}},[e("table",{attrs:{id:"attachments"}},[e("thead",[e("tr",[e("th",[t._v("File Name")]),e("th",[t._v("Attached By")]),e("th",[t._v("Attached On")])])]),e("tbody",[t._l(s.attachments,(function(s,i){return[e("tr",{key:i},[e("td",[t._v(t._s(s.name||"-"))]),e("td",[t._v(t._s(s.createdByEmail||"-"))]),e("td",[t._v(" "+t._s(t.$day.format(s.createdAt)||"-")+" ")])])]}))],2)])])]):t._e(),s.subWorkflowHistory?[s.subWorkflowHistory.length?e("tr",{key:s.id},[e("td",{staticClass:"attachments",attrs:{colspan:"6"},on:{click:function(t){s.showSubWorkflowHistory=!s.showSubWorkflowHistory}}},[e("BaseIcon",{attrs:{name:s.showSubWorkflowHistory?"eva-arrow-downward-outline":"eva-arrow-forward-outline",color:"primary"}}),1===s.actionStatus?[e("BaseIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Completed",expression:"'Completed'",modifiers:{top:!0}}],staticClass:"q-ml-xs q-mr-xs",attrs:{name:"mdi-progress-check",color:"green"}})]:0===s.actionStatus?[e("BaseIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"In-progress",expression:"'In-progress'",modifiers:{top:!0}}],staticClass:"q-ml-xs q-mr-xs",attrs:{name:"mdi-progress-clock",color:"orange"}})]:t._e(),t._v(" "+t._s(s.subWorkflowHistory[0].requestNo)+" ")],2)]):t._e(),s.showSubWorkflowHistory?e("tr",{key:s.id},[e("td",{attrs:{colspan:"6"}},[e("table",{attrs:{id:"attachments"}},[e("thead",t._l(t.columns,(function(s){return e("th",{key:s.id},[t._v(" "+t._s(s.label)+" ")])})),0),e("tbody",[t._l(s.subWorkflowHistory,(function(s){return[e("tr",{key:s.id},t._l(t.columns,(function(i){return e("td",{key:i.id,staticClass:"ellipsis"},[t._t(i.name,(function(){return["DATE"===i.type?[t._v(" "+t._s(t.$day.format(s[i.name])||"-")+" ")]:[t._v(" "+t._s(s[i.name]||"-")+" ")]]}),{value:s[i.name],item:s})],2)})),0)]}))],2)])])]):t._e()]:t._e()]}))],2)])])]},proxy:!0}],null,!0),model:{value:t.processHistoryModal,callback:function(e){t.processHistoryModal=e},expression:"processHistoryModal"}}),e("Sheet",{attrs:{"no-padding":"",width:"100vw"},on:{input:function(e){t.fileSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"attachmentFileHeader"},[e("div",{staticClass:"avatar q-ml-sm"},[e("FileIcon",{attrs:{"mime-type":t.fileType(t.selectedFile.name)}})],1),e("div",{staticClass:"q-ml-md"},[e("div",{staticClass:"filename"},[t._v(" "+t._s(t.selectedFile.name)+" ")]),e("div",{staticClass:"meta"},[e("div",[t._v(" Archived At: "+t._s(t.$day.format(t.selectedFiles[0].createdAt))+" ")]),e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v("Archived By: "+t._s(t.selectedFiles[0].createdByEmail))]),t.selectedFiles[0].size?e("div",[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),t._v(" File Size: "+t._s(t.fileSize(t.selectedFiles[0].size))+" ")],1):t._e()],1)])])]},proxy:!0}]),model:{value:t.fileSheet,callback:function(e){t.fileSheet=e},expression:"fileSheet"}},[e("div",{staticClass:"attachmentFileFrame"},[e("div",{staticClass:"file-list"},[e("iframe",{ref:"myAttachmentFiles",attrs:{id:"file-frame",src:t.fileLink(),frameborder:"0"}})])])])],1)},o=[],a=(s("14d9"),s("1b0d")),r=s("6a70"),n=s("0006"),l=s("fa1f"),c=s("381e"),d=s("dd90"),h=s("a7d2"),m=s("42fc"),u={name:"ProcessHistory",components:{Modal:r["a"],Stepper:n["a"],Sheet:c["a"],FileIcon:l["a"]},props:{processId:{type:Number,required:!0},selectedProcess:{type:Object,default:()=>{}},externalAccess:{type:Boolean,default:!1}},data(){return{historyTitle:"",processHistoryData:[],processHistoryModal:!1,columns:[{id:this.$nano.id(),name:"stage",label:"STAGE",type:"SHORT_TEXT"},{id:this.$nano.id(),name:"actionUser",label:"ACTION USER",type:"SHORT_TEXT"},{id:this.$nano.id(),name:"receivedOn",label:"RECEIVED ON",type:"DATE"},{id:this.$nano.id(),name:"processedBy",label:"PROCESSED BY",type:"SHORT_TEXT"},{id:this.$nano.id(),name:"processedOn",label:"PROCESSED ON",type:"DATE"},{id:this.$nano.id(),name:"status",label:"STATUS",type:"SHORT_TEXT"}],stageLevel:[],currentStep:0,selectedFile:{},fileSheet:!1,selectedFiles:[]}},watch:{processId:{immediate:!0,handler(){this.processId&&this.showHistory(this.processId)}}},methods:{async showHistory(t){this.processHistoryModal=!0,this.processHistoryData=[],this.historyTitle=this.selectedProcess.requestNo,this.$store.commit("showLoadingBarSave");const{error:e,payload:s}=await a["t"].processHistory(this.selectedProcess.id,t);this.$store.commit("hideLoadingBarSave"),e?this.$alert.error(e):s.length&&(s.forEach(t=>{this.processHistoryData.push({...t,showComments:!1,showAttachments:!1,showSubWorkflowHistory:!1})}),this.stageLevel=[],this.currentStep=0,s.forEach(t=>{if(2!==t.actionStatus)if(0===this.stageLevel.filter(e=>e.id===t.activityId).length)this.stageLevel.push({id:t.activityId,label:t.stage,status:t.status}),((t.actionUser||t.subWorkflowHistory)&&t.status&&"Forward"!==t.status||null===t.actionUser&&!t.subWorkflowHistory)&&(this.currentStep+=1);else if(t.status)this.stageLevel.filter(e=>e.id===t.activityId&&e.status!==t.status).length?this.currentStep+=1:this.currentStep-=1;else{let e=this.stageLevel.findIndex(e=>e.id===t.activityId);e>-1&&(this.stageLevel.splice(e,this.stageLevel.length-e),this.stageLevel.push({id:t.activityId,label:t.stage,status:t.status}),t.actionUser&&t.status&&"Forward"!==t.status||null===t.actionUser?this.currentStep=e+1:this.currentStep=e)}}))},openFileByCmd(t){const e=t,{fileName:s,itemid:i,...o}=e;this.selectedFile={name:s,id:i,...o};const a=this.processHistoryData.map(t=>t.attachments).flat();this.selectedFiles=a.filter(t=>t.id==this.selectedFile.id&&t.name==this.selectedFile.name),this.openFile(this.selectedFile)},fileSize(t){return Object(h["a"])(t)},fileLink(){let t=location.origin.replace("http://localhost:8080","http://52.172.32.88");if(this.selectedFile.name){let e=this.selectedFile.name.split(".").pop();if(this.selectedFile.initiate){let s=1;return"STATIC"===this.repositoryDetails.fieldsType&&"FORM"===this.workflow.initiatedBy&&(s=2),Object(d["d"])(e)?"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?`https://ag-appsvc04.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=${s}`:"https://trial.ezofis.com"===t?`https://trial.ezofis.com/docsviewer/index.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=${s}`:"https://app.ezofis.com"===t?`https://ezdocsviewer.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=${s}`:`${t}/PDFViewer/web/viewer.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=${s}`:"http://52.172.32.88"===t?`http://52.172.32.88/DocsViewer/index.html?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=${s}`:`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/${s}`}return Object(d["d"])(e)?"https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t?`https://ag-appsvc04.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.selectedProcess.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}`:"https://trial.ezofis.com"!==t||Object(d["c"])(e)?"https://app.ezofis.com"===t?`https://ezdocsviewer.azurewebsites.net/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.selectedProcess.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}`:`${t}/PDFViewer/web/viewer.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.selectedProcess.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}`:`https://trial.ezofis.com/docsviewer/index.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.selectedProcess.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}`:Object(d["b"])(e)||"http://52.172.32.88"!==t?`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`:`http://52.172.32.88/DocsViewer/index.html?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.selectedProcess.id}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}`}},openFile(t){if(t.loading)this.$alert.info("Please wait to complete the uploading");else{this.selectedFile=t;let e=location.origin;"https://ag-appsvc01.azurewebsites.net"===e||"https://ag-appsvc05.azurewebsites.net"===e?window.open(this.fileLink()):this.fileSheet=!0}},fileType(t){if(t)return t.split(".").reverse()[0].slice(0,4)},closeModal(){this.processHistoryModal=!1,this.$emit("close")},removeTags(t){return t?t.replace(/(<([^>]+)>)/gi,""):""},export_Data1(){let t=[];this.processHistoryData.forEach(e=>{t.push({Stage:e.stage,"Action User":e.actionUser,"Received On":this.$day.format(e.receivedOn),"Processed On":this.$day.format(e.processedOn),"Processed By":e.processedBy,Status:e.status})}),Object(m["a"])(t,this.historyTitle+" - Process History")},export_Data(){let t=[];this.processHistoryData.forEach(e=>{if(t.push({Stage:e.stage,"Action User":e.actionUser||"","Received On":this.$day.format(e.receivedOn)||"","Processed On":this.$day.format(e.processedOn)||"","Processed By":e.processedBy||"",Status:e.status||""}),e.comments&&e.comments.length){let s;t.push({Stage:`<span style="color: #00BCD4;font-weight: bold;">Comments(${e.comments.length})</span>`}),t.push({Stage:"<strong>Comments<strong>","Action User":"<strong>Commented By<strong>","Received On":"<strong>Commented On<strong>","Processed On":"<strong>Attached In<strong>"}),e.comments.forEach(e=>{e.embedFileList&&e.embedFileList.length&&e.embedFileList.forEach(t=>{s=t.fileName}),t.push({Stage:`<span style="color: #00BCD4;">${e.comments||""}</span>`,"Action User":`<span style="color: #00BCD4;">${e.createdByEmail||""}</span>`,"Received On":`<span style="color: #00BCD4;">${this.$day.format(e.createdAt)||""}</span>`,"Processed On":`<span style="color: #00BCD4;">${s||""}</span>`})})}e.attachments&&e.attachments.length&&(t.push({Stage:`<span style="color: #643094;font-weight: bold;">Attachment(${e.attachments.length})</span>`}),t.push({Stage:"<strong>File Name<strong>","Action User":"<strong>\tAttached By<strong>","Received On":"<strong>Attached On<strong>"}),e.attachments.forEach(e=>{t.push({Stage:`<span style="color: #643094; border: 12px solid#50067e;">${e.name||""}</span>`,"Action User":`<span style="color: #643094;">${e.createdByEmail||""}</span>`,"Received On":`<span style="color: #643094;">${this.$day.format(e.createdAt)||""}</span>`})})),e.subWorkflowHistory&&e.subWorkflowHistory.length&&(t.push({Stage:`<span style="color: #e97f06;font-weight: bold;">${e.subWorkflowHistory[0].requestNo}[Connector]<span>`}),t.push({Stage:"<strong>Stage</strong>","Action User":"<strong>Action User</strong>","Received On":"<strong>Received On</strong>","Processed On":"<strong>Processed On</strong>","Processed By":"<strong>Processed By</strong>",Status:"<strong>status</strong>"}),e.subWorkflowHistory.forEach(e=>{t.push({Stage:`<span style="color: #e97f06;">${e.stage}</span>`,"Action User":`<span style="color: #e97f06;border:2px solid black">${e.actionUser||""}</span>`,"Received On":`<span style="color: #e97f06;">${this.$day.format(e.receivedOn)||""}</span>`,"Processed On":`<span style="color: #e97f06;">${this.$day.format(e.processedOn)||""}</span>`,"Processed By":`<span style="color: #e97f06;">${e.processedBy||""}</span>`,Status:`<span style="color: #e97f06;">${e.status||""}</span>`})}))}),Object(m["a"])(t,this.historyTitle+" Report")}}},f=u,p=(s("bf55"),s("2877")),v=s("4e73"),y=s("93dc"),w=s.n(y),g=Object(p["a"])(f,i,o,!1,null,"2443da3d",null);e["a"]=g.exports;w()(g,"components",{QMenu:v["a"]})},"874f":function(t,e,s){"use strict";var i=s("7c4a"),o=s("0e40"),a=Object(i["a"])((function(t,e,s){return t+(s?" ":"")+Object(o["a"])(e)}));e["a"]=a},"87dc":function(t,e,s){"use strict";s("5f3d")},"8b55":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",t._g({class:{active:t.isActive,"is-full-width":t.isFullWidth},style:{color:t.isActive?t._color:""},attrs:{id:"tab"}},t.$listeners),[t._v(" "+t._s(t.label)+" ")])},o=[],a={name:"Tab",props:{label:{type:String,required:!0},isActive:{type:Boolean,default:!1},isFullWidth:{type:Boolean,default:!1},color:{type:String,default:"primary"}},computed:{_color(){return`var(--${this.color})`}}},r=a,n=(s("2ac6"),s("2877")),l=Object(n["a"])(r,i,o,!1,null,"f3c4783e",null);e["a"]=l.exports},"91dd":function(t,e,s){},"94f5":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",t._g({attrs:{id:"action"}},t.$listeners),[e("BaseIcon",{attrs:{name:t.icon,"inherit-color":""}}),e("div",{staticClass:"label"},[t._v(t._s(t.label))])],1)},o=[],a={name:"Action",props:{icon:{type:String,required:!0},label:{type:String,default:""}}},r=a,n=(s("a116"),s("2877")),l=Object(n["a"])(r,i,o,!1,null,"1619714d",null);e["a"]=l.exports},"970a":function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));const i={CONTAINS:"CONTAINS",IS_EQUALS_TO:"IS_EQUALS_TO (=)",IS_NOT_EQUALS_TO:"IS_NOT_EQUALS_TO (!=)",IS_GREATER_THAN:"IS_GREATER_THAN (>)",IS_GREATER_THAN_OR_EQUALS_TO:"IS_GREATER_THAN_OR_EQUALS_TO (>=)",IS_LESSER_THAN:"IS_LESSER_THAN (<)",IS_LESSER_THAN_OR_EQUALS_TO:"IS_LESSER_THAN_OR_EQUALS_TO (<=)",IS_EMPTY:"IS_EMPTY ({})",IS_NOT_EMPTY:"IS_NOT_EMPTY (!{})",IS_ANY_OF:"IS_ANY_OF",IS_NOT_ANY_OF:"IS_NOT_ANY_OF",NOT_CONTAINS:"NOT_CONTAINS",STARTS_WITH:"STARTS_WITH",NOT_STARTS_WITH:"NOT_STARTS_WITH",ENDS_WITH:"ENDS_WITH",NOT_ENDS_WITH:"NOT_ENDS_WITH"};Object.freeze(i);var o=i,a=s("381b");function r(t){switch(t){case a["a"].NUMBER:case a["a"].DATE:case a["a"].TIME:case a["a"].DATE_TIME:case a["a"].COUNTER:case a["a"].CALCULATED:return[o.IS_EQUALS_TO,o.IS_NOT_EQUALS_TO,o.IS_GREATER_THAN,o.IS_GREATER_THAN_OR_EQUALS_TO,o.IS_LESSER_THAN,o.IS_LESSER_THAN_OR_EQUALS_TO,o.IS_EMPTY,o.IS_NOT_EMPTY,o.IS_ANY_OF,o.IS_NOT_ANY_OF,o.STARTS_WITH,o.NOT_STARTS_WITH,o.ENDS_WITH,o.NOT_ENDS_WITH];case a["a"].SHORT_TEXT:case a["a"].LONG_TEXT:case a["a"].TABLE:return[o.CONTAINS,o.IS_EQUALS_TO,o.IS_NOT_EQUALS_TO,o.IS_EMPTY,o.IS_NOT_EMPTY,o.IS_ANY_OF,o.IS_NOT_ANY_OF,o.NOT_CONTAINS,o.STARTS_WITH,o.NOT_STARTS_WITH,o.ENDS_WITH,o.NOT_ENDS_WITH];case a["a"].SINGLE_SELECT:case a["a"].MULTI_SELECT:case a["a"].MULTIPLE_CHOICE:return[o.CONTAINS,o.IS_EMPTY,o.IS_NOT_EMPTY,o.IS_EQUALS_TO,o.IS_NOT_EQUALS_TO,o.IS_ANY_OF,o.IS_NOT_ANY_OF];default:return[o.IS_EMPTY,o.IS_NOT_EMPTY,o.IS_EQUALS_TO,o.IS_NOT_EQUALS_TO]}}},"99c8":function(t,e,s){t.exports=s.p+"img/hovr.ee5c0608.png"},"9baa":function(t,e,s){},"9bc4":function(t,e,s){"use strict";var i=s("b703"),o=s("09f4"),a=s("1549"),r=s("2250"),n=s("f842"),l=s("e8b2");function c(t){return Object(l["a"])(t)?void 0:t}var d=c,h=s("b4f1"),m=s("ca54"),u=s("f5fe"),f=s("ff51"),p=m["a"]?m["a"].isConcatSpreadable:void 0;function v(t){return Object(f["a"])(t)||Object(u["a"])(t)||!!(p&&t&&t[p])}var y=v;function w(t,e,s,i,o){var a=-1,r=t.length;s||(s=y),o||(o=[]);while(++a<r){var n=t[a];e>0&&s(n)?e>1?w(n,e-1,s,i,o):Object(h["a"])(o,n):i||(o[o.length]=n)}return o}var g=w;function b(t){var e=null==t?0:t.length;return e?g(t,1):[]}var k=b,I=s("500e"),C=s("c619");function S(t){return Object(C["a"])(Object(I["a"])(t,void 0,k),t+"")}var _=S,T=s("4e71"),A=1,F=2,L=4,x=_((function(t,e){var s={};if(null==t)return s;var l=!1;e=Object(i["a"])(e,(function(e){return e=Object(r["a"])(e,t),l||(l=e.length>1),e})),Object(n["a"])(t,Object(T["a"])(t),s),l&&(s=Object(o["a"])(s,A|F|L,d));var c=e.length;while(c--)Object(a["a"])(s,e[c]);return s}));e["a"]=x},"9bef":function(t,e,s){"use strict";s("3256")},a116:function(t,e,s){"use strict";s("f6de")},a4c9:function(t,e,s){"use strict";s("91dd")},a809:function(t,e,s){"use strict";function i(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}e["a"]=i},a945:function(t,e,s){},abe1:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("Sheet",{attrs:{value:t.value,width:"40vw"},on:{input:function(e){return t.$emit("input",!1)}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Metadata ")]},proxy:!0}])},[e("div",{attrs:{id:"file-details"}},[e("div",{attrs:{id:"item-overview"}},[e("table",[e("tbody",t._l(t.fileData,(function(s){return e("tr",{key:s.name,staticClass:"tableRow"},[e("td",{staticClass:"label"},[t._v(t._s(s.name))]),"TABLE"!==s.type?e("td",{staticClass:"value"},[t._t(s.name,(function(){return[t._v(" "+t._s(s.value||"-")+" ")]}),{value:s.value})],2):e("td",{staticClass:"value",staticStyle:{padding:"8px"}},[t._t(s.name,(function(){return[s.value?[e("BaseActionButton",{attrs:{icon:"mdi-table","is-flat":"","no-border":""},on:{click:function(e){return t.showTable(s.name)}}})]:[e("BaseActionButton",{attrs:{icon:"mdi-table","is-flat":"","no-border":"","is-disabled":""}})]]}))],2)])})),0)])]),e("Modal",{attrs:{width:"60vw",height:"80vh"},on:{input:function(e){t.expandTableModal=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(t._s(t.tableHeader))]},proxy:!0},{key:"default",fn:function(){return[e("div",{attrs:{id:"tableData"}},[t.tableData.cellvalues?[e("table",t._l(t.tableData.cellvalues,(function(s,i){return e("tr",{key:i},t._l(s,(function(s){return e("NoHeader"===s.kind?"td":"th",{key:`r${i}_c${s.columnindex}`,tag:"th"},[t._v(" "+t._s(s.cellvalue)+" ")])})),1)})),0)]:[e("table",[e("thead",[e("tr",t._l(t.tableData[0],(function(s,i){return e("th",{key:i},[t._v(" "+t._s(i)+" ")])})),0)]),e("tbody",t._l(t.tableData,(function(s,i){return e("tr",{key:i},t._l(s,(function(s,i){return e("td",{key:i},[t._v(" "+t._s(s)+" ")])})),0)})),0)])]],2)]},proxy:!0}]),model:{value:t.expandTableModal,callback:function(e){t.expandTableModal=e},expression:"expandTableModal"}})],1)])},o=[],a=s("381e"),r=s("6a70"),n={name:"FileDetails",components:{Sheet:a["a"],Modal:r["a"]},props:{value:{type:Boolean,required:!0},fileData:{type:Array,required:!0}},data(){return{expandTableModal:!1,tableHeader:"",tableData:[]}},methods:{showTable(t){this.expandTableModal=!0;let e=this.fileData.filter(e=>e.name===t);console.log(e),this.tableHeader=e[0].name,this.tableData=JSON.parse(e[0].value),console.log(this.tableData)}}},l=n,c=(s("4045"),s("2877")),d=Object(c["a"])(l,i,o,!1,null,"65baddda",null);e["a"]=d.exports},afaa:function(t,e,s){t.exports=s.p+"img/sobha-logo.5f37df97.png"},b0ba:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("Sheet",{attrs:{width:"50vw","no-padding":""},on:{input:t.closeFormHistorySheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Form Entry History ")]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getFormHistory()}}})]},proxy:!0}]),model:{value:t.formHistorySheet,callback:function(e){t.formHistorySheet=e},expression:"formHistorySheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"\n          calc(100vh - 200px)\n        "}},[e("div",{attrs:{id:"history"}},[t.history.length?t._l(t.history,(function(s){return e("div",{key:s.id,staticClass:"entry"},[e("div",{staticClass:"header"},[t._v(" "+t._s(s.changes.length)+" "+t._s(s.changes.length>1?"Changes":"Change")+" ")]),e("div",{staticClass:"content"},[e("div",{staticClass:"changes-meta"},[e("div",[t._v(t._s(s.changedBy))]),e("BaseIcon",{staticClass:"q-mx-xs",attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(s.changedAt))])],1),t._l(s.changes,(function(s,i){return e("div",{key:i+1,staticClass:"change"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:"mdi-circle-small"}}),"isDeleted"===s.name?e("div",[Number(s.newValue)?e("span",{staticClass:"font-semibold"},[t._v(' "Deleted" ')]):e("span",{staticClass:"font-semibold"},[t._v('"Restored"')]),t._v(" the item ")]):s.oldValue?e("div",[t._v(" Modified "+t._s(s.name)+" from "),e("span",{staticClass:"font-semibold"},[t._v('"'+t._s(s.oldValue)+'"')]),t._v(" to "),e("span",{staticClass:"font-semibold"},[t._v('"'+t._s(s.newValue)+'"')])]):e("div",[t._v(" Assigned "),e("span",{staticClass:"font-semibold"},[t._v('"'+t._s(s.newValue)+'"')]),t._v(" as "+t._s(s.name)+" ")])],1)}))],2)])})):e("div",{staticClass:"no-history"},[t._v("No data found")])],2)])],1)])],1)},o=[],a=s("381e"),r=s("1b0d"),n={name:"FormEntryHistory",components:{Sheet:a["a"]},props:{value:{type:Boolean,default:!1},processId:{type:Number,required:!0},workflowId:{type:Number,required:!0}},data(){return{changes:[],history:[],formHistorySheet:!1}},watch:{value:{immediate:!0,handler(){this.value&&this.getFormHistory()}}},methods:{async getFormHistory(){this.formHistorySheet=!0,this.history=[],this.$store.commit("showLoadingBar");const{error:t,payload:e}=await r["g"].formHistory(this.workflowId,this.processId);if(this.$store.commit("hideLoadingBar"),t)this.$alert.error(t);else if(e){let t=e;this.history=t.length&&t.map(t=>({id:this.$nano.id(),changedBy:t.modifiedBy,changedAt:this.$day.format(t.modifiedAt),changes:t.fields}))}},closeFormHistorySheet(){this.formHistorySheet=!1,this.$emit("update:value",!1)}}},l=n,c=(s("742a"),s("2877")),d=Object(c["a"])(l,i,o,!1,null,"231e188e",null);e["a"]=d.exports},b94d:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{style:{color:t._color},attrs:{id:"tabs"}},[t._l(t.tabs,(function(s){return e("Tab",{key:s.id,ref:"tab",refInFor:!0,attrs:{label:s.label,color:t.color,"is-full-width":t.isFullWidth,"is-active":s.value===t.value},on:{click:function(e){return t.handleClick(s)}}})})),e("div",{ref:"indicator",staticClass:"indicator"})],2)},o=[],a=s("8b55"),r={name:"Tabs",components:{Tab:a["a"]},props:{tabs:{type:Array,required:!0},value:{type:[String,Number],required:!0},color:{type:String,default:"primary"},isFullWidth:{type:Boolean,default:!1}},computed:{_color(){return`var(--${this.color})`}},watch:{value(){this.setIndicatorPosition()}},mounted(){this.setIndicatorPosition()},methods:{setIndicatorPosition(){const t=this.tabs.findIndex(t=>t.value===this.value),e=this.$refs.tab[t],s=e.$el.offsetLeft;this.$refs.indicator.style.left=s+"px";const i=e.$el.clientWidth;this.$refs.indicator.style.width=i+"px"},handleClick(t){t.value!==this.value&&this.$emit("input",t.value)}}},n=r,l=(s("40f9"),s("2877")),c=Object(l["a"])(n,i,o,!1,null,"48eb7e5e",null);e["a"]=c.exports},bb36:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("Sheet",{attrs:{width:"30vw",height:"80vh","custom-height":"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess||t.isPortal?"30":"0","no-padding":""},on:{input:t.closeCommentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments ")]},proxy:!0},{key:"actions",fn:function(){return[t.selectedProcess.processId?e("div",{staticClass:"q-ml-sm text-gray q-mr-sm ellipsis",staticStyle:{"font-size":"10px"}},[t._v(" auto-refresh every 30 seconds ")]):t._e(),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getComments(0)}}})]},proxy:!0}]),model:{value:t.commentsSheet,callback:function(e){t.commentsSheet=e},expression:"commentsSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:t.commentsSheetHeight}},[t._l(t.commentsList,(function(s,i){return[e("q-chat-message",{key:i,staticClass:"q-ma-sm",attrs:{name:s.createdBy===t.$store.state.session.id?"me":s.createdByEmail||s.externalCommentsby,text:[s.comments],"text-html":"",sent:s.createdBy===t.$store.state.session.id,stamp:t.lastCommentDuration(s),"bg-color":s.createdBy===t.$store.state.session.id?"primary-1":"secondary-1"},scopedSlots:t._u([{key:"avatar",fn:function(){return[s.embedFileList&&s.embedFileList.length?e("div",{staticClass:"file-icons"},[e("FileIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:s.embedFileList[0].fileName,expression:"row.embedFileList[0].fileName",modifiers:{top:!0}}],key:"Icon-"+i,staticClass:"file-icon q-mr-sm",attrs:{"mime-type":t.fileType(s.embedFileList[0].fileName)}})],1):t._e()]},proxy:!0}],null,!0)})]}))],2)],1),"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess||t.isPortal?e("div",{staticClass:"col borderTop"},[e("div",{staticClass:"row"},[t.checkTenant()?[e("div",{staticClass:"col actions"},[t.attachmentList.length&&t.fileNames.length?e("div",{staticClass:"row select-action q-pa-sm action-container"},[e("CheckboxField",{staticClass:"q-pr-sm",class:t.attachComment?"col-auto":"col",attrs:{label:"Add Comment to PDF"},model:{value:t.attachComment,callback:function(e){t.attachComment=e},expression:"attachComment"}}),!t.selectedProcess.processId||"START"===t.selectedProcess.stageType||t.attachComment||t.isPortal?t._e():e("CheckboxField",{staticClass:"col-auto notify-cmd",attrs:{label:"Notify Initiator/Requester"},model:{value:t.notifyInitiator,callback:function(e){t.notifyInitiator=e},expression:"notifyInitiator"}}),t.attachComment?e("SelectField",{staticClass:"col field comment-attach attach-cmd",attrs:{"is-searchable":!0,options:t.fileNames},model:{value:t.selectedFileForAttach,callback:function(e){t.selectedFileForAttach=e},expression:"selectedFileForAttach"}}):t._e()],1):t._e(),!t.selectedProcess.processId||"START"===t.selectedProcess.stageType||!t.attachComment&&t.attachmentList.length&&t.fileNames.length||t.isPortal?t._e():e("CheckboxField",{staticClass:"col-12 q-pl-sm q-pb-sm q-pt-sm",class:t.notifyInitiatorClass,attrs:{label:"Notify Initiator/Requester"},model:{value:t.notifyInitiator,callback:function(e){t.notifyInitiator=e},expression:"notifyInitiator"}}),t.displayInternalPublic?e("SingleChoiceField",{staticClass:"action-container",class:{"internal-public":t.attachmentList.length>0,"col q-pa-sm":!0,"internal-public-margin":t.attachComment},attrs:{options:t.commentActions,"show-options-wrapper":!1,"options-per-line":2},model:{value:t.commentAction,callback:function(e){t.commentAction=e},expression:"commentAction"}}):t._e()],1)]:t._e(),t.isTenantGOTOComments()?[e("SingleChoiceField",{staticClass:"col q-mb-sm actions",attrs:{options:t.jiraCommentActions,"options-per-line":2},model:{value:t.jiraCommentAction,callback:function(e){t.jiraCommentAction=e},expression:"jiraCommentAction"}})]:t._e()],2),e("div",{staticClass:"row text-area-action q-ml-sm q-mr-sm"},[e("div",{staticClass:"col"},[e("TextAreaField",{attrs:{"auto-focus":"",placeholder:"Type a new comment..."},model:{value:t.commentText,callback:function(e){t.commentText=e},expression:"commentText"}})],1),e("div",{staticClass:"col-auto",staticStyle:{margin:"auto","margin-right":"8px"}},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Post Comments",expression:"'Post Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm comment-actions",attrs:{icon:"eva-paper-plane-outline",color:"primary-11",size:"16px","rotate-class":"rotate-45"},on:{click:t.saveComment}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:"Advanced Comments",expression:"'Advanced Comments'",modifiers:{left:!0}}],staticClass:"q-ml-sm q-mt-sm comment-actions",attrs:{icon:"mdi-comment-text-multiple",color:"primary-11",size:"16px"},on:{click:function(e){t.advancedCommentsSheet=!0}}})],1)])]):t._e()]),e("Confirm",{attrs:{icon:"eva-alert-circle-outline","icon-color":"red"},on:{input:function(e){t.errorModal=!1,t.errorMessage=""}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Error Message")]},proxy:!0},{key:"default",fn:function(){return[e("div",{staticClass:"q-py-md"},[e("p",[t._v(" "+t._s(t.errorMessage)+" ")])])]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{attrs:{label:"Close",color:"red"},on:{click:function(e){t.errorModal=!1,t.errorMessage=""}}})]},proxy:!0}]),model:{value:t.errorModal,callback:function(e){t.errorModal=e},expression:"errorModal"}}),e("Modal",{attrs:{width:"60vw",height:"80vh","has-footer":""},on:{input:function(e){t.saveAction="",t.workflowFormModel={},t.advancedCommentsSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Comments")]},proxy:!0},{key:"default",fn:function(){return[e("TextBuilderField",{model:{value:t.advancedCommentText,callback:function(e){t.advancedCommentText=e},expression:"advancedCommentText"}})]},proxy:!0},{key:"footer",fn:function(){return[t.checkTenant()?[t.attachmentList.length&&t.fileNames.length?e("div",{staticClass:"row actions advance-cmd"},[e("CheckboxField",{staticClass:"col-auto q-pr-sm",staticStyle:{margin:"auto"},attrs:{label:"Add Comment to PDF"},model:{value:t.attachComment,callback:function(e){t.attachComment=e},expression:"attachComment"}}),t.attachComment?e("SelectField",{staticClass:"field comment-attach",attrs:{"is-searchable":!0,options:t.fileNames},model:{value:t.selectedFileForAttach,callback:function(e){t.selectedFileForAttach=e},expression:"selectedFileForAttach"}}):t._e(),t.selectedProcess.processId&&"START"!==t.selectedProcess.stageType&&!t.isPortal?e("CheckboxField",{staticClass:"col-auto q-pl-sm adv-notify-cmd",attrs:{label:"Notify Initiator/Requester"},model:{value:t.notifyInitiator,callback:function(e){t.notifyInitiator=e},expression:"notifyInitiator"}}):t._e()],1):t._e(),t.checkTenant()&&t.displayInternalPublic?e("SingleChoiceField",{staticClass:"actions q-mr-sm noborder",attrs:{options:t.commentActions,"options-per-line":2},model:{value:t.commentAction,callback:function(e){t.commentAction=e},expression:"commentAction"}}):t._e()]:t._e(),t.isTenantGOTOComments()?[e("SingleChoiceField",{staticClass:"col q-mb-sm actions",attrs:{options:t.jiraCommentActions,"options-per-line":2},model:{value:t.jiraCommentAction,callback:function(e){t.jiraCommentAction=e},expression:"jiraCommentAction"}})]:t._e(),e("BaseButton",{attrs:{label:"Post Comments",icon:"eva-paper-plane-outline",color:"primary"},on:{click:t.saveAdvancedComment}})]},proxy:!0}]),model:{value:t.advancedCommentsSheet,callback:function(e){t.advancedCommentsSheet=e},expression:"advancedCommentsSheet"}})],1)},o=[],a=(s("14d9"),s("381e")),r=s("1b0d"),n=s("1c54"),l=s("6df3"),c=s("6a70"),d=s("695e"),h=s("869e"),m=s("12b8"),u=s("9234"),f=s("fa1f"),p={name:"Comments",components:{Sheet:a["a"],Confirm:n["a"],TextAreaField:l["a"],Modal:c["a"],TextBuilderField:d["a"],CheckboxField:h["a"],SelectField:m["a"],SingleChoiceField:u["a"],FileIcon:f["a"]},props:{value:{type:Boolean,default:!1},selectedProcess:{type:Object,default:()=>{}},workflow:{type:Object,default:()=>{}},selectedNode:{type:String,required:!0},initiateProcess:{type:Boolean,default:!1},formFields:{type:Array,default:()=>[]},attachmentList:{type:Array,default:()=>[]},workflowId:{type:Number,required:!0},actionComments:{type:Boolean,default:!1},fileNames:{type:Array,default:()=>[]},comments:{type:Array,default:()=>[]},displayInternalPublic:{type:Boolean,default:!1},isPortal:{type:Boolean,default:!1}},data(){return{commentsSheet:!1,commentText:"",commentsList:[],attachComment:!1,selectedFileForAttach:0,advancedCommentsSheet:!1,advancedCommentText:"",commentActions:[{id:this.$nano.id(),label:"Internal",value:2},{id:this.$nano.id(),label:"Public",value:1}],commentAction:2,jiraCommentActions:[{id:this.$nano.id(),label:"This resource",value:1},{id:this.$nano.id(),label:"All resource",value:2}],jiraCommentAction:1,errorMessage:"",errorModal:!1,successModal:!1,notifyInitiator:!1}},computed:{commentsSheetHeight(){return"inbox"===this.selectedNode||"payment"===this.selectedNode||"common"===this.selectedNode||this.initiateProcess||this.isPortal?this.checkCommentsOption()&&!this.isCustomizedWorkflow?this.attachmentList.length&&this.fileNames.length?this.attachComment&&this.displayInternalPublic?"calc(100vh - 270px)":this.attachComment&&!this.displayInternalPublic?"calc(100vh - 230px)":!this.attachComment&&this.displayInternalPublic?"calc(100vh - 225px)":"calc(100vh - 200px)":this.displayInternalPublic?"calc(100vh - 220px)":"START"===this.selectedProcess.stageType||this.isPortal?"calc(100vh - 150px)":"calc(100vh - 180px)":"calc(100vh - 150px)":""},notifyInitiatorClass(){return this.attachmentList.length&&this.fileNames.length?"":"action-container"}},watch:{value:{immediate:!0,handler(){this.commentsSheet=!0,this.commentsList=this.comments,this.commentsSheet&&this.selectedProcess.processId?this.commentsLoad=setInterval(()=>{this.getComments()},3e4):clearInterval(this.commentsLoad)}}},methods:{closeCommentsSheet(){this.commentsSheet=!1,this.$emit("update:comments",this.commentsList),this.$emit("commentsCount",this.commentsList.length),this.$emit("update:value",!1)},async getComments(t=0,e=0){this.commentsList=[],t||e||(t=this.workflowId,e=this.selectedProcess.processId),this.$store.commit("showLoadingBar");const{error:s,payload:i}=await r["t"].getProcessComments(t,e);this.$store.commit("hideLoadingBar"),s?this.$alert.error(s):i.length&&(this.commentsList=i,this.$emit("commentsCount",this.commentsList.length))},async saveComment(){if(this.commentText){if(this.attachComment&&!this.selectedFileForAttach)return void this.$alert.warning("Select File To Attach");if(this.selectedProcess.processId){if(this.isTenantGOTO()&&this.selectedProcess.jiraIssueInfo.id&&2===this.jiraCommentAction){const{error:t,payload:e}=await r["t"].insertProcessComment_Jira(this.selectedProcess.jiraIssueInfo.id,{comments:this.commentText});if(t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.commentText,this.selectedProcess.jiraIssueInfo.id,e)}else{const{error:t,payload:e}=await r["t"].insertProcessComment(this.workflowId,this.selectedProcess.processId,this.selectedProcess.transactionId,{comments:this.commentText,showTo:this.isPortal?1:this.commentAction,hasNotifytoInitiated:this.notifyInitiator,embedJson:JSON.stringify({repositoryId:this.workflow.repositoryId,itemIds:this.attachComment?[this.selectedFileForAttach]:[]})});if(t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.commentText,this.selectedProcess.jiraIssueInfo.id,[e])}this.commentText="",this.clearAttach(),this.getComments()}else this.commentsList.push({comments:this.commentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id,hasNotifytoInitiated:this.notifyInitiator,embedJson:JSON.stringify({repositoryId:this.workflow.repositoryId,itemIds:this.attachComment?[this.selectedFileForAttach]:[]})}),this.$emit("commentsCount",this.commentsList.length),this.commentText="",this.clearAttach()}},async saveAdvancedComment(){if(this.advancedCommentText){if(this.attachComment&&!this.selectedFileForAttach)return void this.$alert.warning("Select File To Attach");if(this.selectedProcess.processId){if(this.isTenantGOTO()&&this.selectedProcess.jiraIssueInfo.id&&2===this.jiraCommentAction){this.$store.commit("showLoadingBar");const{error:t,payload:e}=await r["t"].insertProcessComment_Jira(this.selectedProcess.jiraIssueInfo.id,{comments:this.advancedCommentText});if(this.$store.commit("hideLoadingBar"),t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.advancedCommentText,this.selectedProcess.jiraIssueInfo.id,e)}else{const{error:t,payload:e}=await r["t"].insertProcessComment(this.workflowId,this.selectedProcess.processId,this.selectedProcess.transactionId,{comments:this.advancedCommentText,showTo:this.isPortal?1:this.commentAction,hasNotifytoInitiated:this.notifyInitiator,embedJson:JSON.stringify({repositoryId:this.workflow.repositoryId,itemIds:this.attachComment?[this.selectedFileForAttach]:[]})});if(t)return void this.$alert.error(t);this.selectedProcess.jiraIssueInfo.id&&this.sendCommentsToJira(this.advancedCommentText,this.selectedProcess.jiraIssueInfo.id,e)}this.advancedCommentText="",this.advancedCommentsSheet=!1,this.clearAttach(),this.getComments()}else this.commentsList.push({comments:this.advancedCommentText,createdAt:(new Date).toISOString(),createdBy:this.$store.state.session.id}),this.advancedCommentText="",this.advancedCommentsSheet=!1,this.$emit("commentsCount",this.commentsList.length);this.actionComments&&this.$emit("processRequest",!1,!1)}},clearAttach(){this.selectedFileForAttach=0,this.attachComment=!1,this.notifyInitiator=!1},async sendCommentsToJira(t,e,s){if(this.$store.commit("showLoadingBar"),1===this.jiraCommentAction){var i;let e=null===(i=this.formFields.find(t=>"Resource ID"===t.label))||void 0===i?void 0:i.value;t=this.selectedProcess.formData.fields[e]+","+t}t=`${this.$store.state.session.firstName} ${this.$store.state.session.lastName}: ${t}`;let o={cloudIntegrationId:this.jiraAccounts[0].id,url:this.selectedProcess.jiraIssueInfo.self,data_onpremise:{body:t},issueId:e,ezCommentId:s};const{error:a,payload:n}=await r["j"].insertJiraIssueComments(o);if(this.$store.commit("hideLoadingBar"),a){this.$alert.error("error posting comments to jira");let t=JSON.parse(a);return this.errorMessage=t.errorMessages,void(this.errorModal=!0)}console.log(n),this.jiraCommentAction=1},isTenantGOTO(){let t=location.origin;return("https://app.ezofis.com"===t||"https://appuat.ezofis.com"===t)&&2===this.$store.state.session.tenantId},checkCommentsOption(){return!this.isTenantArmgroup()&&(!this.isTenantGOTO()||!(!Object.keys(this.selectedProcess).length||!this.selectedProcess.jiraIssueInfo.id))},checkTenant(){return!this.isTenantArmgroup()||(this.commentAction=2,!1)},isTenantArmgroup(){let t=location.origin;return("https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t||"http://localhost:80801"===t)&&3===this.$store.state.session.tenantId},isTenantGOTOComments(){return!!(Object.keys(this.selectedProcess).length&&this.isTenantGOTO()&&this.selectedProcess.jiraIssueInfo.id)},lastCommentDuration(t){const e=t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt),s=new Intl.RelativeTimeFormat("en"),i={years:31536e3,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1},o=(e.getTime()-Date.now())/1e3;for(let a in i)if(i[a]<Math.abs(o)){const t=o/i[a];return s.format(Math.round(t),a)}},fileType(t){if(t)return t.split(".").reverse()[0].slice(0,4)}}},v=p,y=(s("c5b7"),s("2877")),w=s("8169"),g=s("93dc"),b=s.n(g),k=Object(y["a"])(v,i,o,!1,null,null,null);e["a"]=k.exports;b()(k,"components",{QChatMessage:w["a"]})},bcdf:function(t,e,s){var i={"./name-dark.png":"cd22","./name-light.png":"00c2"};function o(t){var e=a(t);return s(e)}function a(t){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}o.keys=function(){return Object.keys(i)},o.resolve=a,t.exports=o,o.id="bcdf"},bf55:function(t,e,s){"use strict";s("686b")},c589:function(t,e,s){},c5b7:function(t,e,s){"use strict";s("0698")},c76c:function(t,e,s){"use strict";s("9baa")},cd22:function(t,e,s){t.exports=s.p+"img/name-dark.ebb22601.png"},d30f:function(t,e,s){},e98d:function(t,e,s){"use strict";s("50ff")},ec15:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("Sheet",{attrs:{width:"30vw","sub-actions":!(!t.selectedProcess.processId||!t.attachmentList.length),upload:"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess||t.isPortal,"no-padding":""},on:{input:t.closeAttachmentsSheet},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Attachments ")]},proxy:!0},{key:"actions",fn:function(){return[t.selectedProcess.processId?e("div",{staticClass:"q-ml-sm text-gray q-mr-sm ellipsis",staticStyle:{"font-size":"10px"}},[t._v(" auto-refresh every 15 seconds ")]):t._e(),t.selectedProcess.processId?e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"refresh",expression:"'refresh'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{icon:"mdi-refresh",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return t.getAttachments()}}}):t._e()]},proxy:!0},"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess||t.isPortal?{key:"upload",fn:function(){return[e("div",{staticClass:"hint",on:{click:function(e){t.rowIndex=null,t.$refs.attachments.click()}}},[e("BaseIcon",{staticClass:"icon",attrs:{name:"eva-cloud-upload-outline",size:"32px",color:"blue"}}),e("div",{staticClass:"title text-blue"},[t._v("UPLOAD FILES")]),e("div",{staticClass:"description"},[t._v("Click here to choose files and upload")])],1)]},proxy:!0}:null,t.selectedProcess.processId&&t.attachmentList.length?{key:"subActions",fn:function(){return[e("CheckboxField",{staticClass:"col-auto q-pt-sm q-pb-sm",on:{input:t.fileSelectAll},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}}),t._v(" Select All "),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"mail share",expression:"'mail share'",modifiers:{top:!0}}],staticClass:"q-ml-sm",attrs:{"is-disabled":!t.selectedFileCount,icon:"mdi-email-send-outline",color:"secondary","no-border":"","is-flat":"",size:"18px"},on:{click:t.documentShare}}),e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"merge documents (only PDF)",expression:"'merge documents (only PDF)'",modifiers:{top:!0}}],attrs:{"is-disabled":!(t.selectedFileCount>1&&t.isSelectedPDF),icon:"mdi-file-document-multiple-outline",color:"secondary","no-border":"","is-flat":"",size:"18px"},on:{click:t.documentMerge}})]},proxy:!0}:null],null,!0),model:{value:t.attachmentSheet,callback:function(e){t.attachmentSheet=e},expression:"attachmentSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode||t.initiateProcess||t.isPortal?"calc(100vh - 200px)":""}},[e("input",{ref:"attachments",staticClass:"hidden",attrs:{type:"file"},on:{change:t.uploadWflowAttachments}}),t._l(t.checkList,(function(s){return[!s.name||s.hasOwnProperty("visible")&&!s.show?t._e():[s.attach?e("div",{key:s.uid},[t._l(t.attachmentFilterCheckList(s.name),(function(s){return[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row"},[t.selectedProcess.processId?e("div",{staticClass:"col-auto"},[s.loading?[e("BaseIcon",{staticClass:"q-mr-sm loading",attrs:{name:"mdi-loading",color:"secondary"}})]:[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:s.checked?"eva-checkmark-circle-2":"eva-radio-button-off-outline",color:"secondary"},on:{click:function(t){s.checked=!s.checked}}})]],2):e("div",[s.loading?[e("BaseIcon",{staticClass:"q-mr-sm loading",attrs:{name:"mdi-loading",color:"secondary"}})]:t._e()],2),s.formJsonId?e("div",{staticClass:"col-auto"},[e("BaseIcon",{directives:[{name:"tooltip",rawName:"v-tooltip:green.top",value:t.getLabel(s.formJsonId),expression:"getLabel(file.formJsonId)",arg:"green",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{name:"mdi-form-select",color:"primary"}})],1):t._e(),e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openFile(s)}}},[t._v(" "+t._s(s.name)+" ")]),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Download",expression:"'Download'",modifiers:{top:!0}}],attrs:{icon:"eva-download-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Download")}}})],1),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Print",expression:"'Print'",modifiers:{top:!0}}],attrs:{icon:"eva-printer-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Print")}}})],1)]),e("div",{staticClass:"meta row"},[e("div",{staticClass:"col row"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.createdBy?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(s.createdByEmail))])]:t._e(),s.size?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(t.fileSize(s.size)))])]:t._e()],2),e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Metadata",expression:"'Metadata'",modifiers:{top:!0}}],attrs:{icon:"eva-file-text-outline",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.getFileData(s)}}})],1),[("inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode)&&s.createdBy===t.$store.state.session.id||t.initiateProcess?[e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"delete",expression:"'delete'",modifiers:{top:!0}}],attrs:{icon:"eva-trash-2-outline",color:"red","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.attachmentDelete(s)}}})],1),e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Re-Upload",expression:"'Re-Upload'",modifiers:{top:!0}}],attrs:{icon:"mdi-file-upload",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){e.stopPropagation(),t.reuploadFile=s,t.reupload(s.name)}}})],1)]:t._e()]],2)])]}))],2):e("div",{key:s.uid,staticClass:"checkList"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-auto"},[e("BaseIcon",{attrs:{name:"mdi-file-check-outline",color:"primary"}})],1),e("div",{staticClass:"col q-ml-sm"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[t._v(" "+t._s(s.name)+" ")]),s.required?e("div",{staticClass:"col-12 q-mt-sm"},[e("q-chip",{staticClass:"chips small",attrs:{outline:"",color:"red"}},[t._v(" Required ")])],1):t._e()])]),e("div",{staticClass:"col-auto"},[e("div",{staticClass:"col-12",on:{click:function(e){return t.attachTemplate(s.uid)}}},[e("q-chip",{staticClass:"chips primary-hover medium",attrs:{outline:"",color:"primary"}},[e("q-avatar",{staticClass:"q-mr-sm",attrs:{icon:"eva-upload-outline",color:"primary","text-color":"white"}}),t._v(" Upload ")],1)],1),s.template?e("div",{staticClass:"col-12",on:{click:function(e){return t.download(s.id)}}},[e("q-chip",{staticClass:"chips secondary-hover medium",attrs:{outline:"",color:"secondary"}},[e("q-avatar",{staticClass:"q-mr-sm",attrs:{icon:"eva-download-outline",color:"secondary","text-color":"white"}}),t._v(" Download ")],1)],1):t._e()])])])]]})),t._l(t.attachmentList,(function(s){return[t.isCheckList(s.name)?[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row"},[s.loading?[e("BaseIcon",{staticClass:"q-mr-sm loading",attrs:{name:"mdi-loading",color:"secondary"}})]:t._e(),t.selectedProcess.processId?e("div",{staticClass:"col-auto"},[e("BaseIcon",{staticClass:"q-mr-sm",attrs:{name:s.checked?"eva-checkmark-circle-2":"eva-radio-button-off-outline",color:"secondary"},on:{click:function(t){s.checked=!s.checked}}})],1):t._e(),s.formJsonId?e("div",{staticClass:"col-auto"},[e("BaseIcon",{directives:[{name:"tooltip",rawName:"v-tooltip:green.top",value:t.getLabel(s.formJsonId),expression:"getLabel(file.formJsonId)",arg:"green",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{name:"mdi-form-select",color:"primary"}})],1):t._e(),e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openFile(s)}}},[t._v(" "+t._s(s.name)+" ")]),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Download",expression:"'Download'",modifiers:{top:!0}}],attrs:{icon:"eva-download-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Download")}}})],1),s.loading?t._e():e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Print",expression:"'Print'",modifiers:{top:!0}}],attrs:{icon:"eva-printer-outline",color:"primary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.fileMenuAction(s,"Print")}}})],1)],2),e("div",{staticClass:"meta row"},[e("div",{staticClass:"col row"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.createdBy?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(s.createdByEmail))])]:t._e(),s.size?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(t.fileSize(s.size)))])]:t._e()],2),e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Metadata",expression:"'Metadata'",modifiers:{top:!0}}],attrs:{icon:"eva-file-text-outline",color:"secondary","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.getFileData(s)}}})],1),("inbox"===t.selectedNode||"common"===t.selectedNode||"payment"===t.selectedNode)&&s.createdBy===t.$store.state.session.id||t.initiateProcess?e("div",{staticClass:"col-auto"},[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"delete",expression:"'delete'",modifiers:{top:!0}}],attrs:{icon:"eva-trash-2-outline",color:"red","no-border":"","is-flat":"",size:"20px"},on:{click:function(e){return e.stopPropagation(),t.attachmentDelete(s)}}})],1):t._e()])])]:t._e()]}))],2)],1)]),e("EmailSharing",{attrs:{"repository-id":t.workflow.repositoryId,"file-list":t.selectedFileList},on:{"update:fileList":function(e){t.selectedFileList=e},"update:file-list":function(e){t.selectedFileList=e}},model:{value:t.emailSharingSheet,callback:function(e){t.emailSharingSheet=e},expression:"emailSharingSheet"}}),e("FileDetails",{attrs:{"file-data":t.fileData},model:{value:t.fileDetailsSheet,callback:function(e){t.fileDetailsSheet=e},expression:"fileDetailsSheet"}}),e("Sheet",{attrs:{width:"30vw","no-padding":""},on:{input:function(e){t.mailAttachmentSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Mail Attachments ")]},proxy:!0}]),model:{value:t.mailAttachmentSheet,callback:function(e){t.mailAttachmentSheet=e},expression:"mailAttachmentSheet"}},[e("div",{attrs:{id:"content-wrapper"}},[e("BaseScrollbar",{attrs:{height:"calc(100vh - 200px)"}},[t._l(t.mailAttachmentList,(function(s){return[e("div",{key:s.id,staticClass:"attachmentList"},[e("div",{staticClass:"title row"},[e("div",{staticClass:"col-auto"},[e("FileIcon",{staticClass:"mini-avatar q-mr-sm",attrs:{"mime-type":t.fileType(s.name)}})],1),e("div",{staticClass:"col ellipsis",on:{click:function(e){return t.openAttachmentFile(s)}}},[t._v(" "+t._s(s.name)+" ")])]),e("div",{staticClass:"meta"},[e("div",[t._v(t._s(t.$day.format(s.createdAt)))]),s.size?[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v(t._s(t.fileSize(s.size)))])]:t._e()],2)])]}))],2)],1)]),e("Sheet",{attrs:{"no-padding":"",width:"100vw"},on:{input:function(e){t.fileSheet=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"attachmentFileHeader"},[t.selectedFile.formJsonId?[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip:green.bottom",value:t.getLabel(t.selectedFile.formJsonId),expression:"getLabel(selectedFile.formJsonId)",arg:"green",modifiers:{bottom:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"mdi-form-select",color:"primary"}})]:t._e(),e("div",{staticClass:"avatar q-ml-sm"},[e("FileIcon",{attrs:{"mime-type":t.fileType(t.selectedFile.name)}})],1),e("div",{staticClass:"q-ml-md"},[e("div",{staticClass:"filename"},[t._v(" "+t._s(t.selectedFile.name)+" ")]),e("div",{staticClass:"meta"},[e("div",[t._v("Archived At: "+t._s(t.$day.format(t.selectedFile.createdAt)))]),e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),e("div",[t._v("Archived By: "+t._s(t.selectedFile.createdByEmail))]),t.selectedFile.size?e("div",[e("BaseIcon",{attrs:{name:"mdi-circle-small"}}),t._v(" File Size: "+t._s(t.fileSize(t.selectedFile.size))+" ")],1):t._e()],1)])],2)]},proxy:!0},{key:"actions",fn:function(){return[e("BaseActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"Actions",expression:"'Actions'",modifiers:{top:!0}}],staticClass:"q-mr-sm",attrs:{"is-flat":"",icon:"eva-menu"}},[e("q-menu",{attrs:{"transition-show":"scale","transition-hide":"scale",anchor:"bottom end",self:"top right"}},[e("BaseScrollbar",{staticClass:"q-pb-sm",attrs:{width:"240px"}},t._l(t.documentActionList,(function(s){return e("ListItem",{key:s.id,attrs:{icon:s.icon,label:s.label},on:{click:function(e){return t.documentAction(s.id)}}})})),1)],1)],1)]},proxy:!0}]),model:{value:t.fileSheet,callback:function(e){t.fileSheet=e},expression:"fileSheet"}},[e("div",{staticClass:"attachmentFileFrame"},[e("div",{staticClass:"file-list"},[e("iframe",{ref:"myAttachmentFiles",attrs:{id:"file-frame",src:t.fileLink(),frameborder:"0"}})])])]),e("MetaDataEdit",{attrs:{value:t.showMetaDataEditModal,file:t.workflow,"repository-field":t.repositoryField,"file-data":t.fileData,title:t.metaDataTitle||"Index",columns:t.columns,"modal-value":t.workflowModel,"upload-filename":t.uploadFilename,"meta-data-fields":t.metaDataModal},on:{close:t.closeMetaDataEditModal,save:t.saveMetaData}})],1)},o=[],a=(s("14d9"),s("13d5"),s("381e")),r=s("5e23"),n=s("1b0d"),l=s("fa1f"),c=s("a7d2"),d=s("dd90"),h=s("abe1"),m=s("bc3a"),u=s.n(m),f=s("ee54"),p=s("9996"),v=s("869e"),y=s("cade"),w={name:"Attachments",components:{Sheet:a["a"],EmailSharing:r["a"],FileIcon:l["a"],FileDetails:h["a"],MetaDataEdit:f["a"],CheckboxField:v["a"],ListItem:y["a"]},props:{value:{type:Boolean,default:!1},selectedProcess:{type:Object,default:()=>{}},workflow:{type:Object,default:()=>{}},selectedNode:{type:String,required:!0},initiateProcess:{type:Boolean,default:!1},formCheckList:{type:Boolean,default:!1},checkList:{type:Array,default:()=>[]},wform:{type:Object,default:()=>{}},repositoryDetails:{type:Object,default:()=>{}},workflowModel:{type:Object,default:()=>{}},formUploadFiles:{type:Array,default:()=>[]},formFields:{type:Array,default:()=>[]},repositoryField:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},attachments:{type:Array,default:()=>[]},workflowId:{type:Number,required:!0},isPortal:{type:Boolean,default:!1}},data(){return{attachmentSheet:!1,attachmentList:[],selectAll:!1,emailSharingSheet:!1,selectedFileList:[],fileDetailsSheet:!1,fileData:[],checkListRowIndex:0,selectedFile:{},mailTransactionList:[],mailAttachmentSheet:!1,mailAttachmentList:[],fileSheet:!1,watchViewerClose:null,reuploadFile:{},documentActionList:[{id:"Download",key:"download",label:"Download",icon:"mdi-download-outline"},{id:"Print",key:"print",label:"Print",icon:"eva-printer-outline"}],uploadFilename:"",showMetaDataEditModal:!1,selectedUploadFile:{},documentLoad:null,documentLoadList:[],metaDataModal:{},metaDataTitle:"",selectedCheckListName:""}},computed:{selectedFileCount(){this.clearAttach();let t=this.attachmentList.filter(t=>t.checked).length;return t},isSelectedPDF(){let t=!0;return this.attachmentList.forEach(e=>{let s=e.name.split(".").pop();e.checked&&"pdf"!==s.toLowerCase()&&(t=!1)}),t}},watch:{value:{immediate:!0,handler(){if(this.value)if(this.attachmentSheet=!0,this.attachmentList=this.attachments,this.attachmentSheet&&this.selectedProcess.processId){if(this.getAttachments(),this.attachmentList.length){let t=this.attachmentList.length-1;this.getFileData(this.attachmentList[t],"file")}this.attachmentLoad=setInterval(()=>{this.getAttachments()},15e3)}else clearInterval(this.attachmentLoad)}}},methods:{async getAttachments(t=0,e=0){let s=this.attachmentList.length;t||e||(t=this.workflowId,e=this.selectedProcess.processId),this.$store.commit("showLoadingBar");const{error:i,payload:o}=await n["t"].getAttachments(t,e);if(this.$store.commit("hideLoadingBar"),i)this.$alert.error(i);else if(o.length?(s!==o.length&&(this.attachmentList=o.map(t=>({...t,checked:!1}))),this.$emit("attachmentCount",this.attachmentList.length)):this.attachmentList=[],this.checkList.length){this.checkList.forEach(t=>{let e=this.attachmentList.filter(e=>{let s=e.name.substr(0,e.name.lastIndexOf("."));if(t.name===s||t.name===s.split("_")[0])return e});e.length?t.attach=!0:t.attach=!1});let t=location.origin;(this.isTenantArmgroup()||"https://trial.ezofis.com"===t&&12===this.$store.state.session.tenantId)&&this.selectedProcess.attachmentCount!==this.attachmentList.length&&this.$emit("update:formCheckList",!0)}},isTenantArmgroup(){let t=location.origin;return("https://ag-appsvc01.azurewebsites.net"===t||"https://ag-appsvc05.azurewebsites.net"===t||"http://localhost:8080"===t)&&3===this.$store.state.session.tenantId},fileSelectAll(){this.attachmentList=this.attachmentList.map(t=>({...t,checked:this.selectAll}))},async documentMerge(){let t=[];this.attachmentList.forEach(e=>{let s=e.name.split(".").pop();e.checked&&"pdf"===s.toLowerCase()&&t.push(e.id)});let e={ids:t};const{error:s}=await n["t"].documentMerge(this.workflowId,this.selectedProcess.processId,this.selectedProcess.transactionId,this.workflow.repositoryId,e);s?this.$alert.error(s):this.$alert.success("Document merge process initiated")},async documentShare(){this.selectedFileList=[],this.attachmentList.forEach(t=>{t.checked&&this.selectedFileList.push({id:t.id,name:t.name})}),this.emailSharingSheet=!0},clearAttach(){console.log("clear")},attachTemplate(t){this.checkListRowIndex=t,this.$refs.attachments.click(),this.selectedCheckListName=this.checkList.find(e=>t==e.uid).name},reupload(t){var e;t=t.substr(0,t.lastIndexOf(".")).split("_")[0],this.checkListRowIndex=null===(e=this.checkList.find(e=>e.name===t))||void 0===e?void 0:e.uid,this.$refs.attachments.click()},attachmentFilterCheckList(t){return this.attachmentList.filter(e=>e.name.substring(0,e.name.lastIndexOf("."))===t||e.name.substring(0,e.name.lastIndexOf(".")).split("_")[0]===t)},isCheckList(t){let e=this.checkList.filter(e=>e.name===t.substring(0,t.lastIndexOf("."))||e.name===t.substring(0,t.lastIndexOf(".")).split("_")[0]);return!e.length},showMailAttachments(t){this.mailAttachmentList=[];let e=t.attachmentJson.split(",");e.forEach(e=>{let s=e.split("\\").pop();this.mailAttachmentList.push({id:this.$nano.id(),mailId:t.id,name:s,createdAt:t.createdAt})}),this.mailAttachmentSheet=!0},openAttachmentFile(t){let e=`https://appuat.ezofis.com/ezofisapi/api/client/viewAttachment/${this.$store.state.session.tenantId}/${t.mailId}/${t.name}`;window.open(e,"_blank")},getLabel(t){let e="",s=this.wform.formJson?JSON.parse(this.wform.formJson):this.wform;const i=[...s.panels,...s.secondaryPanels];if(!i.length)return;let o=[];for(const a of i)o.push(...a.fields);return o.forEach(s=>{const i=s.settings.specific.tableColumns.find(e=>e.id===t);if(i)e=i.label;else if(s.id===t)return void(e=s.label)}),e},fileType(t){if(t)return t.split(".").reverse()[0].slice(0,4)},fileSize(t){return Object(c["a"])(t)},openFile(t){t.loading?this.$alert.info("Please wait to complete the uploading"):(this.selectedFile=t,this.isTenantArmgroup()?window.open(this.fileLink()):this.fileSheet=!0)},fileLink(){let t=location.origin.replace("http://localhost:8080","http://52.172.32.88");if(this.selectedFile.name){let e=this.selectedFile.name.split(".").pop();if(this.selectedFile.initiate){let s=1;"STATIC"===this.repositoryDetails.fieldsType&&"FORM"===this.workflow.initiatedBy&&(s=2);let i="";if(Object(d["d"])(e))i=this.isTenantArmgroup()?"https://ag-appsvc04.azurewebsites.net/web/viewer.html":"https://trial.ezofis.com"===t?"https://trial.ezofis.com/docsviewer/index.html":this.isTenantGOTO()?"https://ezdocsviewer.azurewebsites.net/web/viewer.html":t+"/PDFViewer/web/viewer.html";else{if("http://52.172.32.88"!==t)return`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/${s}`;i="http://52.172.32.88/DocsViewer/index.html"}return`${i}?tId=${this.$store.state.session.tenantId}&uploadId=${this.selectedFile.id}&type=${s}`}{let s="",i="";if("inbox"!==this.selectedNode&&"common"!==this.selectedNode&&"payment"!==this.selectedNode||(i="&action=all"),Object(d["d"])(e))this.isTenantArmgroup()?(i="",s="https://ag-appsvc04.azurewebsites.net/web/viewer.html"):"https://trial.ezofis.com"!==t||Object(d["c"])(e)?s=this.isTenantGOTO()?"https://ezdocsviewer.azurewebsites.net/web/viewer.html":t+"/PDFViewer/web/viewer.html":(localStorage.setItem("viewerClose",!1),this.watchViewerClose=setInterval(()=>this.checkViewerClose(),1e3),s="https://trial.ezofis.com/docsviewer/index.html");else{if(Object(d["b"])(e)||"http://52.172.32.88"!==t)return`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`;localStorage.setItem("viewerClose",!1),this.watchViewerClose=setInterval(()=>this.checkViewerClose(),1e3),s="http://52.172.32.88/DocsViewer/index.html"}return`${s}?tId=${this.$store.state.session.tenantId}&uId=${this.$store.state.session.id}&rId=${this.selectedFile.repositoryId}&itemId=${this.selectedFile.id}&wId=${this.workflowId}&pId=${this.selectedProcess.processId}&type=2&filename=${this.selectedFile.name}${i}`}}},fileMenuAction(t,e){this.selectedFile=t,this.documentAction(e,!0)},documentAction(t,e){if("Email_Sharing"===t);else if("Print"===t){if(this.selectedFile.name)if(e){let t="";if(this.selectedFile.initiate){let e=1;"STATIC"===this.repositoryDetails.fieldsType&&"FORM"===this.workflow.initiatedBy&&(e=2),t=`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/${e}/1`}else t=`https://appuat.ezofis.com/ezofisapi/api/file/view/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`;window.open(t,"_blank")}else{let t=this.selectedFile.name.split(".").pop();Object(d["d"])(t)?(localStorage.setItem("filePrint",!0),localStorage.setItem("filePrintId",this.selectedFile.id)):this.$refs.myAttachmentFiles.contentWindow.print()}this.filePrintSession()}else if("Download"===t){let t="";if(this.selectedFile.initiate){let e=1;"STATIC"===this.repositoryDetails.fieldsType&&"FORM"===this.workflow.initiatedBy&&(e=2),t=`https://appuat.ezofis.com/ezofisapi/api/uploadandindex/view/${this.$store.state.session.tenantId}/${this.selectedFile.id}/${e}/2`}else t=`https://appuat.ezofis.com/ezofisapi/api/menu/file/download/${this.$store.state.session.tenantId}/${this.$store.state.session.id}/${this.selectedFile.repositoryId}/${this.selectedFile.id}/2`;window.open(t,"_blank")}},async filePrintSession(){const{error:t}=await n["k"].filePrintSession({repositoryId:this.selectedFile.repositoryId,itemId:this.selectedFile.id,activityId:4});t&&this.$alert.error(t)},async getFileData(t,e){const{error:s,payload:i}=await n["p"].getFileData({repositoryId:t.repositoryId,itemId:t.id});s?this.$alert.error(s):i&&(t.fileData?this.fileData=t.fileData:this.fileData=i,"file"!==e&&(this.fileDetailsSheet=!0))},async attachmentDelete(t){if(t.fileControl){let e=this.workflowModel[t.fieldId];if(e.length){let s=e.findIndex(e=>e.fileId===t.id);console.log(s),s>=0&&this.workflowModel[t.fieldId].splice(s,1);let i=this.formUploadFiles.findIndex(e=>e.fileId===t.id&&e.fileId===t.fileId);console.log(i),i>=0&&this.formUploadFiles.splice(s,1),t.control.length&&t.control.forEach(t=>{this.workflowModel[t]=""})}let s=this.attachmentList.findIndex(t=>t.fileControl);console.log(s),s>=0&&(this.$emit("attachmentCount",this.attachmentList.length-1),this.attachmentList.splice(s,1))}else if(t.initiate){const{error:e}=await n["r"].deleteUploadedFiles([t.id]);if(e)return void this.$alert.error(e);this.attachmentList=this.attachmentList.filter(e=>e.id!==t.id),this.checkList.forEach(e=>{e.uid===t.uid&&(e.attach=!1)})}else{const{error:e}=await n["p"].fileDelete(this.workflow.repositoryId,t.id);if(e)return void this.$alert.error(e);this.getAttachments()}},checkViewerClose(){localStorage.getItem("viewerClose")&&"true"===localStorage.getItem("viewerClose")&&(this.fileSheet=!1,localStorage.removeItem("viewerClose"),clearInterval(this.watchViewerClose),this.workflow.initiatedBy)},isTenantGOTO(){let t=location.origin;return("https://app.ezofis.com"===t||"https://appuat.ezofis.com"===t)&&2===this.$store.state.session.tenantId},customCheckUpload(){let t=location.origin;return"https://edmsuat.sobhaapps.com"===t&&(55===this.workflowId||2092===this.workflowId)&&0===this.attachmentList.length},async uploadWflowAttachments(t){if("STATIC"===this.repositoryDetails.fieldsType){if(this.selectedUploadFile=t,this.customCheckUpload()){let e=this.formFields.find(t=>"Document No"===t.label);this.uploadFilename=e?this.workflowModel[e.value]+".pdf":t.target.files[0].name}else this.uploadFilename=t.target.files[0].name;const e=this.repositoryField.reduce((t,e)=>e.level>t.level?e:t,this.repositoryField[0]),s=e.id,i=this.fileData.find(t=>s==t.id);if(!this.selectedCheckListName){const t={id:e.id,name:e.name,value:this.selectedCheckListName,type:e.dataType};this.fileData.length?i&&(i.value=""):(this.fileData.push(t),console.log(this.fileData,"selectedCheckListName")),this.showMetaDataEditModal=!0}if(this.selectedCheckListName){i&&(i.value=this.selectedCheckListName);const t={id:e.id,name:e.name,value:this.selectedCheckListName,type:e.dataType};this.fileData.length||(this.fileData.push(t),console.log(this.fileData,"selectedCheckListName"));const s=this.repositoryField.filter(t=>!0===t.isMandatory).map(t=>t.id),o=s.every(t=>{const e=this.fileData.find(e=>e.id===t);return e&&""!==e.value});if(this.showMetaDataEditModal=!o,o){const t={};this.fileData.forEach(e=>{t[e.name]=""!==e.value?e.value:""}),console.log(t,"New Object"),this.saveMetaData(t)}else this.showMetaDataEditModal=!0;this.selectedCheckListName=""}}else this.uploadAttachments(t)},async uploadAttachments(t,e){if(this.selectedProcess.processId){const i=t.target.files[0],o=new FormData;o.append("workflowId",this.workflowId),o.append("repositoryId",this.workflow.repositoryId),o.append("processId",this.selectedProcess.processId),o.append("transactionId",this.selectedProcess.transactionId),e?o.append("fields",e):o.append("fields",""),o.append("file",i);let a=t.target.files[0].name;const r=a.split(".").pop();if(this.checkListRowIndex){let t=this.checkList.filter(t=>t.uid===this.checkListRowIndex);o.append("filename",t[0].name+"."+r),a=t[0].name+"."+r}if(!Object(d["a"])(r))return void this.$alert.info("This file format is not supported");this.$store.commit("showLoadingBar");try{const t=await u()({url:"https://appuat.ezofis.com/ezofisapi/api/workflow/attachmentWithProcessId",method:"POST",data:o,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}}),{status:e,data:s}=t;if(200!==e||!s)throw t;this.$alert.success("Document attached"),this.documentLoad=setInterval(()=>{this.getAttachments(),clearInterval(this.documentLoad)},15e3)}catch(s){this.$alert.error("Error uploading file"),console.error(s)}this.$store.commit("hideLoadingBar"),this.checkList.length&&this.checkList.forEach(t=>{t.uid!==this.checkListRowIndex||(t.attach=!0)}),t.target.value="",Object.keys(this.reuploadFile).length&&(await this.attachmentDelete(this.reuploadFile),this.reuploadFile={})}else{const i=t.target.files[0],o=new FormData;o.append("file",i),o.append("repositoryId",this.workflow.repositoryId),e&&(this.fileData=JSON.parse(e),o.append("fields",e));let a=t.target.files[0].name;const r=a.split(".").pop();if(this.checkListRowIndex){let t=this.checkList.filter(t=>t.uid===this.checkListRowIndex);o.append("filename",t[0].name+"."+r),a=t[0].name+"."+r}else o.append("filename",a);if(!Object(d["a"])(r))return void this.$alert.info("This file format is not supported");this.$store.commit("showLoadingBar");try{const s=await u()({url:"https://appuat.ezofis.com/ezofisapi/api/uploadAndIndex/upload",method:"POST",data:o,headers:{Token:this.$store.state.identity.token,Accept:"application/json","Content-Type":"multipart/form-data"}});this.$store.commit("hideLoadingBar");const{status:n,data:l}=s;if(200!==n)throw"Invalid response";let c=JSON.parse(l);this.$alert.success("Document attached");let d=this.repositoryField.reduce((t,e)=>t.level>e.level?t:e),h=this.fileData.find(t=>t.name===d.name),m=!1;"pdf"!==r.toLowerCase()&&(m=!0,this.documentLoadList.push(Number(c.fileId)),this.documentLoad=setInterval(()=>{let t=this.attachmentList.find(t=>this.documentLoadList.indexOf(t.id)>-1);t&&(this.documentLoadList.splice(this.documentLoadList.indexOf(t.id),1),t.loading=!1),0===this.documentLoadList.length&&clearInterval(this.documentLoad)},1e4)),this.attachmentList.push({id:Number(c.fileId),name:e?h.value+"."+r:a,createdAt:(new Date).toISOString(),createdByEmail:this.$store.state.session.email,size:i.size,initiate:!0,uid:this.checkListRowIndex,createdBy:this.$store.state.session.id,fileData:this.fileData,repositoryId:this.workflow.repositoryId,loading:m}),this.$emit("attachmentCount",this.attachmentList.length),this.checkList.length&&this.checkList.forEach(t=>{t.uid!==this.checkListRowIndex||(t.attach=!0)}),t.target.value=""}catch(s){console.error(s),this.$alert.error("error attaching file")}}},closeMetaDataEditModal(){this.showMetaDataEditModal=!1,this.$refs.attachments&&(this.$refs.attachments.value=null)},saveMetaData(t){let e=[];this.repositoryField.forEach(s=>{e.push({name:s.name,value:t[s.name],type:s.dataType})}),e.forEach(t=>{let e=this.formFields.find(e=>Object(p["a"])(e.label)===Object(p["a"])(t.name));e&&t.value&&(this.workflowModel[e.value]=t.value)}),this.uploadAttachments(this.selectedUploadFile,JSON.stringify(e))},closeAttachmentsSheet(){this.attachmentSheet=!1,this.$emit("update:attachments",this.attachmentList),this.$emit("attachmentCount",this.attachmentList.length),this.$emit("update:value",!1)}}},g=w,b=(s("11f5"),s("2877")),k=s("b047"),I=s("cb32"),C=s("4e73"),S=s("93dc"),_=s.n(S),T=Object(b["a"])(g,i,o,!1,null,"dc5d287e",null);e["a"]=T.exports;_()(T,"components",{QChip:k["a"],QAvatar:I["a"],QMenu:C["a"]})},ee54:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("Modal",{attrs:{value:t.value,"has-footer":"",width:"540px"},on:{input:t.closeModal},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(t._s(t.title))]},proxy:!0},{key:"default",fn:function(){return[e("ValidationObserver",{ref:"form"},[t.editFromFileSheet?t._e():t._l(t._repositoryField,(function(s){return e("div",{key:s.id,staticClass:"field-wrapper"},[[[e("RepositoryField",{staticClass:"col",attrs:{field:s,"repository-id":t.file.repositoryId,"read-only":t.readOnly},model:{value:t.fieldsModel[s.name],callback:function(e){t.$set(t.fieldsModel,s.name,e)},expression:"fieldsModel[field.name]"}})]]],2)})),t.editFromFileSheet?t._l(t.fieldsModalData,(function(s){return e("div",{key:s.id,staticClass:"field-wrapper"},[[[e("RepositoryField",{staticClass:"col",attrs:{field:t.getField(s.fieldId),"repository-id":t.file.repositoryId,"read-only":t.readOnly},model:{value:s.newValue,callback:function(e){t.$set(s,"newValue",e)},expression:"field.newValue"}})]]],2)})):t._e()],2)]},proxy:!0},{key:"footer",fn:function(){return[e("BaseButton",{staticClass:"q-mr-sm",attrs:{"is-flat":"",label:"cancel"},on:{click:t.closeModal}}),e("BaseButton",{attrs:{label:"save"},on:{click:t.save}})]},proxy:!0}])})},o=[],a=(s("14d9"),s("7bb1")),r=s("6a70"),n=s("7794"),l=s("9996"),c=s("7ee8"),d={name:"MetaDataEdit",components:{Modal:r["a"],ValidationObserver:a["a"],RepositoryField:n["a"]},props:{value:{type:Boolean,default:!1},file:{type:Object,required:!0},repositoryField:{type:Array,required:!0},fileData:{type:Array,required:!0},title:{type:String,default:"Metadata Edit"},columns:{type:Array,default:()=>[]},modalValue:{type:Object,default:()=>{}},readOnly:{type:Boolean,default:!1},uploadFilename:{type:String,default:""},editFromFileSheet:{type:Boolean,default:!1},metaDataFields:{type:Object,default:()=>{}}},data(){return{fieldsModel:{},fieldsModalData:[]}},computed:{_repositoryField(){return this.repositoryField.map(t=>({...t,options:t.options?JSON.parse(t.options):[]}))}},watch:{fileData:{immediate:!0,deep:!0,async handler(){this.editFromFileSheet?(this.fieldsModalData=[],this.fileData.length&&this.fileData.forEach(t=>{this.fieldsModalData.push({fieldId:t.id,oldValue:t.value,newValue:t.value})})):this.processFieldsModel()}},value(){this.value&&this.processFieldsModel()}},methods:{processFieldsModel(){if(this.fieldsModel={},this.fileData.length?this.fileData.forEach(t=>{this.$set(this.fieldsModel,t.name,t.value)}):this._repositoryField.forEach(t=>{let e=this.columns.find(e=>Object(l["a"])(e.label)===Object(l["a"])(t.name));e?this.modalValue.formData?this.$set(this.fieldsModel,t.name,this.modalValue.formData.fields[e.id]):this.modalValue[e.name]?this.$set(this.fieldsModel,t.name,this.modalValue[e.name]):this.modalValue[e.id]&&this.$set(this.fieldsModel,t.name,this.modalValue[e.id]):Object(c["a"])(this.metaDataFields)?this.$set(this.fieldsModel,t.name,""):this.$set(this.fieldsModel,t.name,this.metaDataFields[t.name])}),this.uploadFilename){let t=this.uploadFilename.substring(0,this.uploadFilename.lastIndexOf(".")),e=this._repositoryField.find(t=>"filename"==t.name.toLowerCase());e&&this.$set(this.fieldsModel,e.name,t)}},closeModal(){this.$emit("close",!1)},async save(){const t=await this.$refs.form.validate();t&&(this.$emit("save",this.editFromFileSheet?this.fieldsModalData:this.fieldsModel),this.$emit("close",!1))},getField(t){let e=this._repositoryField.find(e=>t===e.id);if(e)return e}}},h=d,m=(s("4697"),s("2877")),u=Object(m["a"])(h,i,o,!1,null,"059cbd7c",null);e["a"]=u.exports},ef04:function(t,e,s){},f6de:function(t,e,s){},fa79:function(t,e,s){"use strict";s("3002")},fd26:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("BaseActionButton",{attrs:{"is-flat":"","no-border":t.noBorder,icon:t.darkTheme?"eva-moon-outline":"eva-sun-outline"},on:{click:t.toggleDarkTheme}})},o=[],a=s("2f62"),r={name:"ThemeSwitcher",props:{noBorder:{type:Boolean,default:!0}},computed:{...Object(a["c"])(["darkTheme"])},methods:{...Object(a["b"])(["toggleDarkTheme"])}},n=r,l=s("2877"),c=Object(l["a"])(n,i,o,!1,null,"b3ced1f0",null);e["a"]=c.exports}}]);
//# sourceMappingURL=portal-access.a5cf9e70.js.map